<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes, viewport-fit=cover" />
  <title>FAST CPR KOÇU - GÜVENLİ SÜRÜM</title>
  
  <!-- GÖRÜNMEZ DOĞRULAMA ETİKETİ -->
  <span id="__verify__" style="display:none">FAST_CPR_v3_2026_LIC_9B7A2C</span>
  
  <!-- COMPROMISE.JS CDN (Türkçe NLP için) -->
  <script src="https://unpkg.com/compromise"></script>
  
  <script>
  // 1. Bölüm: TGE (Türkçe Dil Motoru) - GÜNCELLENDİ: ATC'ye göre problem-etki eşleştirmesi
  const TGE = {
    // Problem-Etki Eşleştirme Veritabanı (ATC'ye göre)
    problemEffectDatabase: {
      // A: SİNDİRİM SİSTEMİ VE METABOLİZMA
      "A": [
        { problem: "Yemek sonrası başlayan ve saatlerce süren şiddetli şişkinlik hissi", effect: "Hastanın kıyafetlerinin içine sığamaması ve bedeniyle ilgili yaşadığı özgüven kaybı" },
        { problem: "Gece uykudan uyandıran, göğüs kafesine yayılan yakıcı asit reflüsü", effect: "Bölünmüş uykular sebebiyle gün içinde yaşanan aşırı yorgunluk ve dikkat dağınıklığı" },
        { problem: "Günlük rutini bozan, ani ve kontrol edilemeyen defekasyon ihtiyacı", effect: "Önemli iş toplantılarının ortasında masadan kalkmak zorunda kalma kaygısı" },
        { problem: "Kronik kabızlığa bağlı gelişen sürekli karın ağrısı ve dolgunluk", effect: "Günlük işleri tamamlarken hissedilen fiziksel ağırlık ve performans düşüşü" },
        { problem: "Besin alımı sonrası üst karın bölgesinde yoğunlaşan baskı ve huzursuzluk", effect: "Dışarıda yemek yeme korkusu nedeniyle sosyal çevreden ve davetlerden uzaklaşma" },
        { problem: "Kan şekeri regülasyonunda yaşanan ani ve derin düşüşler", effect: "Şeker dalgalanmalarının yarattığı ani sinirlilik hali ve aile içi iletişim sorunları" },
        { problem: "Ağızda kalan sürekli acı tat ve tekrarlayan mide bulantısı atakları", effect: "Beslenme odaklı kısıtlamaların kişiyi monoton ve mutsuz bir diyete mahkûm etmesi" },
        { problem: "Bağırsak seslerinin sosyal ortamda duyulacak kadar şiddetlenmesi", effect: "Sosyal ortamlarda yaşanan yoğun utanç, çekingenlik ve kalabalıktan kaçınma" },
        { problem: "Beslenme sonrası gelişen ve dinlenmekle geçmeyen ağır mide krampları", effect: "Sürekli fiziksel rahatsızlık hissinin yarattığı depresif ruh hali ve hayattan keyif alamama" },
        { problem: "İnsülin direncine bağlı gelişen sürekli açlık hissi ve tatlı krizleri", effect: "Diyet uyumunun bozulmasıyla gelen başarısızlık hissi ve kronik suçluluk duygusu" }
      ],
      // B: KAN VE KAN YAPICI ORGANLAR
      "B": [
        { problem: "Merdiven çıkarken veya kısa yürüyüşlerde bile nefes nefese kalma", effect: "Günlük en basit fiziksel aktivitelerde bile başkasına bağımlı hissetme ve özgürlük kaybı" },
        { problem: "Gün boyu süren, dinlenmekle geçmeyen ve vücuda çöken ağır bitkinlik", effect: "İş yerindeki verimin düşmesi, odaklanma güçlüğü ve kariyer hedeflerinden uzaklaşma" },
        { problem: "Vücudun çeşitli yerlerinde sebepsiz yere oluşan geniş morluklar ve ekimozlar", effect: "Estetik kaygılarla, çevreden gelen 'şiddet mi görüyorsun?' sorularına maruz kalma ve sosyal utanç" },
        { problem: "El ve ayak parmak uçlarında sürekli hissedilen üşüme ve uyuşma hissi", effect: "En sıcak ortamlarda bile konforsuz hissetme ve dokunma duyusunun zayıflamasıyla el becerisi kaybı" },
        { problem: "Ufak kesiklerin veya diş eti kanamalarının beklenenden çok uzun süre durmaması", effect: "Basit bir kaza yaşama korkusuyla hareketlerin kısıtlanması ve sürekli tetikte olma hali" },
        { problem: "Bağışıklık sisteminin zayıflaması sonucu ardı ardına geçirilen enfeksiyonlar", effect: "Hastalık döngüsünden çıkamamanın yarattığı tükenmişlik hissi ve sürekli 'hasta' etiketiyle yaşama" },
        { problem: "Kan değerlerindeki düşüşe bağlı olarak yüzde ve göz içlerinde görülen aşırı solgunluk", effect: "Arkadaş çevresinden gelen 'hasta mısın, çok kötü görünüyorsun' yorumlarının yarattığı psikolojik çöküş" },
        { problem: "Ani ayağa kalkışlarda yaşanan şiddetli baş dönmesi ve göz kararması atakları", effect: "Yalnız başına dışarı çıkma veya evde tek kalma konusunda gelişen yoğun fobi" },
        { problem: "Demir eksikliği veya anemiye bağlı gelişen buz, toprak gibi gıda dışı maddeleri yeme isteği (Pika)", effect: "Bu durumu gizleme çabası ve anormal bir alışkanlığa sahip olmanın verdiği suçluluk duygusu" },
        { problem: "Kemik ve eklemlerde hissedilen derin, sızlayıcı kronik ağrılar", effect: "Sürekli ağrı yönetimiyle uğraşmanın verdiği tahammülsüzlük ve yakın çevresine karşı gelişen asabiyet" }
      ],
      // C: KALP VE DAMAR SİSTEMİ
      "C": [
        { problem: "Göğüs bölgesinde hissedilen ani sıkışma ve baskı hissi", effect: "Her an kötü bir şey olacakmış korkusuyla yaşanan sürekli ölüm anksiyetesi" },
        { problem: "Efor sarf etmeden bile ortaya çıkan düzensiz kalp çarpıntıları", effect: "Kalp atışlarını sürekli dinleme takıntısı ve dikkatini işine verememe sorunu" },
        { problem: "Gün sonunda ayak bileklerinde oluşan ve elle basınca çukurlaşan ödemler", effect: "Ayakkabı giymekte zorlanma ve fiziksel görünümdeki bozulma nedeniyle sosyal izolasyon" },
        { problem: "Tansiyonun öngörülemez şekilde aniden yükselmesi ve şiddetli ense ağrısı", effect: "Evden uzaklaşmaktan korkma ve sürekli tansiyon ölçme ihtiyacının yarattığı stres" },
        { problem: "Gece yarısı nefes açlığıyla uyanma ve doğrulma ihtiyacı (Ortopne)", effect: "Uykusuzluğa bağlı kronik yorgunluk ve gündüzleri iş yerinde yaşanan uyuklama hali" },
        { problem: "Bacak damarlarındaki dolaşım bozukluğuna bağlı gelişen kramplar", effect: "Yürüyüş mesafesinin kısalması ve market alışverişi gibi basit ihtiyaçları görememe" },
        { problem: "Kan basıncındaki dalgalanmaların tetiklediği kronik kulak çınlaması", effect: "Sessiz ortamlarda duramama ve uykuya dalma sürecinde yaşanan zihinsel yıpranma" },
        { problem: "Kalbin pompa gücünün azalmasına bağlı gelişen genel vücut soğukluğu", effect: "En sıcak günlerde bile ısınamamanın verdiği fiziksel konfor kaybı ve mutsuzluk" },
        { problem: "Fiziksel aktivite sırasında gelişen çabuk yorulma ve halsizlik atakları", effect: "Torunlarıyla veya çocuklarıyla vakit geçirememenin verdiği yetersizlik duygusu" },
        { problem: "Ritm bozukluğunun yarattığı boşlukta süzülme ve dengesizlik hissi", effect: "Düşme ve yaralanma korkusuyla tek başına banyoya bile girmekten çekinme" }
      ],
      // D: DERMATOLOJİ (CİLT SAĞLIĞI)
      "D": [
        { problem: "Vücudun görünür bölgelerinde (yüz, el) yerleşen kronik plaklar ve kızarıklıklar", effect: "Toplum içine çıkarken sürekli maruz kalınan meraklı bakışlar ve dışlanma hissi" },
        { problem: "Gece boyu durmayan, deriyi tahriş edene kadar süren şiddetli kaşıntı atakları", effect: "Uyku kalitesinin çökmesi ve gün içinde bitkinlikten dolayı işe odaklanamama" },
        { problem: "Deride meydana gelen derin çatlaklar, pullanma ve beraberinde gelen sızlama", effect: "Basit bir el sıkışma veya dokunma eyleminden bile fiziksel acı nedeniyle kaçınma" },
        { problem: "Saçlı deride yoğun dökülme, pullanma ve kıyafetlere dökülen deri kalıntıları", effect: "Sosyal ortamlarda sürekli üstünü kontrol etme ihtiyacı ve gelişen aşırı çekingenlik" },
        { problem: "Akne sonrası kalan derin skarlar ve ciltteki pürüzlü doku görünümü", effect: "Aynaya bakmaktan kaçınma ve özgüven kaybı nedeniyle ikili ilişkilerde pasifleşme" },
        { problem: "Güneş ışığına hassasiyet sonucu en ufak temasla gelişen yanma ve kabarma", effect: "Gündüz aktivitelerinden tamamen mahrum kalma ve eve hapsolmuş hissetme" },
        { problem: "Tırnak yapısındaki bozulmalar, kalınlaşmalar ve renk değişimleri", effect: "Elleri sürekli saklama çabası ve bakımlı görünememenin yarattığı mutsuzluk" },
        { problem: "Atopik cilde bağlı olarak gelişen sürekli gerginlik ve hassasiyet hissi", effect: "Kıyafet seçiminde kumaş kısıtlamasına gitmek zorunda kalmanın yarattığı konfor kaybı" },
        { problem: "Terleme bozuklukları sonucu oluşan sürekli ıslaklık hissi ve deri tahrişi", effect: "Kıyafetlerdeki izleri gizlemeye çalışma stresi ve hijyen konusunda gelişen obsesyon" },
        { problem: "Ağız çevresi veya dudaklarda tekrarlayan açık yaralar ve aftöz yapılar", effect: "Yemek yerken veya konuşurken hissedilen acı nedeniyle sosyal iletişimden kaçma" }
      ],
      // G: GENITO-ÜRİNER SİSTEM VE CİNSİYET HORMONLARI
      "G": [
        { problem: "Gün içinde çok sık tekrarlayan ve aniden bastıran idrar sıkışıklığı hissi", effect: "Sürekli bir tuvalet haritası çıkarma zorunluluğu ve açık havada bulunma korkusu" },
        { problem: "İdrar yaparken hissedilen keskin yanma, sızlama ve tam boşalamama duygusu", effect: "Günlük rutinin fiziksel acı nedeniyle bölünmesi ve sürekli huzursuzluk hali" },
        { problem: "Gece boyunca defalarca idrara kalkma zorunluluğu (Noktüri)", effect: "Kronik uykusuzluğa bağlı sabahları yorgun uyanma ve gün içi konsantrasyon kaybı" },
        { problem: "İstem dışı gelişen idrar kaçırma (inkontinans) veya damlatma şikayetleri", effect: "Hijyen kaygısıyla oluşan koku korkusu ve sosyal ortamlardan tamamen uzaklaşma" },
        { problem: "Hormonal dengesizliğe bağlı gelişen ani ateş basmaları ve gece terlemeleri", effect: "Duygusal dalgalanmaların yarattığı tahammülsüzlük ve aile içi ilişkilerde gerginlik" },
        { problem: "Pelvik bölgede hissedilen kronik dolgunluk, baskı ve tarif edilemeyen ağrı", effect: "Uzun süre oturarak çalışmayı gerektiren işlerde performansın ciddi şekilde düşmesi" },
        { problem: "Cinsel fonksiyonlarda yaşanan isteksizlik veya fiziksel yetersizlik tabloları", effect: "Partnerine karşı mahcubiyet duyma, yetersizlik hissi ve ikili ilişkilerin bozulması" },
        { problem: "Tekrarlayan idrar yolu enfeksiyonları ve buna bağlı gelişen halsizlik", effect: "Sürekli 'hastalık döngüsü' içinde hissetmenin yarattığı psikolojik çöküş ve bıkkınlık" },
        { problem: "Üreme sağlığı ile ilgili yaşanan klinik belirsizlikler ve hormonal düzensizlik", effect: "Gelecek planları yaparken hissedilen derin kaygı ve ebeveynlik hayallerinin zedelenmesi" },
        { problem: "Böbrek kum veya taş dökme süreçlerindeki şiddetli kolik ağrı atakları", effect: "Her an ağrı başlayacak korkusuyla sosyal planları iptal etme ve hayata karşı savunmasızlık" }
      ],
      // H: SİSTEMİK HORMON HAZIRLIKLARI
      "H": [
        { problem: "Tiroid disfonksiyonuna bağlı gelişen ani ve kontrolsüz kilo değişimleri", effect: "Vücut imajının bozulmasıyla gelen sosyal fobi ve aynaya bakma isteksizliği" },
        { problem: "Vücut genelinde hissedilen ve dinlenmekle geçmeyen kronik letarji (uyuşukluk)", effect: "En basit ev işlerini bile tamamlayamamanın verdiği yetersizlik ve suçluluk duygusu" },
        { problem: "Kortizol dengesizliğe bağlı gelişen yüzde şişlik (ay dede yüzü) ve ödem", effect: "Çevresindekilerin 'ne kadar çok kilo almışsın' yorumlarına maruz kalmanın yarattığı duygusal çöküş" },
        { problem: "Hormonal düzensizlik sonucu ortaya çıkan aşırı sinirlilik ve ağlama atakları", effect: "Aile içi huzursuzluk, sebepsiz tartışmalar ve yakın çevreyle bozulan ilişkiler" },
        { problem: "Vücut ısısını ayarlayamama; sürekli üşüme veya aşırı sıcak basması hissi", effect: "Fiziksel konforsuzluk nedeniyle dış ortamlarda bulunmaktan kaçınma ve sosyal izolasyon" },
        { problem: "Büyüme hormonu eksikliğe bağlı fiziksel gelişim geriliği ve boy kısalığı", effect: "Yaşıtları arasında 'farklı' görünmenin yarattığı akran zorbalığına maruz kalma ve içe kapanma" },
        { problem: "Deride incelme, morluklar ve yaraların çok geç iyileşmesi", effect: "Fiziksel bir zarar görme korkusuyla hareketlerin kısıtlanması ve sürekli kaygı hali" },
        { problem: "Metabolik hızın düşmesiyle beraber gelişen şiddetli zihinsel bulanıklık (brain fog)", effect: "Okunanı anlamada güçlük, iş yerinde odaklanamama ve mesleki başarısızlık korkusu" },
        { problem: "Kronik hormon dengesizliğe bağlı gelişen yaygın eklem ve kas ağrıları", effect: "Hareket kabiliyetinin azalması sonucu hobilerden ve aktif hayattan kopma" },
        { problem: "Ses tellerindeki kalınlaşma ve ses tonunda belirgin değişimler", effect: "Konuşurken kendini yabancı hissetme ve iletişim kurma isteğinin azalması" }
      ],
      // J: SİSTEMİK ANTI-İNFEKTİFLER
      "J": [
        { problem: "Günlerce düşmeyen yüksek ateş ve beraberinde gelen şiddetli titreme nöbetleri", effect: "Bilinç bulanıklığı, halüsinasyon korkusu ve tamamen başkasına muhtaç hale gelme" },
        { problem: "Enfeksiyona bağlı gelişen, tüm vücutta hissedilen ağır kas ve eklem sızıları", effect: "Yatağa bağımlı kalma, en basit kişisel bakımı bile yaparken ağlama noktasına gelme" },
        { problem: "Solunum yolu enfeksiyonu kaynaklı, nefesi kesen ve göğsü ağrıtan öksürük krizleri", effect: "Toplu taşıma veya kalabalık ortamlarda 'bulaştırıcı' damgası yeme endişesi ve utanç" },
        { problem: "Sindirim sistemini etkileyen enfeksiyonlarda yaşanan dehidratasyon ve aşırı halsizlik", effect: "Yataktan kalkacak gücü bulamama, evin içinde bile hareket ederken bayılma korkusu" },
        { problem: "Antibiyotik kullanımına bağlı gelişen ikincil mantar enfeksiyonları veya döküntüler", effect: "Mevcut hastalıkla uğraşırken eklenen yeni fiziksel konforsuzluk ve moral çöküntüsü" },
        { problem: "Kronikleşen enfeksiyon odakları nedeniyle vücutta biriken toksik yük ve iştahsızlık", effect: "Hızla kilo kaybı, güçten düşme ve 'hiç iyileşemeyeceğim' düşüncesinin yarattığı depresyon" },
        { problem: "Lenf bezlerinde oluşan ağrılı şişlikler ve boğazda yutkunmayı engelleyen inflamasyon", effect: "Konuşma güçlüğü ve beslenme reddi nedeniyle sosyal iletişimden tamamen kopma" },
        { problem: "Viral enfeksiyonlar sonrası aylarca süren geçmeyen yorgunluk sendromu", effect: "Eski iş temposuna dönememe, çevresi tarafından 'tembel' olarak algılanma stresi" },
        { problem: "Tekrarlayan enfeksiyonlar yüzünden sürekli rapor almak zorunda kalma", effect: "İş kaybı riski, iş arkadaşlarına karşı mahcubiyet ve ekonomik gelecek kaygısı" },
        { problem: "Ağır enfeksiyon tablosunun yarattığı yoğun gece terlemeleri ve huzursuz bacak hissi", effect: "Dinlendirici uykunun imkansız hale gelmesi ve ertesi güne tükenmiş başlamak" }
      ],
      // L: ANTİNEOPLASTİK VE İMMÜNOMODÜLATÖR AJANLAR
      "L": [
        { problem: "Tedavi sürecinde gelişen ve hiçbir gıdayı kabul edemeyecek kadar ağır mide bulantıları", effect: "Sevilen yiyeceklerden nefret etme, beslenme odaklı sosyal ortamlardan tamamen kopma" },
        { problem: "Vücut direncindeki dramatik düşüşe bağlı olarak gelişen fırsatçı enfeksiyonlar", effect: "Sürekli bir fanusta yaşıyormuş gibi hissetme, sevdiklerine dahi sarılamama korkusu" },
        { problem: "İlaçların toksik etkileriyle ortaya çıkan el ve ayak tabanlarındaki ağrılı deri reaksiyonları", effect: "Ayakkabı giyememe, yürürken cam kırıkları üzerinde yürüyormuşçasına acı çekme" },
        { problem: "Saç, kaş ve kirpik kaybı ile beraber seyreden dış görünümdeki radikal değişim", effect: "Kimlik kaybı hissi, başkalarının acıyan bakışlarına maruz kalmamak için eve kapanma" },
        { problem: "Kemik iliği baskılanmasına bağlı olarak gelişen derin anemi ve nefes darlığı", effect: "Kendi kişisel bakımını yaparken dahi yarı yolda kalma ve fiziksel tükenmişlik" },
        { problem: "Eklem bölgelerinde ve derin dokularda hissedilen, dinmeyen nöropatik ağrılar", effect: "Sürekli ağrı ile yaşamanın getirdiği mental yorgunluk ve uyku düzeninin tamamen yitirilmesi" },
        { problem: "Bağışıklık baskılayıcı süreçlerin tetiklediği kronik ağız içi yaraları (mukozit)", effect: "Konuşurken dilin damağa değmesiyle bile irkilme ve sıvı beslenmeye mahkûm kalma" },
        { problem: "Tedavi döngüleri arasında yaşanan 'kemoterapi sisi' (brain fog) ve bilişsel yavaşlama", effect: "Kelimeleri unutma, iş yerinde yetersizlik hissi ve zihinsel kapasitesini kaybetme kaygısı" },
        { problem: "Vücutta oluşan yaygın ödem ve ilaç etkilerine bağlı kontrolsüz yüz şişkinlikleri", effect: "Kendine yabancılaşma, sosyal medyada veya fotoğraflarda görünmekten kaçınma" },
        { problem: "Üreme sağlığının ve hormonal dengenin agresif tedavi nedeniyle zarar görmesi", effect: "Ebeveynlik hayallerinin ertelenmesi veya yitirilmesinin yarattığı derin yas süreci" }
      ],
      // M: KAS VE İSKELET SİSTEMİ
      "M": [
        { problem: "Sabahları yataktan kalkarken hissedilen ve saatlerce süren eklem katılığı", effect: "Güne başlarken başkasına muhtaç olma ve basit ihtiyaçlarını giderememe huzursuzluğu" },
        { problem: "Hareketle artan, dinlenmekle dahi tamamen geçmeyen kronik bel ve sırt ağrıları", effect: "Uzun süre aynı pozisyonda oturamama nedeniyle iş hayatında yaşanan verim kaybı" },
        { problem: "Eklem yerlerinde meydana gelen belirgin deformasyonlar ve şişlikler", effect: "Estetik kaygılarla ellerini veya ayaklarını saklama ihtiyacı ve sosyal çekingenlik" },
        { problem: "Kas gücünde yaşanan ani kayıplar ve bir nesneyi kavrayamama sorunu", effect: "Mutfakta veya ev işlerinde sakarlık yapma korkusu ve özgüvenin zedelenmesi" },
        { problem: "Diz veya kalça eklemindeki aşınmaya bağlı gelişen mekanik kilitlenmeler", effect: "Düşme ve kemik kırılması korkusuyla sokağa çıkmaktan vazgeçme ve eve hapsolma" },
        { problem: "İnflamatuar süreçlerin tetiklediği, gece uykudan uyandıran yanıcı eklem sızıları", effect: "Kesintisiz uykuya hasret kalma ve kronik uykusuzluğun yarattığı asabiyet hali" },
        { problem: "Omurga eğriliğine veya disk problemlerine bağlı gelişen postür bozukluğu", effect: "Kambur görünme endişesi ve fiziksel duruşun yarattığı negatif benlik algısı" },
        { problem: "Tendon ve bağ yaralanmaları sonucu oluşan hassasiyet ve basma zorluğu", effect: "Çok sevilen hobilerden (spor, yürüyüş, dans) tamamen kopmanın verdiği boşluk hissi" },
        { problem: "Kemik yoğunluğundaki azalmaya bağlı gelişen sürekli 'kırılganlık' hissi", effect: "Kalabalık ortamlarda birinin çarpması korkusuyla yaşanan sürekli tetikte olma hali" },
        { problem: "Yumuşak doku romatizmasına bağlı gelişen yaygın vücut ağrısı ve hassas noktalar", effect: "Çevresi tarafından 'hastalık hastası' olarak etiketlenme korkusu ve anlaşılmama duygusu" }
      ],
      // N: SİNİR SİSTEMİ
      "N": [
        { problem: "Işığa ve sese hassasiyetle gelen, zonklayıcı şiddetli migren atakları", effect: "Karanlık bir odaya hapsolma ve dış dünyadan tamamen kopma mecburiyeti" },
        { problem: "El ve ayaklarda uyuşma, karıncalanma ve 'elektrik çarpması' benzeri hisler", effect: "İnce motor becerilerin kaybıyla yazı yazma veya düğme ilikleme gibi işlerde başarısızlık" },
        { problem: "Günlük işleri yapmayı engelleyen el titremeleri (tremor) ve denge kaybı", effect: "Sosyal ortamlarda bir şeyler içerken rezil olma korkusu ve kalabalıktan kaçınma" },
        { problem: "Odaklanma güçlüğü, kısa süreli hafıza kayıpları ve zihinsel yavaşlama", effect: "En basit talimatları bile unutma ve iş yerinde yetersizlik/aptallık hissetme kaygısı" },
        { problem: "Gece boyunca bacaklarda hissedilen durdurulamaz hareket ettirme dürtüsü", effect: "Eşinin uykusunu bölme suçluluğu ve sabahları dayak yemiş gibi yorgun uyanma" },
        { problem: "Kronikleşen uykuya dalamama (insomnia) ve zihni susturamama hali", effect: "Ertesi güne dair yaşanan performans anksiyetesi ve bitkinlikten dolayı artan sinirlilik" },
        { problem: "Yüzün bir tarafında aniden gelişen şiddetli, şimşek çakar tarzda nevraljik ağrılar", effect: "Yemek yeme, konuşma ve hatta gülümseme eylemlerine karşı gelişen derin fobi" },
        { problem: "Panik atak benzeri ani çarpıntı, nefes darlığı ve kontrolü kaybetme hissi", effect: "Tek başına dışarı çıkamama ve güvenli alan (ev) dışındaki her yere karşı gelişen agorafobi" },
        { problem: "Kaslarda kontrolsüz kasılmalar (spazmlar) ve beraberinde gelen kramplar", effect: "Vücuduna olan güvenini kaybetme ve her an bir atak geçirme korkusuyla yaşama" },
        { problem: "Sürekli devam eden baş dönmesi (vertigo) ve boşlukta yürüme hissi", effect: "Yer ayağının altından kayıyormuşçasına yaşanan sürekli bir güvensizlik ve düşme korkusu" }
      ],
      // P: ANTİPARAZİTİK ÜRÜNLER, İNSEKTİSİTLER VE REPELLENTLER
      "P": [
        { problem: "Gece artan, deri altında bir şey yürüyormuş hissi veren şiddetli kaşıntılar", effect: "Uykuya dalma korkusu ve vücuduna karşı duyulan derin tiksinti hissi" },
        { problem: "Vücudun kıvrım yerlerinde ve parmak aralarında oluşan tünel benzeri lezyonlar", effect: "'Bulaştırıcı' olma korkusuyla en yakınlarına bile dokunmaktan kaçınma" },
        { problem: "Sindirim sisteminde yerleşen parazitlere bağlı ani karın krampları ve kilo kaybı", effect: "Nedeni anlaşılamayan bitkinlik ve 'içten içe tükeniyormuş' algısının yarattığı anksiyete" },
        { problem: "Saçlı deride yerleşen parazitlerin neden olduğu sürekli iritasyon ve yaralar", effect: "Sosyal ortamlarda kafasını kaşıma ihtiyacını bastırmaya çalışmanın verdiği gerginlik" },
        { problem: "Vektörlerle bulaşan hastalıklar sonrası gelişen tekrarlayan yüksek ateş nöbetleri", effect: "Hayatın her an kesintiye uğrayacağı korkusuyla uzun vadeli plan yapamama" },
        { problem: "Parazit enfestasyonuna bağlı deride oluşan yaygın döküntü ve enfekte yaralar", effect: "Kıyafet seçiminde tamamen 'gizleme' odaklı davranma ve özgürlüğün kısıtlanması" },
        { problem: "Ev içindeki diğer bireylerde de benzer semptomların görülmeye başlanması", effect: "Aile üyelerine zarar verme suçluluğu ve ev içindeki huzurun tamamen kaçması" },
        { problem: "Bağırsak parazitlerinin tetiklediği kronik anal kaşıntı ve huzursuzluk", effect: "Toplum içinde oturup kalkarken yaşanan yoğun utanç ve konsantrasyon kaybı" },
        { problem: "Parazit kaynaklı gelişen besin emilim bozukluğu ve vitamin eksiklikleri", effect: "Fiziksel direncin çökmesiyle beraber gelen sürekli 'hasta ve solgun' görünme hali" },
        { problem: "Tedavi sürecindeki yoğun dezenfeksiyon ve izolasyon zorunlulukları", effect: "Evdeki her eşyaya şüpheyle bakma ve temizlik konusunda gelişen obsesif davranışlar" }
      ],
      // R: SOLUNUM SİSTEMİ
      "R": [
        { problem: "Göğüste sıkışma hissiyle beraber gelen hırıltılı solunum atakları", effect: "Boğuluyormuş hissiyle yaşanan yoğun panik ve ölüm korkusu" },
        { problem: "Özellikle sabaha karşı artan, kesintisiz ve inatçı öksürük krizleri", effect: "Gece uykusunun tamamen dağılması ve ertesi güne nefessiz, yorgun başlama" },
        { problem: "Merdiven çıkarken veya konuşurken dahi tıkanma ve nefes darlığı", effect: "Fiziksel kapasitenin daralmasıyla sosyal hayattan ve hobilerden el çekme" },
        { problem: "Burun tıkanıklığı ve buna bağlı gelişen kronik ağız solunumu", effect: "Ağız kuruluğu, koku-tat kaybı ve yemek yeme keyfinin tamamen yok olması" },
        { problem: "Hava yollarındaki aşırı balgam üretimi ve sürekli çıkarma ihtiyacı", effect: "Toplum içinde sürekli temizlenme ihtiyacının yarattığı sosyal utanç ve rahatsızlık" },
        { problem: "Mevsimsel polen veya tozlara karşı gelişen ani hapşırık ve göz sulanması", effect: "Açık havada vakit geçirememe ve bahar aylarını eve hapsolmuş şekilde geçirme" },
        { problem: "Sinüzite bağlı gelişen, öne eğilmekle artan şiddetli yüz ve baş ağrısı", effect: "Gün boyu süren zihinsel ağırlık nedeniyle işe veya derse odaklanamama" },
        { problem: "Ses tellerindeki ödem ve inflamasyon kaynaklı ses kısıklığı (disfoni)", effect: "İletişim kurarken zorlanma, sunum yapamama ve mesleki özgüven kaybı" },
        { problem: "Uyku apnesine bağlı gece boyu horlama ve nefes durması periyotları", effect: "Eşler arasında oda ayırma noktasına gelen huzursuzluk ve derin uykuya hasret kalma" },
        { problem: "Göğüs duvarında hissedilen batıcı ağrı ve derin nefes alma güçlüğü", effect: "Hareket ederken sürekli tetikte olma ve kısıtlı nefes alma alışkanlığı edinme" }
      ],
      // S: DUYU ORGANLARI (GÖZ VE KULAK)
      "S": [
        { problem: "Gözlerde sürekli kaşıntı, yanma ve 'kum kaçmış' hissi veren kuruluk", effect: "Kitap okuma, ekran kullanımı gibi günlük aktiviteleri ağrı nedeniyle sürdürememe" },
        { problem: "Kulaklarda gün boyu dinmeyen, sessiz ortamlarda artan yüksek frekanslı çınlama", effect: "Zihinsel sessizliği kaybetme, odaklanma güçlüğü ve kronik sinirlilik hali" },
        { problem: "Görme alanında oluşan bulanıklaşma, odaklanamama ve cisimleri çift görme", effect: "Araba kullanırken veya yolda yürürken gelişen güvensizlik ve kaza yapma korkusu" },
        { problem: "Kulak yolunda tıkanıklık hissiyle beraber gelen belirgin işitme kaybı", effect: "Kalabalık ortamlardaki diyalogları kaçırma ve 'sürekli soru sorma' mahcubiyetiyle sessizleşme" },
        { problem: "Işığa karşı aşırı hassasiyet (fotofobi) ve parlak yüzeylere bakamama", effect: "Gün ışığında dışarı çıkamama ve sürekli karanlık ortamlarda kalma isteğiyle gelen izolasyon" },
        { problem: "Orta kulak basınç dengesizliğine bağlı yaşanan şiddetli baş dönmesi ve bulantı", effect: "Yataktan kalkarken dünyanın dönmesiyle oluşan çaresizlik ve tek başına hareket edememe" },
        { problem: "Göz tansiyonuna bağlı gelişen ani görme kayıpları ve daralan görme açısı", effect: "Bağımsızlığını kaybetme endişesi ve kör olma korkusunun yarattığı panik ataklar" },
        { problem: "Kulak akıntısı ve buna eşlik eden zonklayıcı, derin iç kulak ağrısı", effect: "Dış dünyadan gelen seslere karşı bir bariyer oluşması ve çevresiyle iletişiminin kopması" },
        { problem: "Göz kapaklarında tekrarlayan şişlikler, çapaklanma ve kirpik diplerinde inflamasyon", effect: "Sabahları aynaya bakarken duyulan fiziksel rahatsızlık ve sosyal ortamlarda bakışlardan kaçma" },
        { problem: "Seslerin boğuk gelmesi veya bazı frekansların hiç algılanamaması", effect: "En sevilen müziklerden tat alamama ve sosyal hayattan koparak kendi içine kapanma" }
      ]
    },
    
    // ATC Koduna göre rastgele problem-etki çifti getir
    getRandomPairByATC(atcCode) {
      const pairs = this.problemEffectDatabase[atcCode];
      if (!pairs || pairs.length === 0) {
        return {
          problem: "Klinik pratikte sık karşılaşılan bir problem",
          effect: "Bu durum hasta yaşam kalitesini olumsuz etkiler"
        };
      }
      
      const randomIndex = Math.floor(Math.random() * pairs.length);
      return pairs[randomIndex];
    },
    
    // ATC kodunu tahmin et (metinden)
    guessATCCode(text) {
      const t = text.toLowerCase();
      
      // Sindirim Sistemi
      if (t.includes('mide') || t.includes('bağırsak') || t.includes('şişkinlik') || t.includes('reflü') || 
          t.includes('kabızlık') || t.includes('bulantı') || t.includes('kramp') || t.includes('kan şekeri') || 
          t.includes('insülin') || t.includes('besin')) {
        return "A";
      }
      
      // Kan ve Kan Yapıcı Organlar
      if (t.includes('nefes') || t.includes('bitkinlik') || t.includes('morluk') || t.includes('kanama') || 
          t.includes('bağışıklık') || t.includes('solgun') || t.includes('demir') || t.includes('anemi') || 
          t.includes('pıhtı') || t.includes('hücre')) {
        return "B";
      }
      
      // Kalp ve Damar
      if (t.includes('kalp') || t.includes('tansiyon') || t.includes('çarpıntı') || t.includes('ödem') || 
          t.includes('damar') || t.includes('dolaşım') || t.includes('ritm') || t.includes('göğüs') || 
          t.includes('yorgunluk') || t.includes('basınç')) {
        return "C";
      }
      
      // Dermatoloji
      if (t.includes('cilt') || t.includes('deri') || t.includes('kaşıntı') || t.includes('kızarıklık') || 
          t.includes('akne') || t.includes('skar') || t.includes('tırnak') || t.includes('döküntü') || 
          t.includes('egzama') || t.includes('sedef')) {
        return "D";
      }
      
      // Genito-Üriner
      if (t.includes('idrar') || t.includes('mesane') || t.includes('böbrek') || t.includes('pelvik') || 
          t.includes('hormon') || t.includes('menopoz') || t.includes('cinsel') || t.includes('üreme') || 
          t.includes('prostat') || t.includes('vajinal')) {
        return "G";
      }
      
      // Sistemik Hormonlar
      if (t.includes('tiroid') || t.includes('kortizol') || t.includes('büyüme') || t.includes('metabolik') || 
          t.includes('hormonal') || t.includes('kilo') || t.includes('ödem') || t.includes('sıcak basması') || 
          t.includes('ses') || t.includes('letarji')) {
        return "H";
      }
      
      // Anti-infektifler
      if (t.includes('enfeksiyon') || t.includes('ateş') || t.includes('bakteri') || t.includes('viral') || 
          t.includes('antibiyotik') || t.includes('iltihap') || t.includes('öksürük') || t.includes('boğaz') || 
          t.includes('lenf') || t.includes('terleme')) {
        return "J";
      }
      
      // Antineoplastik
      if (t.includes('kanser') || t.includes('tümör') || t.includes('kemoterapi') || t.includes('radyoterapi') || 
          t.includes('bulantı') || t.includes('saç dökülmesi') || t.includes('ağrı') || t.includes('immun') || 
          t.includes('toksik') || t.includes('nöropati')) {
        return "L";
      }
      
      // Kas-İskelet
      if (t.includes('eklem') || t.includes('kas') || t.includes('romatizma') || t.includes('ağrı') || 
          t.includes('artrit') || t.includes('osteoporoz') || t.includes('bel') || t.includes('sırt') || 
          t.includes('tendon') || t.includes('kireçlenme')) {
        return "M";
      }
      
      // Sinir Sistemi
      if (t.includes('migren') || t.includes('sinir') || t.includes('nöroloji') || t.includes('titreme') || 
          t.includes('uyku') || t.includes('anksiyete') || t.includes('panik') || t.includes('baş dönmesi') || 
          t.includes('nöropati') || t.includes('epilepsi')) {
        return "N";
      }
      
      // Antiparazitik
      if (t.includes('parazit') || t.includes('kaşıntı') || t.includes('enfestasyon') || t.includes('böcek') || 
          t.includes('kene') || t.includes('mantar') || t.includes('döküntü') || t.includes('bağırsak') || 
          t.includes('dezenfeksiyon') || t.includes('izolasyon')) {
        return "P";
      }
      
      // Solunum
      if (t.includes('solunum') || t.includes('nefes') || t.includes('öksürük') || t.includes('astım') || 
          t.includes('bronşit') || t.includes('burun') || t.includes('sinüzit') || t.includes('alerji') || 
          t.includes('hapşırık') || t.includes('balgam')) {
        return "R";
      }
      
      // Duyu Organları
      if (t.includes('göz') || t.includes('kulak') || t.includes('görme') || t.includes('işitme') || 
          t.includes('çınlama') || t.includes('kuruluk') || t.includes('ağrı') || t.includes('tansiyon') || 
          t.includes('fotofobi') || t.includes('vertigo')) {
        return "S";
      }
      
      // Varsayılan olarak genel kategori
      return "A";
    },

    detectCategory(p, e) {
      const combined = (p + " " + e).toLowerCase();
      if (/[0-9]|mg|%|doz|skor|seviye|değer|parametre|oran|indeks/i.test(combined)) return "A1";
      if (/reseptör|hücre|kanal|enzim|yolak|mekanizma|molekül|protein|sentez/i.test(combined)) return "A2";
      if (/yan etki|güven|konfor|tolere|risk|advers|hassasiyet|emniyet/i.test(combined)) return "A3";
      return "A4";
    },

    DynamicConnectors: {
      "A": {
        "A1": ["parametresindeki bu klinik düzelme ile beraber,", "değerlerinde sağlanan bu kontrol sayesinde,", "seviyelerindeki bu anlamlı değişimle birlikte,", "oranındaki bu regülasyonun bir sonucu olarak,", "verilerine yansıyan bu sayısal başarı ışığında,", "ölçümlerine yansıyan bu stabilizasyon sayesinde,", "skorlarındaki bu iyileşme eğilimiyle paralel olarak,", "tablosundaki bu sayısal netlik sayesinde,", "analizlerindeki bu pozitif yöndeki değişimle,", "bulgularındaki bu regüle edici etki ışığında,"],
        "A2": ["mekanizmasında sağlanan bu fizyolojik denge sayesinde,", "yolağındaki bu spesifik düzenleme ile birlikte,", "hücresel düzeyde gerçekleşen bu etki sonucunda,", "reseptör düzeyindeki bu hassas kontrol paralelinde,", "enzimatik süreçteki bu stabilizasyon sayesinde,", "biyokimyasal süreçteki bu hedeflenmiş etki ile,", "moleküler düzeyde sağlanan bu modülasyon sayesinde,", "işleyiş mekanizmasındaki bu doğrudan etki sonucunda,", "sistemik düzeyde oluşan bu fonksiyonel yanıtla,", "organik düzeydeki bu bütünsel toparlanma ışığında,"],
        "A3": ["sürecinde gözlenen bu yüksek tolerabilite ile birlikte,", "uygulamasındaki bu güvenli profil sayesinde,", "tedavisinde hissedilen bu hasta konforu sonucunda,", "kullanımındaki bu düşük risk profili ışığında,", "takibinde sağlanan bu emniyetli klinik tablo sayesinde,", "yönetimindeki bu yan etki kontrolü ile beraber,", "idamesinde sağlanan bu stabilizasyon sayesinde,", "protokolündeki bu güven odaklı yaklaşım sonucunda,", "deneyiminde hissedilen bu yüksek uyum sayesinde,", "periyodunda gözlenen bu komplikasyonsuz süreçle,"],
        "A4": ["protokolündeki bu pratik uygulama avantajı sayesinde,", "hazırlama aşamasındaki bu teknik kolaylık ile beraber,", "kullanım dozajındaki bu basit uyumun bir sonucu olarak,", "rutinindeki bu zaman kazandıran yapı ışığında,", "yönetimindeki bu zahmetsiz süreç desteği sayesinde,", "uygulama sıklığındaki bu rasyonel düzenleme ile,", "hasta uyumunu artıran bu basitlik sayesinde,", "işlem sürecindeki bu operasyonel rahatlık sonucunda,", "kullanım formunun sunduğu bu ek avantajlar ile,", "günlük hayata entegre olan bu hız sayesinde,"]
      },
      "B": {
        "A1": ["hemogram değerlerindeki bu stabilizasyon sayesinde,", "kan parametrelerindeki bu hızlı düzelme ile beraber,", "demir depolarındaki bu anlamlı dolum sonucunda,", "pıhtılaşma sürelerindeki bu hedeflenen kontrolle,", "eritrosit indekslerindeki bu iyileşme ışığında,", "kanama kontrolünde sağlanan bu sayısal başarıyla,", "ferritin seviyelerindeki bu regülasyon sayesinde,", "laboratuvar bulgularındaki bu net toparlanma ile,", "hücre sayımlarındaki bu dengeli artış sonucunda,", "clinik ölçümlere yansıyan bu hematolojik yanıtla,"],
        "A2": ["hematopoez sürecindeki bu fizyolojik destek sayesinde,", "kemik iliği yanıtındaki bu spesifik etkileşimle,", "koagülasyon kaskadındaki bu dengeli düzenleme ile,", "hemoglobin sentezindeki bu moleküler iyileşme sayesinde,", "hücre üretim yolağındaki bu hedeflenmiş kontrolle,", "plazma dengesindeki bu biyokimyasal stabilizasyonla,", "vasküler düzeyde sağlanan bu koruyucu etki sayesinde,", "hücre yaşam döngüsündeki bu uzama sonucunda,", "faktör düzeyindeki bu doğrudan modülasyon ışığında,", "sistemic dolaşımdaki bu mekanik rahatlama ile,"],
        "A3": ["infüzyon sürecindeki bu yüksek tolerabilite sayesinde,", "uzun dönem kullanımındaki bu güvenli profil ile,", "kan tablosuna yansıyan bu emniyetli değişimle,", "tedaviye verilen bu sorunsuz klinik yanıt sayesinde,", "gastrik toleransta sağlanan bu ek konfor sonucunda,", "vasküler yapıdaki bu düşük irritasyon riskiyle,", "hasta takibindeki bu komplikasyonsuz ilerleme sayesinde,", "idame sürecindeki bu yüksek emniyet düzeyi ile,", "genel sağlık profilindeki bu korunan stabiliteyle,", "advers olaylardaki bu belirgin azalma ışığında,"],
        "A4": ["kullanım kolaylığı sunan bu uygulama formu sayesinde,", "günlük dozdaki bu pratik ayarlama imkanı ile,", "hasta uyumunu maksimize eden bu yöntem sayesinde,", "tedaviye adaptasyonu artıran bu basit süreçle,", "hazırlama zahmetini ortadan kolayca kaldıran bu pratiklikle,", "mobiliteyi kısıtlamayan bu uygulama desteği sayesinde,", "hızlı emilim sağlanan bu form avantajı sonucunda,", "evde kullanımda sunulan bu teknik rahatlık sayesinde,", "rutin kontroldeki bu kolaylaştırılmış süreçle,", "yönetimi sadeleştiren bu basit protokol ışığında,"]
      },
      "C": {
        "A1": ["tansiyon ölçümlerindeki bu dengeli seyir sayesinde,", "nabız sayısındaki bu hedeflenen yavaşlama ile,", "ejeksiyon fraksiyonundaki bu sayısal artış sonucunda,", "lipid profilindeki bu anlamlı düşüş ışığında,", "kalp debisindeki bu ölçülebilir iyileşme sayesinde,", "vasküler dirençteki bu sayısal azalma ile beraber,", "kolesterol değerlerindeki bu hedeflenen regülasyonla,", "ekokardiyografik bulgulardaki bu net düzelme sayesinde,", "klinik parametrelerdeki bu stabilizasyon sonucunda,", "aritmi yükündeki bu sayısal azalma ışığında,"],
        "A2": ["miyokard performansındaki bu mekanik artış sayesinde,", "damar endotelindeki bu koruyucu modülasyon ile,", "ileti sistemindeki bu fizyolojic stabilizasyonla,", "kardiyak yeniden yapılanmadaki bu pozitif etkiyle,", "reseptör düzeyindeki bu beta-bloke edici etki sayesinde,", "kalsiyum kanal yolağındaki bu hassas kontrolle,", "vasküler düz kaslardaki bu gevşeme etkisi sayesinde,", "renin-anjiyotensin yolağındaki bu blokaj sonucunda,", "hücresel enerji metabolizmasındaki bu denge sayesinde,", "perfüzyon mekanizmasındaki bu dinamik iyileşme ile,"],
        "A3": ["kalp yükünü azaltan bu genel konfor sayesinde,", "tedavi sürecindeki bu yüksek güvenlilik profili ile,", "ilaç etkileşim riskindeki bu düşüklük sayesinde,", "organ fonksiyonlarındaki bu koruyucu etki sonucunda,", "egzersiz toleransındaki bu artışla beraber,", "yaşam kalitesine yansıyan bu stabilite sayesinde,", "uzun vadeli kullanımdaki bu emniyetli tabloyla,", "hastanın hissettiği bu psikolojik güven duygusuyla,", "günlük aktivitedeki bu semptomsuz süreç sayesinde,", "klinik stabilitedeki bu sürdürülebilir konforla,"],
        "A4": ["doz ayarlamasındaki bu pratiklik sayesinde,", "tek doz kullanımın sunduğu bu uyum avantajı ile,", "tedaviye katılımı artıran bu kolay süreç sayesinde,", "takip kolaylığı sağlayan bu basit yöntemle,", "acil durumlarda sunulan bu hızlı uygulama desteğiyle,", "rutin yaşantıyı bölmeyen bu kullanım konforuyla,", "ilaç yönetimindeki bu kullanıcı dostu yapı sayesinde,", "hastane yükünü azaltan bu evde kullanım kolaylığıyla,", "hızlı yanıt alınan bu pratik protokol sonucunda,", "süreci sadeleştiren bu teknik destek ışığında,"]
      },
      "D": {
        "A1": ["lezyon skorlarındaki bu gerileme ile,", "skaladaki bu iyileşme sayesinde,", "semptom şiddetindeki bu düşüşle,", "klinik puanlamadaki bu başarıyla,", "iyileşme oranındaki bu artışla,", "yüzey alanındaki bu küçülme sayesinde,", "eritem derecesindeki bu azalma ile,", "skorlama verilerindeki bu düzelme ile,", "belirti yükündeki bu sayısal düşüşle,", "morfolojik verilerdeki bu iyileşme ile,"],
        "A2": ["epidermal bariyer onarımı sayesinde,", "keratinizasyon yolağındaki bu etkiyle,", "dermal doku yenilenmesi ile,", "melanosit aktivite kontrolü sayesinde,", "bariyer fonksiyonu desteği ile,", "hücre yenilenme hızı sayesinde,", "doku bütünlüğü yolağı ile,", "inflamasyon baskılama mekanizmasıyla,", "vasküler geçirgenlik kontrolü ile,", "kolajen sentezi desteği sayesinde,"],
        "A3": ["cilt toleransındaki bu yüksek profil ile,", "topikal uygulama konforu sayesinde,", "tahriş riskindeki bu azalma ile,", "hassas cilt uyumu sayesinde,", "deri emniyet tablosu ile,", "advers etki azlığı sayesinde,", "uygulama güvenliği ile,", "uzun süreli kullanım emniyetiyle,", "cilt bariyeri koruması sayesinde,", "kaşıntı kontrolündeki bu rahatlıkla,"],
        "A4": ["sürüm kolaylığı sunan bu form ile,", "emilim hızındaki bu avantaj sayesinde,", "günlük uygulama pratikliği ile,", "leke bırakmayan bu yapı sayesinde,", "kullanım konforu sunan bu doku ile,", "hızlı kuruma özelliği sayesinde,", "zahmetsiz uygulama protokolü ile,", "hasta uyumunu artıran bu pratiklikle,", "bakım rutinini kolaylaştıran bu formla,", "uygulama hızındaki bu artış sayesinde,"]
      },
      "G": {
        "A1": ["hormon seviyelerindeki bu denge ile,", "siklus düzenindeki bu başarı sayesinde,", "infertilite skorlarındaki bu artışla,", "ovülasyon parametreleri sayesinde,", "vajinal pH değerindeki bu düzelme ile,", "laboratuvar verilerindeki bu stabiliteyle,", "hCG değerlerindeki bu hedeflenen artışla,", "folikül gelişim hızı sayesinde,", "endometrial kalınlık ölçümü ile,", "hormonal profil regülasyonu sayesinde,"],
        "A2": ["reseptör duyarlılığındaki bu artışla,", "hipofiz-gonad aksı kontrolü sayesinde,", "endokrin yolaktaki bu düzenleme ile,", "hücresel sinyal iletimi sayesinde,", "sekresyon mekanizmasındaki bu dengeyle,", "vaskülarizasyon desteği sayesinde,", "folikülogenez yolağındaki bu etkiyle,", "matürasyon süreci kontrolü sayesinde,", "enzimatik dönüşüm desteği ile,", "biyokimyasal geribildirim mekanizmasıyla,"],
        "A3": ["jinekolojik konfor profilindeki bu artışla,", "tedaviye verilen bu emniyetli yanıtla,", "ilaç etkileşim riskindeki bu düşüklükle,", "gebelik sürecindeki bu güvenli tabloyla,", "metabolik profil koruması sayesinde,", "advers olay azlığı ile,", "idame sürecindeki bu stabiliteyle,", "genel sağlık tablosundaki bu uyumla,", "hasta psikolojisine yansıyan bu güvenle,", "klinik takipteki bu sorunsuz süreçle,"],
        "A4": ["dozaj rejimindeki bu basitlik sayesinde,", "kullanım uyumunu artıran bu form ile,", "günlük hayatı bölmeyen bu pratiklikle,", "uygulama hızı avantajı sayesinde,", "tedaviye katılım kolaylığı ile,", "kullanıcı dostu uygulama desteğiyle,", "takibi kolaylaştıran bu protokol sayesinde,", "formülasyon avantajı ile,", "hızlı yanıt alınan bu pratik süreçle,", "süreci yöneten bu teknik rahatlık sayesinde,"]
      },
      "H": {
        "A1": ["kan şekeri ölçümlerindeki bu stabilite sayesinde,", "HbA1c değerlerindeki bu hedeflenen düşüşle,", "glisemi kontrolünde sağlanan bu başarıyla,", "postprandiyal değerlerdeki bu iyileşme ile,", "insülin doz ihtiyacındaki bu regülasyonla,", "glukoz profilindeki bu sürdürülebilir dengeyle,", "laboratuvar sonuçlarına yansıyan bu kontrolle,", "metabolik değerlerdeki bu iyileşme trendiyle,", "idrar glukoz seviyesindeki bu azalma ile,", "vücut ağırlığı kontrolündeki bu sayısal başarıyla,"],
        "A2": ["insülin sinyal iletimindeki bu artış sayesinde,", "pankreatic beta hücre desteği ile,", "glukoz metabolizmasındaki bu düzenleme ile,", "hepatik glukoz üretimindeki bu kontrolle,", "periferic dirençteki bu azalma sayesinde,", "inkretin yolağındaki bu fizyolojic etkiyle,", "alfa-glukozidaz inhibisyonu sayesinde,", "reseptör duyarlılığındaki bu moleküler artışla,", "metabolik yolağın yeniden dengelenmesi ile,", "enerji dengesindeki bu hücresel iyileşme sayesinde,"],
        "A3": ["hipoglisemi riskindeki bu belirgin azalma ile,", "kardiyovasküler güvenlik profilindeki bu artıya,", "renal fonksiyonlardaki bu koruyucu etki sayesinde,", "uzun vadeli kullanım emniyeti ile,", "kilo alım riskini azaltan bu güvenli yapıyla,", "tedaviye verilen bu sorunsuz toleransla,", "advers olay sıklığındaki bu düşüklük sayesinde,", "metabolik emniyet sınırları içindeki bu seyirle,", "hasta güvenini artıran bu yan etki profiliyle,", "idame sürecindeki bu sürdürülebilir emniyetle,"],
        "A4": ["enjeksiyon pratikliği sunan bu cihazlar sayesinde,", "oral kullanımın getirdiği bu dozaj kolaylığı ile,", "uygulama zamanlamasındaki bu esneklik sayesinde,", "günlük hayatı kolaylaştıran bu pratik süreçle,", "doz ayarlama basitliği sunan bu teknolojiyle,", "hasta eğitimini sadeleştiren bu yöntemle,", "takibi kolaylaştıran bu dijital entegrasyonla,", "hızlı etki başlangıcının sunduğu bu pratiklikle,", "kullanım bariyerlerini yıkan bu tasarım sayesinde,", "seyahatlerde sağlanan bu taşıma konforuyla,"]
      },
      "J": {
        "A1": ["bakteriyel klirensteki bu sayısal başarı sayesinde,", "enfeksiyon parametrelerindeki bu hızlı düşüşle,", "ateş tablosundaki bu kontrollü gerileme ile,", "lökosit sayısındaki bu normalleşme sayesinde,", "CRP değerlerindeki bu anlamlı azalma ile,", "mikrobiyolojik eradikasyon oranındaki bu artışla,", "klinik yanıt süresindeki bu sayısal kısalma ile,", "semptom skorlarındaki bu hızlı toparlanma ile,", "laboratuvar verilerine yansıyan bu başarıyla,", "tedavi başarısını kanıtlayan bu ölçümlerle,"],
        "A2": ["bakterisid etki mekanizmasındaki bu güç sayesinde,", "hücre duvarı sentezindeki bu spesifik blokajla,", "protein sentezi inhibisyonu yolağı ile,", "DNA replikasyonundaki bu etkili durdurma sayesinde,", "geniş spektrumlu etkinin sunduğu bu güçle,", "bakteriyel enzim kontrolü sayesinde,", "dokulara nüfuz etme kabiliyetindeki bu etkiyle,", "direnç mekanizmasını kıran bu moleküler yapı sayesinde,", "hücre içi patojen kontrolündeki bu başarıyla,", "biyokimyasal düzeydeki bu eradikasyon gücüyle,"],
        "A3": ["mikrobiyota koruması sağlanan bu emniyetle,", "böbrek fonksiyonlarındaki bu güvenlik profiliyle,", "ilaç etkileşim riskindeki bu düşüklük sayesinde,", "alerjik reaksiyon riskini azaltan bu yapı ile,", "pediatrik ve geriyatrik kullanım emniyetiyle,", "idame sürecindeki bu yüksek tolerabilite sayesinde,", "tedaviye verilen bu sorunsuz klinik yanıtla,", "advers etki azlığının getirdiği bu konforla,", "uzun süreli kullanımdaki bu güvenli tabloyla,", "hasta takibini kolaylaştıran bu emniyetli süreçle,"],
        "A4": ["günde tek doz kullanım pratikliği sayesinde,", "aç/tok farkı gözetmeyen bu kullanım konforuyla,", "oral ve IV geçişindeki bu uygulama kolaylığı ile,", "hazırlama zahmetini bitiren bu hazır formlar sayesinde,", "tedavi süresini kısaltan bu hızlı protokol ile,", "yutma kolaylığı sunan bu tablet yapısı sayesinde,", "saklama koşullarındaki bu teknik rahatlıkla,", "hasta uyumunu artıran bu basitlik sayesinde,", "evde tedavi imkanını artıran bu pratiklikle,", "sağlık personeli yükünü azaltan bu süreçle,"]
      },
      "L": {
        "A1": ["tümör hacmindeki bu sayısal azalma sayesinde,", "proliferasyon indeksindeki bu düşüş ile,", "marker seviyelerindeki bu anlamlı gerileme ile,", "sağkalım verilerindeki bu pozitif artışla,", "laboratuvar bulgularındaki bu net düzelme sayesinde,", "radyolojik verilerdeki bu iyileşme ile,", "remisyon oranındaki bu sayısal artış sayesinde,", "hastalık yükündeki bu ölçülebilir azalma ile,", "performans skorlarındaki bu sayısal artışla,", "tedavi yanıtını gösteren bu veriler ışığında,"],
        "A2": ["sitostatik etki mekanizması sayesinde,", "apoptozis yolağındaki bu tetikleme ile,", "anjiyogenez blokajındaki bu hedeflenmiş etkiyle,", "sinyal iletim yolağı kontrolü sayesinde,", "hücre döngüsü arresti yaratan bu etkiyle,", "moleküler düzeydeki bu hedefe yönelik saldırıyla,", "enzimatic inhibisyon yolağındaki bu başarıyla,", "bağışıklık sistemi modülasyonu sayesinde,", "DNA tamir mekanizması blokajı ile,", "hücresel düzeydeki bu seçici aktivite sayesinde,"],
        "A3": ["yaşam kalitesini koruyan bu destek sayesinde,", "yan etki yönetimindeki bu yüksek başarı ile,", "organ fonksiyonlarını koruyan bu emniyetli profille,", "uzun süreli kullanım toleransı sayesinde,", "hematolojik toksisiteyi azaltan bu yapı ile,", "tedaviye devamlılığı artıran bu konfor sayesinde,", "hasta psikolojisine yansıyan bu güvenle,", "advers olay kontrolündeki bu stabilite ile,", "genel sağlık profilindeki bu korunan denge sayesinde,", "klinik takipteki bu güven odaklı süreçle,"],
        "A4": ["evde tedavi imkanı sunan oral formlar sayesinde,", "uygulama sıklığındaki bu rasyonel azalma ile,", "hazırlık sürecindeki bu teknik güvenlik desteğiyle,", "doz ayarlama kolaylığı sunan bu sistemler sayesinde,", "hasta uyumunu maksimize eden bu pratiklikle,", "hastanede kalış süresini azaltan bu süreç sayesinde,", "tedavi yönetimindeki bu operasyonel rahatlıkla,", "günlük rutine izin veren bu uygulama konforuyla,", "takibi kolaylaştıran bu dijital çözümler sayesinde,", "süreci sadeleştiren bu kullanıcı dostu yapı ile,"]
      },
      "M": {
        "A1": ["eklem açıklığı ölçümlerindeki bu artış sayesinde,", "ağrı skorlarındaki bu hedeflenen düşüşle,", "mobilite katsayısındaki bu sayısal iyileşme ile,", "inflamasyon markerlarındaki bu azalma sayesinde,", "kemik mineral yoğunluğundaki bu artışla,", "yürüme mesafesindeki bu sayısal gelişim sayesinde,", "laboratuvar verilerine yansıyan bu toparlanma ile,", "fiziksel performans testlerindeki bu başarıyla,", "aktivite puanlarındaki bu anlamlı artış sayesinde,", "klinik parametrelerdeki bu stabilizasyon ile,"],
        "A2": ["kıkırdak doku onarım yolağı sayesinde,", "sinoviyal sıvı regülasyonundaki bu etkiyle,", "osteoklast aktivite kontrolü sayesinde,", "nöromüsküler iletimdeki bu düzenleme ile,", "inflamatuar sitokin blokajı sayesinde,", "kas lifi aktivasyonundaki bu moleküler etkiyle,", "kemik döngüsü mekanizmasındaki bu dengeyle,", "kolajen sentezi yolağındaki bu destek sayesinde,", "biyokimyasal düzeydeki bu doku korumasıyla,", "mekanik direnci artıran bu yapısal etki sayesinde,"],
        "A3": ["mide koruyucu etkinin sunduğu bu emniyetle,", "böbrek fonksiyonlarındaki bu güvenli profil sayesinde,", "kardiyovasküler risk azaltan bu yapı ile,", "uzun süreli kullanım toleransı sayesinde,", "yaşam kalitesini artıran bu genel konforla,", "tedaviye verilen bu sorunsuz klinik yanıt sayesinde,", "hareket serbestliği sunan bu yan etki azlığıyla,", "idame sürecindeki bu yüksek emniyet tablosuyla,", "hasta takibindeki bu stabiliteyle,", "advers olay kontrolündeki bu profesyonel süreçle,"],
        "A4": ["lokal uygulama kolaylığı sunan bu formlar sayesinde,", "günde tek dozun getirdiği bu uyum avantajı ile,", "hareket kabiliyetini kısıtlamayan bu pratiklikle,", "hızlı etki başlangıcının sunduğu bu konfor sayesinde,", "kullanım dozajındaki bu basit ayarlama ile,", "hasta uyumunu artıran bu uygulama desteğiyle,", "tedaviye katılımı kolaylaştıran bu süreç sayesinde,", "hazırlama zahmeti olmayan bu hazır paketlerle,", "günlük rutinle barışık bu pratik protokol ile,", "yönetimi sadeleştiren bu teknik rahatlık ışığında,"]
      },
      "N": {
        "A1": ["nöbet sıklığındaki bu sayısal azalma sayesinde,", "kognitif test skorlarındaki bu artışla,", "uyku kalitesi ölçümlerindeki bu iyileşme ile,", "semptom şiddet skalasındaki bu gerileme sayesinde,", "laboratuvar verilerine yansıyan bu stabiliteyle,", "reaksiyon zamanındaki bu sayısal iyileşme ile,", "klinik puanlamadaki bu anlamlı başarı sayesinde,", "takip parametrelerindeki bu regülasyon ile,", "yaşam fonksiyonlarındaki bu sayısal artış sayesinde,", "verilerle kanıtlanan bu nörolojik toparlanma ile,"],
        "A2": ["sinaptik iletim yolağındaki bu düzenleme sayesinde,", "nörotransmitter dengesindeki bu fizyolojik etkiyle,", "iyon kanalı blokajındaki bu hassas kontrol sayesinde,", "kan-beyin bariyeri geçişindeki bu etkinlik sayesinde,", "reseptör düzeyindeki bu modülasyon ile,", "nöronal koruma mekanizması sayesinde,", "enzimatic süreçteki bu dengeli düzenleme ile,", "elektrofizyolojik yanıttaki bu stabilizasyonla,", "hücresel düzeydeki bu nöro-rejenerasyon desteğiyle,", "işleyiş mekanizmasındaki bu doğrudan kontrol ışığında,"],
        "A3": ["sedasyon kontrolü sağlanan bu emniyetli profille,", "ilaç etkileşim riskindeki bu düşüklük sayesinde,", "kognitif fonksiyonları koruyan bu yapı ile,", "uzun vadeli kullanım emniyeti sayesinde,", "tedaviye verilen bu yüksek tolerabilite ile,", "hasta takibindeki bu komplikasyonsuz süreç sayesinde,", "bağımlılık riskini minimize eden bu tabloyla,", "günlük performansa yansıyan bu güvenle,", "idame sürecindeki bu sürdürülebilir konfor sayesinde,", "advers etki azlığının getirdiği bu emniyetle,"],
        "A4": ["doz ayarlama pratikliği sunan bu formlar sayesinde,", "hızlı emilim ve etki başlangıcı ile,", "günlük rutinle uyumlu bu uygulama konforuyla,", "hasta uyumunu artıran bu dozaj basitliği ile,", "takibi kolaylaştıran bu dijital çözümler sayesinde,", "kullanım bariyerlerini yıkan bu tasarım sayesinde,", "sosyal hayata izin veren bu pratik protokol ile,", "tedavi yönetimindeki bu operasyonel rahatlıkla,", "süreci sadeleştiren bu teknik destek ışığında,", "hızlı yanıt alınan bu uygulama avantajı sayesinde,"]
      },
      "P": {
        "A1": ["parazit yükündeki bu sayısal azalma sayesinde,", "laboratuvar bulgularındaki bu net temizlenme ile,", "iyileşme oranlarındaki bu anlamlı artış sayesinde,", "klinik ölçümlere yansıyan bu hızlı eradikasyonla,", "tekrar enfeksiyon oranındaki bu düşüşle,", "verilerle kanıtlanan bu temizlenme başarısı sayesinde,", "parametrelerdeki bu regüle edici etki ile,", "skorlama verilerindeki bu iyileşme sayesinde,", "hızlı yanıt alınan bu ölçümler ışığında,", "takip sürecindeki bu sayısal stabilite ile,"],
        "A2": ["parazit yaşam döngüsündeki bu blokaj sayesinde,", "hücre zarı bütünlüğünü bozan bu etkiyle,", "enzimatic yolağın felç edilmesi sayesinde,", "sinir-kas iletimindeki bu parazitlere özel felçle,", "üreme mekanizmasının durdurulması sayesinde,", "biyokimyasal düzeydeki bu temizleme gücüyle,", "konakçı hücreyi koruyan bu seçici aktiviteyle,", "moleküler düzeydeki bu eradikasyon etkisiyle,", "enfestasyon yolağındaki bu doğrudan kontrolle,", "işleyişi bozan bu biyolojik bariyer sayesinde,"],
        "A3": ["sistemik emniyet profilindeki bu güvenle,", "organ fonksiyonlarındaki bu koruyucu etki sayesinde,", "pediatrik kullanımda sunulan bu yüksek toleransla,", "ilaç etkileşim azlığının sunduğu bu emniyetle,", "uzun süreli kullanım gerekirse sunulan bu güvenle,", "advers olay kontrolündeki bu başarı sayesinde,", "tedaviye verilen bu sorunsuz klinik yanıtla,", "hasta takibindeki bu komplikasyonsuz süreçle,", "emniyet sınırları içindeki bu stabilite sayesinde,", "idame periyodundaki bu güvenli tablo ışığında,"],
        "A4": ["hızlı eradikasyon sunan bu uygulama hızıyla,", "tek doz kullanımın getirdiği bu pratiklik sayesinde,", "hazırlama zahmeti olmayan bu form avantajıyla,", "evde kullanımı kolaylaştıran bu basit süreçle,", "yönetimi sadeleştiren bu teknik rahatlık sayesinde,", "hijyen rutinini destekleyen bu uygulama formuyla,", "hızlı etki başlangıcının sunduğu bu konforla,", "hasta uyumunu maksimize eden bu yöntem sayesinde,", "takibi kolaylaştıran bu basit protokol ile,", "süreci hızlandıran bu operasyonel basitlik sayesinde,"]
      },
      "R": {
        "A1": ["solunum hacmi ölçümlerindeki bu artış sayesinde,", "oksijen saturasyonundaki bu sayısal iyileşme ile,", "atak sıklığındaki bu anlamlı azalma sayesinde,", "laboratuvar verilerine yansıyan bu düzelme ile,", "egzersiz kapasitesi puanlarındaki bu artışla,", "klinik parametrelerdeki bu stabilizasyon sayesinde,", "akciğer fonksiyon testlerindeki bu başarıyla,", "balgam miktarındaki bu kontrollü azalma sayesinde,", "verilerle desteklenen bu solunum konforu ile,", "skorlama sonuçlarındaki bu iyileşme ışığında,"],
        "A2": ["bronşiyal dilatasyon yolağındaki bu başarı sayesinde,", "inflamasyon baskılama mekanizması ile,", "mukus klirensi desteğindeki bu fizyolojik etkiyle,", "alveolar gaz değişimindeki bu moleküler iyileşme ile,", "reseptör duyarlılığındaki bu artış sayesinde,", "yolağı temizleyen bu biyokimyasal etkiyle,", "mast hücre stabilizasyonu sayesinde,", "vasküler geçirgenlik kontrolü ile,", "düz kas gevşemesi yolağındaki bu doğrudan etkiyle,", "hücresel düzeydeki bu bariyer onarımı sayesinde,"],
        "A3": ["inhalasyon konforu sunan bu yüksek tolerans sayesinde,", "sistemic yan etki azlığındaki bu güvenlik profiliyle,", "kardiyac emniyeti koruyan bu yapı sayesinde,", "uzun süreli kullanım toleransı ile,", "yaşam kalitesini artıran bu solunum emniyetiyle,", "tedaviye verilen bu sorunsuz klinik yanıt sayesinde,", "hasta güvenini artıran bu yan etki profiliyle,", "advers olay kontrolündeki bu başarı sayesinde,", "idame periyodundaki bu stabil süreçle,", "genel sağlık tablosundaki bu korunan denge sayesinde,"],
        "A4": ["acil durumlarda sunulan bu hızlı kullanım avantajıyla,", "cihaz kullanım pratikliği sunan bu tasarımlarla,", "günde tek dozun getirdiği bu uyum sayesinde,", "hazırlık gerektirmeyen bu hazır inhaler formuyla,", "tedavi yönetimindeki bu operasyonel basitlikle,", "hızlı yanıt alınan bu pratik protokol sayesinde,", "taşınabilirliği kolaylaştıran bu kompakt yapı ile,", "hasta eğitimini sadeleştiren bu basit süreçle,", "uygulamayı kolaylaştıran bu teknik destekle,", "zaman kazandıran bu tedavi yaklaşımı ışığında,"]
      },
      "S": {
        "A1": ["görme keskinliği ölçümlerindeki bu artış sayesinde,", "oküler basınç değerlerindeki bu hedeflenen düşüşle,", "gözyaşı miktarındaki bu sayısal iyileşme ile,", "lezyon çapındaki bu anlamlı küçülme sayesinde,", "laboratuvar bulgularındaki bu net toparlanma ile,", "skorlama verilerine yansıyan bu başarı sayesinde,", "klinik ölçümlerdeki bu stabilizasyon ile,", "parametrelerdeki bu regüle edici etki ışığında,", "hızlı yanıt alınan bu sayısal veriler sayesinde,", "takip periyodundaki bu ölçülebilir iyileşme ile,"],
        "A2": ["oküler perfüzyon yolağındaki bu düzenleme sayesinde,", "kornea bariyer onarımı mekanizması ile,", "intraoküler basınç kontrol yolağı sayesinde,", "retinal hücre koruma etkisi ile,", "enzimatic süreçteki bu dengeli düzenleme sayesinde,", "biyokimyasal düzeydeki bu hedeflenmiş etkiyle,", "aköz humor dinamiğindeki bu stabilizasyonla,", "inflamatuar yolak blokajı sayesinde,", "moleküler düzeydeki bu emilim gücüyle,", "işleyiş mekanizmasındaki bu doğrudan kontrol sayesinde,"],
        "A3": ["kornea toleransındaki bu yüksek profil sayesinde,", "oküler emniyet sınırlarındaki bu güvenli seyirle,", "sistemic emilim riskindeki bu belirgin düşüşle,", "uzun vadeli kullanımdaki bu güvenli tablo sayesinde,", "tedaviye verilen bu sorunsuz klinik yanıtla,", "yaşam kalitesini artıran bu oküler konfor sayesinde,", "advers etki azlığının getirdiği bu emniyetle,", "hasta güvenini artıran bu yan etki profiliyle,", "idame sürecindeki bu sürdürülebilir konforla,", "genel sağlık tablosundaki bu korunan denge ışığında,"],
        "A4": ["damlatma pratikliği sunan bu şişe tasarımları sayesinde,", "günde tek uygulama konforu ile,", "hızlı emilim avantajı sunan bu formülasyon sayesinde,", "bulanıklık yapmayan bu yapı ile,", "hazırlama gerektirmeyen bu pratik süreçle,", "tedaviye katılımı artıran bu dozaj basitliği ile,", "takibi kolaylaştıran bu kullanıcı dostu yöntemle,", "sosyal hayata engel olmayan bu uygulama hızıyla,", "süreci sadeleştiren bu teknik destek sayesinde,", "yönetimi kolaylaştıran bu operasyonel rahatlık ışığında,"]
      }
    },

    // DÜZELTİLMİŞ connectWithCause FONKSİYONU
    connectWithCause(problem, etki, atcCode) {
      // 1. Parametreleri güvenli hale getir ve kontrol et
      const safeProblem = problem && typeof problem === 'string' ? problem.trim() : '';
      const safeEtki = etki && typeof etki === 'string' ? etki.trim() : '';
      
      // 2. Eğer birisi boşsa, direkt birleştir
      if (!safeProblem || !safeEtki) {
        const result = `${safeProblem} ${safeEtki}`.trim();
        return result === 'undefined' ? '' : result;
      }
      
      // 3. Kategoriyi belirle
      const cat = this.detectCategory(safeProblem, safeEtki);
      
      // 4. Doğru connector havuzunu seç
      const branchPool = this.DynamicConnectors[atcCode] || this.DynamicConnectors["A"];
      const connectorPool = branchPool[cat] || branchPool["A4"];
      
      // 5. Random connector seç
      const randomConnector = connectorPool[Math.floor(Math.random() * connectorPool.length)];
      
      // 6. PROBLEM ve ETKİ arasında doğal bağlantı kur
      const simpleConnectors = ["sebebiyle", "nedeniyle", "yüzünden", "ile", "sonucunda"];
      const simpleConnector = simpleConnectors[Math.floor(Math.random() * simpleConnectors.length)];
      
      // 7. İlk harfi büyük yap
      const problemFormatted = safeProblem.charAt(0).toUpperCase() + safeProblem.slice(1);
      const etkiFormatted = safeEtki.charAt(0).toUpperCase() + safeEtki.slice(1);
      
      // 8. Final metni oluştur
      let finalText = '';
      
      // "undefined" kontrolü ve temizleme
      if (problemFormatted.includes('undefined') || etkiFormatted.includes('undefined')) {
        // Eğer undefined varsa, sadece problem ve etkiyi birleştir
        finalText = `${problemFormatted.replace(/undefined/gi, '')} ${simpleConnector} ${etkiFormatted.replace(/undefined/gi, '')}`.trim();
      } else {
        // Normal durum
        finalText = `${problemFormatted} ${simpleConnector} ${etkiFormatted}`;
      }
      
      return finalText;
    }
  };

  </script>

  <script src="https://unpkg.com/pdfmake@0.2.7/build/pdfmake.min.js"></script>
  <script src="https://unpkg.com/pdfmake@0.2.7/build/vfs_fonts.js"></script>

  <style>
  /* ============================================
     CSS RESET ve TEMEL STİLLER
     ============================================ */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  :root {
    --bg: #ffffff;
    --text: #111;
    --muted: #666;
    --border: #e6e6e6;
    --soft: #fafafa;
    --accent: #0b5fff;
    --ok: #137333;
    --warn: #b06000;
    --bad: #b3261e;
    --shadow: 0 10px 30px rgba(0,0,0,0.06);
    --radius: 16px;
    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    --sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    --touch-target: 44px;
    --mobile-padding: 12px;
    --keyboard-safe: env(safe-area-inset-bottom, 0px);
  }

  body {
    font-family: var(--sans);
    background: var(--bg);
    color: var(--text);
    line-height: 1.5;
    font-size: 14px;
    padding: 0;
    margin: 0;
    min-height: 100vh;
    overflow-x: hidden;
  }

  .container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 20px;
  }

  /* ============================================
     BAŞLIK ve ÜST BÖLÜM
     ============================================ */
  header {
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border);
  }

  header h1 {
    font-size: 24px;
    margin-bottom: 8px;
    color: var(--accent);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .sub {
    color: var(--muted);
    font-size: 12px;
    margin-bottom: 15px;
  }

  .badgeRow {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 15px;
  }

  .pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
    white-space: nowrap;
  }

  .pill.soft {
    background: var(--soft);
    border: 1px solid var(--border);
    color: var(--muted);
  }

  .pill.ok {
    background: #ecfdf3;
    border: 1px solid #bbf7d0;
    color: #166534;
  }

  .pill.warn {
    background: #fffbeb;
    border: 1px solid #fed7aa;
    color: #92400e;
  }

  .pill.bad {
    background: #fef2f2;
    border: 1px solid #fecaca;
    color: #b91c1c;
  }

  /* ============================================
     AKORDEON (DETAILS) STİLLERİ
     ============================================ */
  .acc {
    background: white;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    margin-bottom: 20px;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .acc[open] {
    box-shadow: var(--shadow);
  }

  .acc summary {
    list-style: none;
    padding: 20px;
    cursor: pointer;
    background: var(--soft);
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 15px;
  }

  .acc summary::-webkit-details-marker {
    display: none;
  }

  .accTitle {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 5px;
  }

  .accTitle b {
    font-size: 16px;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .accTitle span {
    font-size: 13px;
    color: var(--muted);
    line-height: 1.4;
  }

  .accMeta {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-shrink: 0;
  }

  .tag {
    background: var(--accent);
    color: white;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
  }

  .arrow {
    transition: transform 0.3s ease;
    display: inline-block;
  }

  .acc[open] .arrow {
    transform: rotate(90deg);
  }

  .accBody {
    padding: 20px;
    border-top: 1px solid var(--border);
    background: white;
  }

  /* ============================================
     FORMLAR ve ALANLAR
     ============================================ */
  .fieldRow {
    margin-bottom: 20px;
  }

  .fieldRow:last-child {
    margin-bottom: 0;
  }

  label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text);
    font-size: 14px;
  }

  .small {
    font-size: 12px;
    color: var(--muted);
    margin-top: 4px;
    display: block;
  }

  input[type="text"],
  textarea {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid var(--border);
    border-radius: 10px;
    font-family: var(--sans);
    font-size: 14px;
    transition: all 0.2s ease;
    background: white;
  }

  input[type="text"]:focus,
  textarea:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(11, 95, 255, 0.1);
  }

  textarea {
    min-height: 100px;
    resize: vertical;
    line-height: 1.5;
  }

  .hint {
    font-size: 13px;
    color: var(--muted);
    margin-bottom: 10px;
    display: block;
  }

  .notice {
    background: #eff6ff;
    border: 1px solid #dbeafe;
    border-radius: 8px;
    padding: 10px 12px;
    font-size: 13px;
    margin-top: 8px;
    color: #1e40af;
  }

  /* ============================================
     CPR BÖLÜMLERİ
     ============================================ */
  .cpr-section-card {
    background: white;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    position: relative;
  }

  .cpr-section-card:last-child {
    margin-bottom: 0;
  }

  .claim-group {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .claim-step {
    flex: 1;
  }

  .claim-step.problem {
    border-bottom: 1px solid var(--border);
    padding-bottom: 15px;
  }

  .textarea-wrapper {
    position: relative;
    margin-top: 8px;
  }

  .voice-btn {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: var(--soft);
    border: 1px solid var(--border);
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .voice-btn:hover {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  .voice-btn.listening {
    background: #ef4444;
    color: white;
    border-color: #ef4444;
    animation: pulse 1s infinite;
  }

  .hint-box {
    background: var(--soft);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px;
    margin-top: 12px;
    font-size: 13px;
    color: var(--muted);
    display: none;
  }

  .hint-box.show {
    display: block;
  }

  .fieldTools {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 15px;
  }

  /* ============================================
     BUTONLAR
     ============================================ */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 500;
    border: 1px solid transparent;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    white-space: nowrap;
  }

  .btn.primary {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  .btn.primary:hover {
    background: #1d4ed8;
    border-color: #1d4ed8;
  }

  .btn.ghost {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
  }

  .btn.ghost:hover {
    background: var(--soft);
    border-color: var(--accent);
    color: var(--accent);
  }

  .btn.small {
    padding: 4px 10px;
    font-size: 12px;
  }

  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* ============================================
     STİL CPR KARTLARI
     ============================================ */
  .styleGrid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }

  .styleCard {
    background: white;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .styleHeader {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 10px;
  }

  .styleTitle {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 4px;
  }

  .styleBadge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 8px;
    background: var(--soft);
    border-radius: 12px;
    font-size: 11px;
  }

  .styleBody {
    font-size: 13px;
    color: var(--muted);
    line-height: 1.5;
  }

  .styleBody ul {
    padding-left: 20px;
    margin-top: 8px;
  }

  .styleBody li {
    margin-bottom: 4px;
  }

  .feedback {
    padding: 10px;
    background: #f0f9ff;
    border-radius: 8px;
    font-size: 12px;
    border: 1px solid #bae6fd;
    color: #0369a1;
  }

  /* ============================================
     MOBİL ÖZELLİKLER
     ============================================ */
  .mobile-toolbar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    border-top: 1px solid var(--border);
    display: flex;
    overflow-x: auto;
    padding: 10px;
    gap: 8px;
    z-index: 1000;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
  }

  .mobile-toolbar button {
    flex-shrink: 0;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: white;
    cursor: pointer;
    font-size: 12px;
    white-space: nowrap;
  }

  .mobile-toolbar button.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  .draft-indicator {
    position: fixed;
    top: 15px;
    right: 15px;
    background: var(--accent);
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    z-index: 1000;
    cursor: pointer;
    box-shadow: var(--shadow);
  }

  .draft-indicator.saved {
    background: var(--ok);
  }

  .offline-status {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: #ef4444;
    color: white;
    padding: 10px;
    text-align: center;
    font-size: 13px;
    z-index: 1001;
    display: none;
  }

  .offline-status.offline {
    display: block;
    background: #ef4444;
  }

  .offline-status.online {
    display: block;
    background: var(--ok);
  }

  #mobileNotificationArea {
    position: fixed;
    bottom: 70px;
    left: 0;
    right: 0;
    z-index: 1000;
    padding: 10px;
    pointer-events: none;
  }

  .mobile-notification {
    background: white;
    border-radius: 10px;
    padding: 12px 16px;
    margin-bottom: 10px;
    box-shadow: var(--shadow);
    border-left: 4px solid var(--accent);
    display: flex;
    align-items: center;
    gap: 10px;
    pointer-events: auto;
    animation: slideIn 0.3s ease;
  }

  .mobile-notification.success {
    border-left-color: var(--ok);
  }

  .mobile-notification.error {
    border-left-color: var(--bad);
  }

  .mobile-notification.warning {
    border-left-color: var(--warn);
  }

  .mobile-notification .close-btn {
    margin-left: auto;
    background: none;
    border: none;
    font-size: 18px;
    cursor: pointer;
    color: var(--muted);
  }

  /* ============================================
     DAVRANIŞ ve ÖĞRENME STİLİ
     ============================================ */
  .behavior-details {
    border: 1px solid var(--border);
    border-radius: 10px;
    margin-top: 8px;
  }

  .behavior-details summary {
    padding: 12px 16px;
    cursor: pointer;
    list-style: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .behavior-details summary::-webkit-details-marker {
    display: none;
  }

  .behavior-panel {
    padding: 15px;
    border-top: 1px solid var(--border);
  }

  .behavior-pills {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 15px;
  }

  .behavior-pill {
    padding: 6px 12px;
    background: var(--soft);
    border: 1px solid var(--border);
    border-radius: 20px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .behavior-pill.selected {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  .selected-behaviors {
    margin-top: 15px;
  }

  .selected-behaviors-title {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 8px;
  }

  .selected-behaviors-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .selected-behavior-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    background: #dbeafe;
    border-radius: 16px;
    font-size: 12px;
  }

  .selected-behavior-pill .remove {
    cursor: pointer;
    font-weight: bold;
    color: var(--bad);
  }

  .learning-style-pills {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 10px 0;
  }

  .learning-style-pill {
    padding: 8px 16px;
    border: 1px solid var(--border);
    border-radius: 20px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .learning-style-pill.selected {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  /* ============================================
     SOSYAL STİL PİLLERİ (YENİ)
     ============================================ */
  .social-style-pills {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
  }

  .pill-btn {
    padding: 8px 16px;
    border: 1px solid var(--border);
    border-radius: 20px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s ease;
    background: white;
    color: var(--text);
    user-select: none;
  }

  .pill-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  .pill-btn.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  .pill-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* ============================================
     ÜRÜN/RAKİP PİLLER
     ============================================ */
  .presetRow {
    background: var(--soft);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 20px;
  }

  .presetRowInner {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 15px;
  }

  .presetCard {
    flex: 1;
    min-width: 150px;
    background: white;
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
  }

  .activePreset {
    font-size: 13px;
    color: var(--muted);
    padding: 8px 0;
  }

  .kwWrap {
    display: flex;
    gap: 10px;
    margin-bottom: 8px;
  }

  .kwWrap input {
    flex: 1;
  }

  .removable.pill {
    padding-right: 8px;
    position: relative;
    cursor: pointer;
  }

  .removable .x {
    width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    margin-left: 4px;
    font-weight: bold;
    opacity: 0.7;
    transition: all 0.2s ease;
  }

  .removable .x:hover {
    opacity: 1;
    background: rgba(239, 68, 68, 0.2);
  }

  .removable.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  /* ============================================
     ANİMASYONLAR
     ============================================ */
  @keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
  }

  @keyframes slideIn {
    from {
      transform: translateY(20px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  /* ============================================
     RESPONSIVE (MOBİL) STİLLER
     ============================================ */
  @media (max-width: 768px) {
    .container {
      padding: 15px;
    }
    
    header h1 {
      font-size: 20px;
    }
    
    .styleGrid {
      grid-template-columns: 1fr;
    }
    
    .acc summary {
      flex-direction: column;
      gap: 10px;
    }
    
    .accMeta {
      align-self: flex-end;
    }
    
    .presetCard {
      min-width: 100%;
    }
    
    .cpr-section-card {
      padding: 15px;
    }
    
    .mobile-toolbar {
      display: flex;
    }
  }

  @media (max-width: 480px) {
    .pill {
      font-size: 11px;
      padding: 4px 8px;
    }
    
    .btn {
      padding: 6px 12px;
      font-size: 12px;
    }
    
    .styleCard {
      padding: 15px;
    }
  }
  </style>
</head>
<body>
  <!-- 📱 FAZ 3: GELİŞTİRİLMİŞ OFFLINE DURUM GÖSTERGESİ -->
  <div class="offline-status" id="offlineStatus">
    <span class="icon">📡</span>
    <span id="connectivityText">Çevrimdışı</span>
  </div>

  <!-- 📱 FAZ 1: MOBİL TOOLBAR -->
  <div class="mobile-toolbar" id="mobileToolbar">
    <button data-action="claim" title="Claim şablonu">📝 Claim</button>
    <button data-action="feature" title="Feature şablonu">⚙️ Feature</button>
    <button data-action="advantage" title="Advantage şablonu">🚀 Advantage</button>
    <button data-action="benefit" title="Benefit şablonu">✅ Benefit</button>
    <button data-action="recommendation" title="Recommendation şablonu">💡 Recommendation</button>
    <button data-action="copy" title="Kopyala">📋 Kopyala</button>
    <button data-action="paste" title="Yapıştır">📎 Yapıştır</button>
    <button data-action="clear" title="Temizle">🗑️ Temizle</button>
  </div>

  <!-- 📱 FAZ 2: DRAFT KAYIT GÖSTERGESİ -->
  <div class="draft-indicator" id="draftIndicator" title="Draft durumu">
    💾 Draft
  </div>

  <div class="container">
    <header>
      <div class="header-top">
        <div class="header-left">
          <h1>
            <span class="icon">🧠</span>
            FAST CPR KOÇU
          </h1>
          <div class="sub">FAST CPR Gelişmiş Araç</div>
        </div>
        <!-- 📄 YENİ TÜM RAPOR PDF BUTONU -->
        <div class="pdf-button-container">
          <button class="btn primary" id="fullReportPDF" title="Tüm çalışmayı PDF olarak indir">
            <span class="icon">📄</span>
            <span>Tüm Raporu PDF'e Aktar</span>
          </button>
        </div>
      </div>
      <div class="badgeRow">
        <div class="pill soft">
          <span class="icon">🔓</span>
          <span>Açık Sürüm v3.2026</span>
        </div>
        <div class="pill ok">
          <span class="icon">✅</span>
          <span>Temel CPR ≥ 13 ise stil CPR'ları aktifleşir</span>
        </div>
      </div>
    </header>
    
    <main>
      <!-- 1. SOSYAL STİL VE ÖĞRENME STİLİ TANIMLAMA KARTI (AKORDEON - AÇIK) -->
      <details class="acc" data-acc="preparation" id="acc_preparation" open>
        <summary>
          <div class="accTitle">
            <b><span class="arrow">▶</span> Sosyal Stil ve Öğrenme Stili Tanımlama</b>
            <span>Bu alanda kaydettiğiniz bilgileri zihinsel hazırlık içindir. Zorunlu değildir</span>
          </div>
          <div class="accMeta">
            <span class="tag">🎯 Hazırlık</span>
          </div>
        </summary>
        
        <div class="accBody">
          <div class="fieldRow">
            <label for="promoContext">Doktor / Eczacının Sosyal Stili <span class="small">(Lütfen <a href="https://iskendereser.github.io/S4Survey/" target="_blank" rel="noopener">FAST S4 Survey</a> kullanınız)</span></label>
            <input id="promoContext" type="hidden" value="" />
            <div class="social-style-pills" id="socialStylePills" aria-label="Sosyal stil seçimi">
              <button type="button" class="pill-btn" data-social-style="Analitik">Analitik</button>
              <button type="button" class="pill-btn" data-social-style="Yönlendirici">Yönlendirici</button>
              <button type="button" class="pill-btn" data-social-style="Canayakın">Canayakın</button>
              <button type="button" class="pill-btn" data-social-style="İfadeci">İfadeci</button>
            </div>
          </div>

          <div class="fieldRow">
            <label>
              Uyumlu Davranış Kriterleri 
              <span class="small">(Uyumlanma davranışlarınızı belirlemek için lütfen <a href="https://iskendereser.github.io/compare/" target="_blank" rel="noopener">FAST Compare</a> kullanınız)</span>
            </label>
            <details class="behavior-details" id="behaviorDetails">
              <summary>
                <span>Uyumlu Davranış Kriterleri Seçin</span>
                <span class="arrow" style="font-size: 12px; margin-left: 10px;">▶</span>
              </summary>
              <div class="behavior-panel">
                <div class="behavior-pills" id="behaviorPills">
                  <!-- Davranış pilleri JavaScript ile eklenecek -->
                </div>
                <div class="selected-behaviors">
                  <div class="selected-behaviors-title">Seçilen Davranışlar:</div>
                  <div class="selected-behaviors-list" id="selectedBehaviorsList">
                    <!-- Seçilen davranışlar buraya eklenecek -->
                  </div>
                </div>
              </div>
            </details>
            <div class="small">Birden fazla seçim yapabilirsiniz. Seçim sınırı yoktur.</div>
          </div>

          <div class="fieldRow">
            <label for="learningStyle">Öğrenme stilini belirleyiniz <span class="small">(Lütfen <a href="https://iskendereser.github.io/LSA/" target="_blank" rel="noopener">FAST LSA</a> kullanınız)</span></label>
            <div class="learning-style-pills" id="learningStylePills">
              <!-- Öğrenme stili pilleri JavaScript ile eklenecek -->
            </div>
            <input type="hidden" id="learningStyle" value="" />
          </div>
        </div>
      </details>
      
      <!-- 2. ÜRÜN-RAKİP-ÜSTÜNLÜKLER-HEDEF KARTI (AKORDEON - KAPALI) -->
      <details class="acc" data-acc="productprep" id="acc_productprep">
        <summary>
          <div class="accTitle">
            <b><span class="arrow">▶</span> Ürün-Rakip-Üstünlükler-Hedef</b>
            <span>Ürün → Rakip → Üstün Yön → Sunacağınız Fayda. Bu kart, aşağıdaki CPR yazımında "fener" gibi referans olsun diye vardır.</span>
          </div>
          <div class="accMeta">
            <span class="tag">🧭 Hazırlık</span>
            <div class="counters">
              <div class="counter">
                🧭 <span>Hazırlık</span>
              </div>
              <div class="counter">
                🧠 <span>Hatırlatıcı</span>
              </div>
            </div>
          </div>
        </summary>
        
        <div class="accBody">
          <div class="presetRow">
            <div class="presetRowInner">
              <div class="presetCard">
                <span class="icon">💊</span>
                <span>Ürün seç / ekle</span>
              </div>
              <div class="presetCard">
                <span class="icon">🏁</span>
                <span>Rakip seç / ekle</span>
              </div>
              <div class="presetCard">
                <span class="icon">⭐</span>
                <span>Üstün yön + fayda seç</span>
              </div>
            </div>
            <div class="activePreset" id="activeProductLabel" aria-live="polite">Seçilen ürün: —</div>
          </div>

          <!-- 1) ÜRÜN -->
          <div class="fieldRow">
            <label for="productNameInput">Ürün (ilk kullanımda elle yazın)</label>
            <div class="kwWrap">
              <input id="productNameInput" type="text" placeholder="Örn: Zoramisin" />
              <button class="btn ghost small kwAdd" id="addProductBtn" type="button">Ekle</button>
            </div>
            <div class="notice">İpucu: Ürün adları otomatik biçimlendirilir (ilk harf büyük). Daha sonra pill üzerinden tek dokunuşla seçebilirsiniz.</div>
            <div class="badgeRow" id="productPills" style="margin-top:8px;"></div>
          </div>

          <!-- 2) RAKİP -->
          <div class="fieldRow">
            <label for="competitorNameInput">Rakip (elle yazılır, kayıt olur)</label>
            <div class="kwWrap">
              <input id="competitorNameInput" type="text" placeholder="Örn: Rakip Ürün" />
              <button class="btn ghost small kwAdd" id="addCompetitorBtn" type="button">Ekle</button>
            </div>
            <div class="activePreset" id="activeCompetitorLabel" aria-live="polite">Seçilen rakip: —</div>
            <div class="badgeRow" id="competitorPills" style="margin-top:8px;"></div>
          </div>

          <!-- 3) ÜSTÜN YÖN -->
          <div class="fieldRow">
            <label for="superiorityInput">Üstün Yönünüz</label>
            <div class="hint">İstersen aşağıdaki hızlı seçeneklere dokun, istersen elle yaz.</div>
            <div class="badgeRow" id="superiorityPills"></div>
            <input id="superiorityInput" type="text" placeholder="Örn: Günde tek doz ile hasta uyumunu artırır" />
          </div>

          <!-- 4) SMART CPR HEDEFİ -->
          <div class="fieldRow">
            <label for="promoGoal">SMART CPR hedefinizi yazın</label>
            <textarea id="promoGoal" class="autoGrow" placeholder="Örn: Bu ziyarette X konuda Y ölçülebilir hedef..." rows="3"></textarea>
          </div>
        </div>
      </details>
      
      <!-- 3. TEMEL CPR KARTI (AKORDEON - KAPALI) -->
      <details class="acc" data-acc="base" id="acc_base">
        <summary>
          <div class="accTitle">
            <b><span class="arrow">▶</span> 1) Temel CPR (Stilsiz)</b>
            <span>Sadece CPR yapısı kontrol edilir. CPR ≥ 13 olunca stiller aktifleşir.</span>
          </div>
          <div class="accMeta">
            <span class="tag" id="mini_base">CPR: —</span>
            <button class="btn ghost small" id="btnSaveDraft">💾 Kaydet</button>
          </div>
        </summary>
        <div class="accBody">
          <p class="hint">Bu bölümde <b>stil değerlendirmesi yapılmaz</b>. </p>
          
          <!-- CLAIM ALANI -->
          <div class="cpr-section-card" data-section="claim">
            <div class="claim-group">
              <div class="claim-step problem">
                <label for="base_claim_problem">Problemi Tanımlayın:</label>
                <div class="textarea-wrapper">
                  <textarea id="base_claim_problem" placeholder="Klinik problemi yazın..."></textarea>
                  <button class="voice-btn" data-target="base_claim_problem" title="Sesli giriş">🎤</button>
                </div>
              </div>
              
              <div class="claim-step">
                <label for="base_claim_effect">Etkisini Tanımlayın:</label>
                <div class="textarea-wrapper">
                  <textarea id="base_claim_effect" placeholder="Bu problemin hasta, hekim veya süreç üzerindeki etkisini yazın..."></textarea>
                  <button class="voice-btn" data-target="base_claim_effect" title="Sesli giriş">🎤</button>
                </div>
              </div>
            </div>
            <div class="fieldTools">
              <button class="btn ghost small" id="clear_base_claim_problem">Temizle</button>
            </div>
          </div>
          
          <!-- PROPOSITION - ÖZELLİK -->
          <div class="cpr-section-card" data-section="feature">
            <label for="base_feat">Ürün adı ve problemi çözen temel özelliği yazın</label>
            <div class="textarea-wrapper">
              <textarea id="base_feat" placeholder="Örn: Ürün X, günde tek doz kullanım ile hasta uyumunu artırır"></textarea>
              <button class="voice-btn" data-target="base_feat" title="Sesli giriş">🎤</button>
            </div>
            <div class="hint-box" id="hint_base_feat">Ürününüzün rakiplerden farklı, hastaya sağladığı temel çözümü tanımlayın.</div>
            <div class="fieldTools">
              <button class="btn ghost small" id="clear_base_feat">Temizle</button>
            </div>
          </div>
          
          <!-- PROPOSITION - AVANTAJ -->
          <div class="cpr-section-card" data-section="advantage">
            <label for="base_adv">Rakiplere göre üstünlüğü, ticari isim kullanmadan yazın</label>
            <div class="textarea-wrapper">
              <textarea id="base_adv" placeholder="Örn: Bu sayede benzer etki gösterenlere göre günde tek doz kullanılır"></textarea>
              <button class="voice-btn" data-target="base_adv" title="Sesli giriş">🎤</button>
            </div>
            <div class="hint-box" id="hint_base_adv">Rakip ürünlerle karşılaştırma yapın, ancak rakip ismi kullanmayın.</div>
            <div class="fieldTools">
              <button class="btn ghost small" id="clear_base_adv">Temizle</button>
            </div>
          </div>
          
          <!-- PROPOSITION - FAYDA -->
          <div class="cpr-section-card" data-section="benefit">
            <label for="base_ben">Avantajın hastanın sorununu nasıl rahatlattığını yazın</label>
            <div class="textarea-wrapper">
              <textarea id="base_ben" placeholder="Örn: Tedavilerini aksatmadan devam ederler, işlerini yapmaktan geri kalmazlar"></textarea>
              <button class="voice-btn" data-target="base_ben" title="Sesli giriş">🎤</button>
            </div>
            <div class="hint-box" id="hint_base_ben">Hastanın günlük yaşamında nasıl bir iyileşme/rahatlama sağladığını açıklayın.</div>
            <div class="fieldTools">
              <button class="btn ghost small" id="clear_base_ben">Temizle</button>
            </div>
          </div>
          
          <!-- RECOMMENDATION -->
          <div class="cpr-section-card" data-section="recommendation">
            <label for="base_rec">Problemle ilişkilendirilmiş reçete öneri cümlenizi yazın</label>
            <div class="textarea-wrapper">
              <textarea id="base_rec" placeholder="Örn: Bu tür ataklarda, günde tek doz kullanılan X ile tedaviye bir an önce başlamayı tercih eder misiniz?"></textarea>
              <button class="voice-btn" data-target="base_rec" title="Sesli giriş">🎤</button>
            </div>
            <div class="hint-box" id="hint_base_rec">Hekimden bir aksiyon talep edin (reçeteleme, değiştirme, başlama vb.).</div>
            <div class="fieldTools">
              <button class="btn ghost small" id="clear_base_rec">Temizle</button>
            </div>
          </div>
          
          <div class="fieldTools" style="justify-content: space-between; margin-top: 20px;">
            <div>
              <button class="btn ghost small" id="btnLoadDraft" style="display: none;">📂 Draft Yükle</button>
              <button class="btn ghost small" id="btnShowDrafts">📋 Draft Listesi</button>
            </div>
            <div>
              <button class="btn ghost small" id="btnClearAllDrafts">🗑️ Tümünü Temizle</button>
            </div>
          </div>
        </div>
      </details>
      
      <!-- 📝 OTOMATİK CPR ÖZETİ BÖLÜMÜ -->
      <div class="cpr-section-card auto-cpr-section">
        <div class="section-label">
          <span class="icon">🤖</span> OTOMATİK CPR ÖZETİ
        </div>
        
        <label for="autoCPR">Birleştirilmiş CPR Metni</label>
        <div class="textarea-wrapper">
          <textarea id="autoCPR" placeholder="Claim → Özellik → Avantaj → Fayda → Recommendation birleşmiş CPR metni burada otomatik oluşur." readonly style="min-height: 120px; background-color: #f8fafc;"></textarea>
          <button class="voice-btn" data-target="autoCPR" title="Sesli düzenle">🎤</button>
        </div>
        
        <div class="fieldTools">
          <button class="btn primary small" id="generateAutoCPRBtn">✅ CPR Onay</button>
          <button class="btn ghost small" id="copyCPR">📋 CPR Kopyala</button>
        </div>
        
        <div class="hint-box show">
          <strong>🤖 Otomatik CPR Özeti:</strong> Tüm alanları doldurdukça, sistem "[Problem + Etki]... Bu nedenle [Özellik + Avantaj]. Böylece [Fayda]. Bu yüzden [Recommendation]" şeklinde tek bir CPR cümlesi oluşturur.
        </div>
      </div>
      
      <!-- 4. STİL BAZLI CPR'LAR KARTI (AKORDEON - KAPALI) -->
      <details class="acc" data-acc="styles" id="acc_styles">
        <summary>
          <div class="accTitle">
            <b><span class="arrow">▶</span> 2) Stil Bazlı CPR'lar</b>
            <span>Temel CPR'ı koruyarak hedef doktorun öğrenme stiline uyarlayın.</span>
          </div>
          <div class="accMeta">
            <span class="tag" id="mini_styles">4/4 stil kapalı</span>
          </div>
        </summary>
        
        <div class="accBody">
          <div class="styleGrid" id="styleGrid">
            <!-- Aktivist -->
            <div class="styleCard" data-style="activist" id="activistCard">
              <div class="styleHeader">
                <div>
                  <div class="styleTitle">Aktivist (Değişimci)</div>
                  <div class="styleBadge">
                    <span class="icon">🔥</span>
                    <span>Yeni, deneyimsel, hızlı</span>
                  </div>
                </div>
                <button class="btn small ghost" data-copy-base-to-style="activist">Temel CPR'ı Kopyala</button>
              </div>
              <div class="styleBody">
                Aktivist için vurgu: <b>yeni deneyim, hızlı sonuç, hareket</b>.
                <ul>
                  <li>• İlk cümle: Probleme hızlı giriş</li>
                  <li>• İkinci cümle: Etkiyi dramatize et</li>
                  <li>• Son cümle: "Hemen" vurgulu Recommendation</li>
                </ul>
              </div>
              <div class="textarea-wrapper">
                <textarea class="styled-cpr-area" data-style="activist" id="activist_cpr" placeholder="Stile aktar butonuna basın veya buraya yazın... Aktivist CPR için: hızlı, dinamik, aksiyon odaklı ifadeler kullanın." disabled></textarea>
                <button class="voice-btn" data-target="activist_cpr" title="Sesli düzenle" disabled>🎤</button>
              </div>
              <div class="feedback styleFeedback">
                <b>Geri bildirim:</b> Temel CPR ≥ 13 olduğunda bu stil için koçluk mesajları aktifleşecek.
              </div>
            </div>
            
            <!-- Reflektör -->
            <div class="styleCard" data-style="reflector" id="reflectorCard">
              <div class="styleHeader">
                <div>
                  <div class="styleTitle">Reflektör (Dikkatli Gözlemci)</div>
                  <div class="styleBadge reflector">
                    <span class="icon">👁️</span>
                    <span>Önce gözlem, sonra karar</span>
                  </div>
                </div>
                <button class="btn small ghost" data-copy-base-to-style="reflector">Temel CPR'ı Kopyala</button>
              </div>
              <div class="styleBody">
                Reflektör için vurgu: <b>veri, gözlem, sakin analiz</b>.
                <ul>
                  <li>• İlk cümle: Problemi tablo gibi betimle</li>
                  <li>• İkinci cümle: Etkiyi gözleme dayalı anlat</li>
                  <li>• Son cümle: "Düşündüğünüzde..." ile Recommendation</li>
                </ul>
              </div>
              <div class="textarea-wrapper">
                <textarea class="styled-cpr-area" data-style="reflector" id="reflector_cpr"
                  placeholder="Stile aktar butonuna basın veya buraya yazın... Reflektör CPR için: sakin, gözleme dayalı, veri referanslı ifadeler kullanın." 
                  disabled></textarea>
                <button class="voice-btn" data-target="reflector_cpr" title="Sesli düzenle" disabled>🎤</button>
              </div>
              <div class="feedback styleFeedback">
                <b>Geri bildirim:</b> Temel CPR ≥ 13 olduğunda bu stil için koçluk mesajları aktifleşecek.
              </div>
            </div>
            
            <!-- Teorist -->
            <div class="styleCard" data-style="theorist" id="theoristCard">
              <div class="styleHeader">
                <div>
                  <div class="styleTitle">Teorist (Sistematik Düşünen)</div>
                  <div class="styleBadge theorist">
                    <span class="icon">📐</span>
                    <span>Kılavuz, mekanizma, sebep-sonuç</span>
                  </div>
                </div>
                <button class="btn small ghost" data-copy-base-to-style="theorist">Temel CPR'ı Kopyala</button>
              </div>
              <div class="styleBody">
                Teorist için vurgu: <b>kılavuz, mekanizma, rasyonel gerekçe</b>.
                <ul>
                  <li>• İlk cümle: Problemi tanı-tedavi ilişkisiyle aç</li>
                  <li>• İkinci cümle: Etkiyi patofizyoloji ile ilişkilendir</li>
                  <li>• Son cümle: Kılavuz uyumu vurgulu Recommendation</li>
                </ul>
              </div>
              <div class="textarea-wrapper">
                <textarea class="styled-cpr-area" data-style="theorist" id="theorist_cpr"
                  placeholder="Stile aktar butonuna basın veya buraya yazın... Teorist CPR için: sistematik, kılavuz referanslı ve mekanizma temelli ifadeler kullanın." 
                  disabled></textarea>
                <button class="voice-btn" data-target="theorist_cpr" title="Sesli düzenle" disabled>🎤</button>
              </div>
              <div class="feedback styleFeedback">
                <b>Geri bildirim:</b> Temel CPR ≥ 13 olduğunda bu stil için koçluk mesajları aktifleşecek.
              </div>
            </div>
            
            <!-- Pragmatist -->
            <div class="styleCard" data-style="pragmatist" id="pragmatistCard">
              <div class="styleHeader">
                <div>
                  <div class="styleTitle">Pragmatist (Uygulamacı)</div>
                  <div class="styleBadge pragmatist">
                    <span class="icon">🛠️</span>
                    <span>Pratik, uygulanabilir, "işe yarar mı?"</span>
                  </div>
                </div>
                <button class="btn small ghost" data-copy-base-to-style="pragmatist">Temel CPR'ı Kopyala</button>
              </div>
              <div class="styleBody">
                Pragmatist için vurgu: <b>pratiklik, iş akışı, kolaylık</b>.
                <ul>
                  <li>• İlk cümle: Problemi günlük pratikten örnekle</li>
                  <li>• İkinci cümle: Etkiyi iş yükü ve süreklilikle bağla</li>
                  <li>• Son cümle: Rutin pratiğe nasıl oturduğunu anlatan Recommendation</li>
                </ul>
              </div>
              
              <div class="textarea-wrapper">
                <textarea class="styled-cpr-area" data-style="pragmatist" id="pragmatist_cpr"
                  placeholder="Stile aktar butonuna basın veya buraya yazın... Pragmatist CPR için: Pratik, uygulanabilir, 'nasıl yapılır' odaklı ifadeler kullanın." 
                  disabled></textarea>
                <button class="voice-btn" data-target="pragmatist_cpr" title="Sesli düzenle" disabled>🎤</button>
              </div>
              
              <div class="feedback styleFeedback">
                <b>Geri bildirim:</b> Temel CPR ≥ 13 olduğunda bu stil için koçluk mesajları aktifleşecek.
              </div>
            </div>
          </div>
        </div>
      </details>
    </main>
  </div>
  
  <!-- 📱 FAZ 2: MOBİL BİLDİRİM ALANI -->
  <div id="mobileNotificationArea"></div>
  
  <!-- JAVASCRIPT KODU -->
  <script>
  // ============================================
  // 🤖 YENİ AUTO CPR GENERATOR (FIXCAUSEFORM + COMPROMISE.JS)
  // ============================================
  
  const AutoCPRGenerator = {
    init: function() {
      const btn = document.getElementById('generateAutoCPRBtn');
      if (btn) {
        btn.addEventListener('click', () => {
          this.updateAutoCPR();
          showMobileNotification('🤖 Otomatik CPR oluşturuldu ve onaylandı!', 'success');
        });
      }

      // Diğer textarea'lar için input event'leri
      const textareas = [
        'base_claim_problem', 'base_claim_effect', 
        'base_feat', 'base_adv', 'base_ben', 'base_rec'
      ];
      
      textareas.forEach(id => {
        const textarea = document.getElementById(id);
        if (textarea) {
          textarea.addEventListener('input', () => {
            this.updateAutoCPR();
          });
        }
      });

      // Başlangıçta bir kere güncelle
      setTimeout(() => {
        this.updateAutoCPR();
      }, 500);

      console.log('✅ YENİ AutoCPRGenerator (fixCauseForm + Compromise.js) hazır');
    },

    updateAutoCPR: function() {
      const problem = document.getElementById('base_claim_problem')?.value.trim() || '';
      const effect = document.getElementById('base_claim_effect')?.value.trim() || '';
      const feature = document.getElementById('base_feat')?.value.trim() || '';
      const advantage = document.getElementById('base_adv')?.value.trim() || '';
      const benefit = document.getElementById('base_ben')?.value.trim() || '';
      const recommendation = document.getElementById('base_rec')?.value.trim() || '';
      
      const productState = ProductPrep.getState();
      const productName = productState.activeProduct || '';

      const autoCPRText = this.generate(problem, effect, feature, advantage, benefit, recommendation, productName);
      
      const textarea = document.getElementById('autoCPR');
      if (textarea) {
        textarea.value = autoCPRText;
      }
    },

    // ============================================
    // FIXCAUSEFORM FONKSİYONU (Türkçe düzeltmeler)
    // ============================================
    fixCauseForm: function(etki) {
      if (!etki || typeof etki !== 'string') return '';
      
      let text = etki.trim().toLowerCase();
      
      // Temel düzeltmeler sözlüğü
      const fixes = {
        // Fiil çekim hataları
        'sınırlandırıyor': 'sınırlandırmasına',
        'azılr': 'azalmasına',
        'ağrıyor': 'ağrımasına',
        'zorlaştırıyor': 'zorlaştırmasına',
        'kısıtlıyor': 'kısıtlamasına',
        'engelliyor': 'engellemesine',
        'artırıyor': 'artırmasına',
        'azaltıyor': 'azaltmasına',
        'gelişiyor': 'gelişmesine',
        'ilerliyor': 'ilerlemesine',
        
        // Yanlış yazımlar
        'yaşamasına': 'yaşamalarına',
        'yapamasına': 'yapamamalarına',
        'edemesine': 'edememelerine',
        'gidemesine': 'gidememelerine',
        'çalışamasına': 'çalışamamalarına',
        
        // Genel hatalar
        'çekmek': 'çekmelerine',
        'yaşamak': 'yaşamalarına',
        'olmak': 'olmalarına',
        'etmek': 'etmelerine',
        'yapmak': 'yapmalarına'
      };

      // Düzeltme uygula
      Object.keys(fixes).forEach(wrong => {
        if (text.includes(wrong)) {
          text = text.replace(wrong, fixes[wrong]);
        }
      });

      // Compromise.js ile fiil analizi (eğer yüklüyse)
      if (typeof nlp !== 'undefined') {
        try {
          const doc = nlp(text);
          const verbs = doc.verbs();
          
          if (verbs.length > 0) {
            // Fiili mastar haline getir
            const infinitive = verbs.toInfinitive().text();
            
            // Mastardan doğru çekim yap
            if (infinitive) {
              const lastChar = infinitive[infinitive.length - 1];
              const secondLastChar = infinitive[infinitive.length - 2];
              
              // Türkçe fiil çekim kuralları
              if (infinitive.endsWith('mak') || infinitive.endsWith('mek')) {
                const root = infinitive.slice(0, -3);
                const vowels = 'aeıioöuü';
                const lastVowel = root.split('').reverse().find(c => vowels.includes(c));
                
                if (lastVowel) {
                  if ('aıou'.includes(lastVowel)) {
                    text = root + 'masına';
                  } else {
                    text = root + 'mesine';
                  }
                }
              }
            }
          }
        } catch (error) {
          console.warn('Compromise.js analiz hatası:', error);
          // Hata durumunda basit düzeltmelerle devam et
        }
      }

      // İlk harfi büyük yap ve döndür
      return text.charAt(0).toUpperCase() + text.slice(1);
    },

    generate: function(problem, effect, feature, advantage, benefit, recommendation) {
      // ============================
      // Helpers (TR-safe)
      // ============================
      const cleanEndPunct = (s) => {
        if (!s) return "";
        let t = s.trim();

        // Çoklu nokta / gereksiz tekrarlar
        t = t.replace(/\s+/g, " ").replace(/\.+\s*\.+/g, "."); // .. .. gibi
        t = t.replace(/\.\.+$/g, "."); // "..." -> "."
        t = t.replace(/\?\?+$/g, "?"); // "??" -> "?"
        t = t.replace(/\!\!+$/g, "!"); // "!!" -> "!"

        return t;
      };

      const capitalizeTR = (s) => {
        if (!s) return "";
        const t = s.trim();
        if (!t) return "";
        return t.charAt(0).toLocaleUpperCase("tr-TR") + t.slice(1);
      };

      const ensureSentenceEnd = (s) => {
        if (!s) return "";
        const t = cleanEndPunct(s).trim();
        if (!t) return "";
        return (t.endsWith(".") || t.endsWith("?") || t.endsWith("!")) ? t : (t + ".");
      };

      // ============================
      // 1) Claim (Problem + Etki) — Yeni şablon
      // ============================
      const p = cleanEndPunct(problem);
      const e = cleanEndPunct(effect);

      let claim = "";
      if (p && e) {
        // TGE.connectWithCause kullanarak problem ve etkiyi birleştir
        // Önce ATC kodunu tahmin et
        const atcCode = TGE.guessATCCode(p + " " + e);
        const connected = TGE.connectWithCause(p, e, atcCode);
        claim = "Klinik pratiğinizde " + connected + " hastalarınızda...";
      } else if (p) {
        claim = p;
      } else if (e) {
        claim = e;
      }

      // Claim akışı: Feature varsa virgülle bağla, yoksa cümleyi bitir
      const hasFeature = !!cleanEndPunct(feature);
      let claimOut = "";
      if (claim) {
        const base = capitalizeTR(claim.replace(/[.?!]+$/g, "").trim());
        claimOut = hasFeature ? (base.replace(/[,;:]$/g, "") + ",") : ensureSentenceEnd(base);
      }

      // ============================
      // 2) Feature, Advantage, Benefit, Recommendation işleme
      // ============================
      const processLine = (text) => {
        if (!text) return "";
        let line = cleanEndPunct(text);
        return capitalizeTR(ensureSentenceEnd(line));
      };

      const output = [];
      if (claimOut) {
        const c = String(claimOut).replace(/[.…]+$/g, "").replace(/[.?!]+$/g, "").trim();
        output.push(c.endsWith(",") ? c : (c + ","));
      }

      // Feature
      const featureLine = processLine(feature);
      if (featureLine) output.push(featureLine);

      // Advantage
      const advLine = processLine(advantage);
      if (advLine) output.push(advLine);

      // Benefit
      const benLine = processLine(benefit);
      if (benLine) output.push(benLine);

      // Recommendation
      const recLine = processLine(recommendation);
      if (recLine) output.push(recLine);

      return output.filter(Boolean).join(" ");
    }
  };

  // ============================================
  // 🔒 FORMGATE (Sosyal stil seçilmeden alanları kilitle)
  // ============================================
  const FormGate = (function(){
    const gatedIds = [
      'base_claim_problem','base_claim_effect','base_feat','base_adv','base_ben','base_rec'
    ];
    const btnIds = ['generateAutoCPRBtn'];

    function setDisabled(el, disabled){
      if(!el) return;
      el.disabled = !!disabled;
      if(disabled){
        el.setAttribute('aria-disabled','true');
      } else {
        el.removeAttribute('aria-disabled');
      }
    }

    function applyGate(isOpen){
      const disable = !isOpen;
      gatedIds.forEach(id => setDisabled(document.getElementById(id), disable));
      btnIds.forEach(id => setDisabled(document.getElementById(id), disable));

      try{
        document.querySelectorAll('.voice-btn').forEach(btn=>{
          const targetId = btn.getAttribute('data-target');
          if(!targetId) return;
          const target = document.getElementById(targetId);
          if(target && target.disabled) btn.disabled = true;
          if(target && !target.disabled) btn.disabled = false;
        });
      }catch(e){}
    }

    function init(){
      const style = (document.getElementById('promoContext')?.value || '').trim();
      applyGate(!!style);
    }

    return { init, applyGate };
  })();

  // ============================================
  // 🎯 SOCIAL STYLE CONTROLLER (Pill -> hidden promoContext)
  // ============================================
  const SocialStyle = (function(){
    const pillWrapId = 'socialStylePills';
    const hiddenId = 'promoContext';

    function getSelected(){
      return (document.getElementById(hiddenId)?.value || '').trim();
    }

    function setSelected(style){
      const hidden = document.getElementById(hiddenId);
      if(hidden) hidden.value = style || '';
      syncUI();
    }

    function syncUI(){
      const selected = getSelected();
      const wrap = document.getElementById(pillWrapId);
      if(!wrap) return;
      wrap.querySelectorAll('.pill-btn').forEach(btn=>{
        const v = (btn.getAttribute('data-social-style') || '').trim();
        btn.classList.toggle('active', v && v === selected);
      });
    }

    function onPillClick(e){
      const btn = e.target.closest('.pill-btn');
      if(!btn) return;
      const style = (btn.getAttribute('data-social-style') || '').trim();
      if(!style) return;

      setSelected(style);
      FormGate.applyGate(true);
      AutoCPRGenerator.updateAutoCPR();
    }

    function init(){
      const wrap = document.getElementById(pillWrapId);
      if(!wrap) return;
      wrap.addEventListener('click', onPillClick);
      syncUI();
      const selected = getSelected();
      if(!selected) FormGate.applyGate(false);
      else FormGate.applyGate(true);
    }

    return { init, getSelected };
  })();

  // ============================================
  // 📄 TÜM RAPOR PDF SİSTEMİ
  // ============================================
  
  const ComprehensivePDFReport = {
    generateFullReport: function() {
      try {
        const fullReportBtn = document.getElementById('fullReportPDF');
        const originalText = fullReportBtn.innerHTML;
        const originalBackground = fullReportBtn.style.background;
        
        fullReportBtn.innerHTML = '📄 Oluşturuluyor...';
        fullReportBtn.style.background = '#9ca3af';
        fullReportBtn.style.cursor = 'wait';
        
        setTimeout(() => {
          const reportData = this.collectAllData();
          const docDefinition = this.createFullDocumentDefinition(reportData);
          
          const fileName = `FAST_CPR_Tum_Rapor_${new Date().toISOString().slice(0, 10)}.pdf`;
          pdfMake.createPdf(docDefinition).download(fileName);
          
          showMobileNotification('Tüm rapor PDF olarak indiriliyor...', 'success');
          
          fullReportBtn.innerHTML = originalText;
          fullReportBtn.style.background = originalBackground;
          fullReportBtn.style.cursor = 'pointer';
        }, 500);
        
      } catch (error) {
        console.error('PDF oluşturma hatası:', error);
        showMobileNotification('PDF oluşturulurken hata oluştu', 'error');
        
        const fullReportBtn = document.getElementById('fullReportPDF');
        fullReportBtn.innerHTML = '📄 Tüm Raporu PDF\'e Aktar';
        fullReportBtn.style.background = '#3b82f6';
        fullReportBtn.style.cursor = 'pointer';
      }
    },
    
    collectAllData: function() {
      return {
        preparation: {
          promoContext: document.getElementById('promoContext')?.value.trim() || '—',
          learningStyle: document.getElementById('learningStyle')?.value.trim() || '—',
          selectedBehaviors: SocialLearningStyleManager ? SocialLearningStyleManager.getSelectedBehaviors().join(', ') || '—' : '—'
        },
        
        productPrep: {
          productName: document.getElementById('productNameInput')?.value.trim() || '—',
          competitorName: document.getElementById('competitorNameInput')?.value.trim() || '—',
          superiority: document.getElementById('superiorityInput')?.value.trim() || '—',
          promoGoal: document.getElementById('promoGoal')?.value.trim() || '—'
        },
        
        baseCPR: {
          claim_problem: document.getElementById('base_claim_problem')?.value.trim() || '—',
          claim_effect: document.getElementById('base_claim_effect')?.value.trim() || '—',
          feature: document.getElementById('base_feat')?.value.trim() || '—',
          advantage: document.getElementById('base_adv')?.value.trim() || '—',
          benefit: document.getElementById('base_ben')?.value.trim() || '—',
          recommendation: document.getElementById('base_rec')?.value.trim() || '—'
        },
        
        styleCPRs: {
          activist: document.getElementById('activist_cpr')?.value.trim() || '—',
          reflector: document.getElementById('reflector_cpr')?.value.trim() || '—',
          theorist: document.getElementById('theorist_cpr')?.value.trim() || '—',
          pragmatist: document.getElementById('pragmatist_cpr')?.value.trim() || '—'
        },
        
        generatedAt: new Date().toLocaleString('tr-TR'),
        date: new Date().toLocaleDateString('tr-TR'),
        time: new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' })
      };
    },
    
    createFullDocumentDefinition: function(data) {
      return {
        pageSize: 'A4',
        pageMargins: [40, 80, 40, 60],
        
        header: function(currentPage, pageCount) {
          return [
            {
              text: 'FAST CPR KOÇU',
              style: 'mainHeader',
              alignment: 'center',
              margin: [0, 20, 0, 0]
            },
            
            {
              text: data.date + ' ' + data.time,
              style: 'dateHeader',
              alignment: 'right',
              margin: [0, 40, 40, 0]
            }
          ];
        },
        
        content: [
          {
            text: '1. SOSYAL STİL VE ÖĞRENME STİLİ TANIMLAMA',
            style: 'sectionHeader',
            pageBreak: 'before',
            margin: [0, 30, 0, 10]
          },
          this.createPreparationSection(data.preparation),
          
          {
            text: '2. ÜRÜN-RAKİP-ÜSTÜNLÜKLER-HEDEF',
            style: 'sectionHeader',
            margin: [0, 20, 0, 10]
          },
          this.createProductPrepSection(data.productPrep),
          
          {
            text: '3. TEMEL CPR',
            style: 'sectionHeader',
            margin: [0, 20, 0, 10]
          },
          this.createBaseCPRSection(data.baseCPR),
          
          {
            text: '4. ÖĞRENME STİLLERİNE GÖRE CPR\'LAR',
            style: 'sectionHeader',
            margin: [0, 20, 0, 10]
          },
          this.createStyleCPRSection(data.styleCPRs),
          
          {
            text: 'FAST CPR Koçu tarafından oluşturulmuştur • ' + data.generatedAt,
            style: 'footer',
            margin: [0, 30, 0, 0]
          }
        ],
        
        styles: {
          mainHeader: {
            fontSize: 20,
            bold: true,
            color: '#1d4ed8'
          },
          
          dateHeader: {
            fontSize: 10,
            color: '#666',
            italics: true
          },
          
          sectionHeader: {
            fontSize: 14,
            bold: true,
            color: '#1e40af',
            background: '#eff6ff',
            padding: [8, 4],
            border: [1, 'solid', '#dbeafe'],
            marginBottom: 8
          },
          
          subsection: {
            fontSize: 12,
            bold: true,
            color: '#374151',
            margin: [0, 8, 0, 4]
          },
          
          contentText: {
            fontSize: 11,
            lineHeight: 1.4,
            margin: [0, 0, 0, 6]
          },
          
          italicCPR: {
            fontSize: 11,
            italics: true,
            lineHeight: 1.4,
            background: '#f8fafc',
            padding: [8, 10],
            border: [1, 'dashed', '#e5e7eb'],
            margin: [0, 4, 0, 12]
          },
          
          footer: {
            fontSize: 9,
            color: '#6b7280',
            alignment: 'center',
            italics: true
          },
          
          label: {
            fontSize: 11,
            bold: true,
            color: '#4b5563'
          },
          
          value: {
            fontSize: 11,
            color: '#111827',
            margin: [0, 0, 0, 8]
          }
        }
      };
    },
    
    createPreparationSection: function(prep) {
      return [
        {
          text: [{ text: 'Doktor/Eczacının Sosyal Stili: ', style: 'label' }, prep.promoContext],
          style: 'contentText'
        },
        {
          text: [{ text: 'Seçilen Davranışlar: ', style: 'label' }, prep.selectedBehaviors],
          style: 'contentText'
        },
        {
          text: [{ text: 'Öğrenme Stili: ', style: 'label' }, prep.learningStyle],
          style: 'contentText',
          margin: [0, 0, 0, 16]
        }
      ];
    },
    
    createProductPrepSection: function(product) {
      return [
        {
          text: [{ text: 'Ürün: ', style: 'label' }, product.productName],
          style: 'contentText'
        },
        {
          text: [{ text: 'Rakip: ', style: 'label' }, product.competitorName],
          style: 'contentText'
        },
        {
          text: [{ text: 'Üstün Yön: ', style: 'label' }, product.superiority],
          style: 'contentText'
        },
        {
          text: [{ text: 'SMART CPR Hedefi: ', style: 'label' }, product.promoGoal],
          style: 'contentText',
          margin: [0, 0, 0, 16]
        }
      ];
    },
    
    createBaseCPRSection: function(cpr) {
      return [
        {
          text: 'CLAIM - Problem:',
          style: 'subsection'
        },
        {
          text: cpr.claim_problem,
          style: 'value'
        },
        {
          text: 'CLAIM - Etki:',
          style: 'subsection'
        },
        {
          text: cpr.claim_effect,
          style: 'value'
        },
        {
          text: 'PROPOSITION - Özellik:',
          style: 'subsection'
        },
        {
          text: cpr.feature,
          style: 'value'
        },
        {
          text: 'PROPOSITION - Avantaj:',
          style: 'subsection'
        },
        {
          text: cpr.advantage,
          style: 'value'
        },
        {
          text: 'PROPOSITION - Fayda:',
          style: 'subsection'
        },
        {
          text: cpr.benefit,
          style: 'value'
        },
        {
          text: 'RECOMMENDATION:',
          style: 'subsection'
        },
        {
          text: cpr.recommendation,
          style: 'value',
          margin: [0, 0, 0, 16]
        }
      ];
    },
    
    createStyleCPRSection: function(styles) {
      return [
        {
          text: 'Aktivist CPR',
          style: 'subsection'
        },
        {
          text: styles.activist,
          style: 'italicCPR'
        },
        
        {
          text: 'Reflektör CPR',
          style: 'subsection'
        },
        {
          text: styles.reflector,
          style: 'italicCPR'
        },
        
        {
          text: 'Teorist CPR',
          style: 'subsection'
        },
        {
          text: styles.theorist,
          style: 'italicCPR'
        },
        
        {
          text: 'Pragmatist CPR',
          style: 'subsection'
        },
        {
          text: styles.pragmatist,
          style: 'italicCPR',
          margin: [0, 4, 0, 0]
        }
      ];
    }
  };
  
  // ============================================
  // 👥 SOSYAL STİL VE ÖĞRENME STİLİ YÖNETİCİSİ
  // ============================================
  
  const SocialLearningStyleManager = {
    storageKey: 'fastcpr_social_learning_styles',
    selectedBehaviors: [],
    selectedLearningStyle: '',
    
    behaviors: [
      "Konuşma hızını artırma",
      "Konuşma hızını yavaşlatma",
      "Sesin hacmini artırma",
      "Sesin hacmini azaltma",
      "Mimikleri artırma",
      "Mimikleri azaltma",
      "Göz temasını artırma",
      "Göz temasını azaltma",
      "Ellerin kullanımını artırma",
      "Ellerin kullanımını azaltma",
      "Atak duruş sergileme",
      "Çekinik duruş sergileme",
      "Gerçekleri konuşma",
      "Hikayemsi konuşma",
      "Kelime sayısını artırma",
      "Kelime sayısını azaltma"
    ],
    
    learningStyles: [
      { id: 'activist', name: 'Aktivist', color: '#f97316', icon: '🔥' },
      { id: 'reflector', name: 'Reflektör', color: '#8b5cf6', icon: '👁️' },
      { id: 'theorist', name: 'Teorist', color: '#0ea5e9', icon: '📐' },
      { id: 'pragmatist', name: 'Pragmatist', color: '#10b981', icon: '🛠️' }
    ],
    
    init: function() {
      this.load();
      this.renderBehaviors();
      this.renderLearningStyles();
      this.updateStyleCPRVisibility();
      this.bindEvents();
      console.log('✅ Sosyal Stil ve Öğrenme Stili Yöneticisi hazır');
    },
    
    load: function() {
      try {
        const saved = localStorage.getItem(this.storageKey);
        if (saved) {
          const data = JSON.parse(saved);
          this.selectedBehaviors = data.selectedBehaviors || [];
          this.selectedLearningStyle = data.selectedLearningStyle || '';
        }
      } catch (e) {
        console.error('Yükleme hatası:', e);
      }
    },
    
    save: function() {
      try {
        const data = {
          selectedBehaviors: this.selectedBehaviors,
          selectedLearningStyle: this.selectedLearningStyle
        };
        localStorage.setItem(this.storageKey, JSON.stringify(data));
      } catch (e) {
        console.error('Kaydetme hatası:', e);
      }
    },
    
    renderBehaviors: function() {
      const behaviorPills = document.getElementById('behaviorPills');
      const selectedBehaviorsList = document.getElementById('selectedBehaviorsList');
      
      if (!behaviorPills || !selectedBehaviorsList) return;
      
      behaviorPills.innerHTML = '';
      this.behaviors.forEach(behavior => {
        const pill = document.createElement('div');
        pill.className = 'behavior-pill';
        pill.textContent = behavior;
        pill.dataset.behavior = behavior;
        
        if (this.selectedBehaviors.includes(behavior)) {
          pill.classList.add('selected');
        }
        
        pill.addEventListener('click', () => {
          this.toggleBehavior(behavior);
        });
        
        behaviorPills.appendChild(pill);
      });
      
      this.updateSelectedBehaviorsList();
    },
    
    renderLearningStyles: function() {
      const learningStylePills = document.getElementById('learningStylePills');
      const learningStyleInput = document.getElementById('learningStyle');
      
      if (!learningStylePills || !learningStyleInput) return;
      
      learningStylePills.innerHTML = '';
      this.learningStyles.forEach(style => {
        const pill = document.createElement('div');
        pill.className = `learning-style-pill ${style.id}`;
        pill.textContent = `${style.icon} ${style.name}`;
        pill.dataset.style = style.id;
        
        if (this.selectedLearningStyle === style.id) {
          pill.classList.add('selected');
          learningStyleInput.value = style.name;
        }
        
        pill.addEventListener('click', () => {
          this.selectLearningStyle(style.id);
        });
        
        learningStylePills.appendChild(pill);
      });
    },
    
    toggleBehavior: function(behavior) {
      const index = this.selectedBehaviors.indexOf(behavior);
      
      if (index === -1) {
        this.selectedBehaviors.push(behavior);
      } else {
        this.selectedBehaviors.splice(index, 1);
      }
      
      this.save();
      this.renderBehaviors();
      this.updateSelectedBehaviorsList();
    },
    
    selectLearningStyle: function(styleId) {
      this.selectedLearningStyle = styleId;
      this.save();
      this.renderLearningStyles();
      this.updateStyleCPRVisibility();
      
      const styleName = this.learningStyles.find(s => s.id === styleId)?.name || '';
      showMobileNotification(`Öğrenme stili seçildi: ${styleName}`, 'success');
    },
    
    updateSelectedBehaviorsList: function() {
      const selectedBehaviorsList = document.getElementById('selectedBehaviorsList');
      if (!selectedBehaviorsList) return;
      
      selectedBehaviorsList.innerHTML = '';
      
      if (this.selectedBehaviors.length === 0) {
        const emptyMessage = document.createElement('div');
        emptyMessage.className = 'small';
        emptyMessage.textContent = 'Henüz davranış seçilmedi';
        emptyMessage.style.color = '#9ca3af';
        emptyMessage.style.fontStyle = 'italic';
        selectedBehaviorsList.appendChild(emptyMessage);
        return;
      }
      
      this.selectedBehaviors.forEach(behavior => {
        const pill = document.createElement('div');
        pill.className = 'selected-behavior-pill';
        
        const text = document.createElement('span');
        text.textContent = behavior;
        
        const removeBtn = document.createElement('span');
        removeBtn.className = 'remove';
        removeBtn.textContent = '×';
        removeBtn.title = 'Kaldır';
        removeBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          this.toggleBehavior(behavior);
        });
        
        pill.appendChild(text);
        pill.appendChild(removeBtn);
        selectedBehaviorsList.appendChild(pill);
      });
    },
    
    updateStyleCPRVisibility: function() {
      const styleGrid = document.getElementById('styleGrid');
      if (!styleGrid) return;
      
      const styleCards = document.querySelectorAll('.styleCard');
      styleCards.forEach(card => {
        card.style.display = 'none';
      });
      
      if (this.selectedLearningStyle) {
        const selectedCard = document.getElementById(`${this.selectedLearningStyle}Card`);
        if (selectedCard) {
          selectedCard.style.display = 'block';
          
          const styleCounter = document.getElementById('mini_styles');
          if (styleCounter) {
            const styleName = this.learningStyles.find(s => s.id === this.selectedLearningStyle)?.name || '';
            styleCounter.textContent = `1/1 stil (${styleName})`;
          }
        }
      } else {
        styleCards.forEach(card => {
          card.style.display = 'block';
        });
        
        const styleCounter = document.getElementById('mini_styles');
        if (styleCounter) {
          styleCounter.textContent = '0/4 stil kapalı';
        }
      }
    },
    
    getSelectedBehaviors: function() {
      return this.selectedBehaviors;
    },
    
    getSelectedLearningStyle: function() {
      return this.selectedLearningStyle;
    },
    
    bindEvents: function() {
      const behaviorDetails = document.getElementById('behaviorDetails');
      if (behaviorDetails) {
        behaviorDetails.addEventListener('toggle', () => {
          if (behaviorDetails.open) {
            this.updateSelectedBehaviorsList();
          }
        });
      }
    }
  };
  
  // ============================================
  // 📱 MOBİL ÖZELLİKLER (GELİŞTİRİLMİŞ)
  // ============================================
  
  const MobileFeatures = {
    SpeechToText: {
      recognition: null,
      isListening: false,
      currentTarget: null,
      voiceIndicator: null,
      
      init: function() {
        this.initializeSpeechRecognition();
        console.log('✅ Gelişmiş sesli giriş sistemi hazır');
      },
      
      initializeSpeechRecognition: function() {
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
          console.warn('⚠️ Bu tarayıcı ses tanımayı desteklemiyor');
          this.disableVoiceButtons('Sesli giriş desteklenmiyor');
          return;
        }
        
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        
        try {
          this.recognition = new SpeechRecognition();
          this.recognition.continuous = false;
          this.recognition.interimResults = true;
          this.recognition.lang = 'tr-TR';
          this.recognition.maxAlternatives = 3;
          
          if (/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
            this.recognition.interimResults = false;
            this.recognition.maxAlternatives = 1;
          }
          
          this.recognition.onstart = () => {
            this.isListening = true;
            this.showListeningStatus(true);
            this.showVoiceIndicator();
          };
          
          this.recognition.onresult = (event) => {
            let finalTranscript = '';
            let interimTranscript = '';
            
            for (let i = event.resultIndex; i < event.results.length; ++i) {
              if (event.results[i].isFinal) {
                finalTranscript += event.results[i][0].transcript;
              } else {
                interimTranscript += event.results[i][0].transcript;
              }
            }
            
            if (this.currentTarget && (finalTranscript || interimTranscript)) {
              const textarea = document.getElementById(this.currentTarget);
              if (textarea) {
                if (finalTranscript) {
                  const currentText = textarea.value;
                  textarea.value = currentText + (currentText ? ' ' : '') + finalTranscript;
                  textarea.dispatchEvent(new Event('input', { bubbles: true }));
                  
                  if (typeof AutoCPRGenerator !== 'undefined') {
                    AutoCPRGenerator.updateAutoCPR();
                  }
                  
                  this.showVoiceFeedback('✓ Eklendi');
                }
                
                if (interimTranscript && this.voiceIndicator) {
                  this.voiceIndicator.querySelector('.voice-text').textContent = interimTranscript;
                }
              }
            }
          };
          
          this.recognition.onerror = (event) => {
            console.error('Ses tanıma hatası:', event.error);
            
            if (event.error === 'not-allowed' && /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
              showMobileNotification('Mikrofon izni gerekiyor. Ayarlardan izin verin.', 'error');
            } else {
              showMobileNotification('Ses tanıma hatası: ' + this.getErrorMessage(event.error), 'error');
            }
            
            this.hideVoiceIndicator();
          };
          
          this.recognition.onend = () => {
            this.isListening = false;
            this.showListeningStatus(false);
            this.hideVoiceIndicator();
            this.currentTarget = null;
          };
          
          this.enableVoiceButtons();
          
        } catch (error) {
          console.error('Ses tanıma başlatma hatası:', error);
          this.disableVoiceButtons('Sesli giriş başlatılamadı');
        }
      },
      
      disableVoiceButtons: function(message) {
        document.querySelectorAll('.voice-btn').forEach(btn => {
          btn.style.opacity = '0.5';
          btn.title = message;
          btn.disabled = true;
        });
      },
      
      enableVoiceButtons: function() {
        document.querySelectorAll('.voice-btn').forEach(btn => {
          btn.style.opacity = '1';
          btn.title = 'Sesli giriş';
          btn.disabled = false;
        });
      },
      
      startListening: function(targetId) {
        if (!this.recognition) {
          showMobileNotification('Sesli giriş desteklenmiyor', 'error');
          return;
        }
        
        if (this.isListening && this.currentTarget === targetId) {
          this.stopListening();
          return;
        }
        
        this.currentTarget = targetId;
        
        if (/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
          this.requestMicrophonePermission();
        }
        
        try {
          this.recognition.start();
        } catch (error) {
          console.error('Ses tanıma başlatma hatası:', error);
          
          if (error.name === 'NotAllowedError' && /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
            showMobileNotification('Mikrofon izni gerekiyor. Lütfen ayarlardan izin verin.', 'error');
          } else {
            showMobileNotification('Ses tanıma başlatılamadı', 'error');
          }
        }
      },
      
      requestMicrophonePermission: function() {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
          navigator.mediaDevices.getUserMedia({ audio: true })
            .then(() => {
              console.log('✅ Mikrofon izni alındı');
            })
            .catch(err => {
              console.warn('Mikrofon izni reddedildi:', err);
            });
        }
      },
      
      stopListening: function() {
        if (this.recognition && this.isListening) {
          this.recognition.stop();
        }
      },
      
      toggleListening: function(targetId) {
        if (this.isListening && this.currentTarget === targetId) {
          this.stopListening();
        } else {
          this.startListening(targetId);
        }
      },
      
      showListeningStatus: function(isListening) {
        const buttons = document.querySelectorAll('.voice-btn');
        buttons.forEach(btn => {
          if (btn.dataset.target === this.currentTarget) {
            btn.classList.toggle('listening', isListening);
            btn.innerHTML = isListening ? '🔴' : '🎤';
            btn.title = isListening ? 'Dinleniyor... (durdurmak için tıkla)' : 'Sesli giriş';
          }
        });
      },
      
      showVoiceIndicator: function() {
        if (this.voiceIndicator) {
          this.voiceIndicator.remove();
        }
        
        this.voiceIndicator = document.createElement('div');
        this.voiceIndicator.className = 'voice-indicator';
        this.voiceIndicator.style.cssText = `
          position: fixed;
          bottom: 80px;
          left: 50%;
          transform: translateX(-50%);
          background: linear-gradient(135deg, #3b82f6, #1d4ed8);
          color: white;
          padding: 12px 20px;
          border-radius: 25px;
          display: flex;
          align-items: center;
          gap: 10px;
          z-index: 1001;
          box-shadow: 0 4px 15px rgba(0,0,0,0.2);
          min-width: 250px;
          max-width: 90%;
          font-size: 14px;
        `;
        
        this.voiceIndicator.innerHTML = `
          <div class="pulse" style="
            width: 12px;
            height: 12px;
            background: #ef4444;
            border-radius: 50%;
            animation: pulse 1s infinite;
          "></div>
          <span class="voice-text" style="flex: 1;">Dinleniyor... Konuşmaya başlayın</span>
          <button class="btn ghost small" id="stopVoiceBtn" style="
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 4px 12px;
            font-size: 12px;
            border-radius: 12px;
          ">Durdur</button>
        `;
        
        document.body.appendChild(this.voiceIndicator);
        
        document.getElementById('stopVoiceBtn').addEventListener('click', (e) => {
          e.stopPropagation();
          this.stopListening();
        });
      },
      
      hideVoiceIndicator: function() {
        if (this.voiceIndicator) {
          this.voiceIndicator.remove();
          this.voiceIndicator = null;
        }
      },
      
      showVoiceFeedback: function(message) {
        const textarea = document.getElementById(this.currentTarget);
        if (!textarea) return;
        
        const feedback = document.createElement('div');
        feedback.className = 'voice-feedback';
        feedback.textContent = message;
        feedback.style.cssText = `
          position: absolute;
          bottom: -25px;
          right: 10px;
          background: #10b981;
          color: white;
          padding: 4px 8px;
          border-radius: 10px;
          font-size: 11px;
          z-index: 10;
        `;
        
        const wrapper = textarea.parentElement;
        wrapper.style.position = 'relative';
        wrapper.appendChild(feedback);
        
        setTimeout(() => {
          if (feedback.parentElement) {
            feedback.remove();
          }
        }, 1500);
      },
      
      getErrorMessage: function(errorCode) {
        const errors = {
          'no-speech': 'Konuşma algılanamadı',
          'audio-capture': 'Mikrofon erişimi yok',
          'not-allowed': 'Mikrofon izni verilmedi',
          'network': 'Ağ hatası',
          'aborted': 'İşlem iptal edildi',
          'service-not-allowed': 'Servis izni yok'
        };
        return errors[errorCode] || 'Bilinmeyen hata';
      }
    },
    
    ConnectivityManager: {
      init: function() {
        const offlineStatus = document.getElementById('offlineStatus');
        const connectivityText = document.getElementById('connectivityText');
        
        if (!offlineStatus || !connectivityText) return;
        
        this.updateStatus();
        
        window.addEventListener('online', () => {
          this.updateStatus();
          showMobileNotification('İnternet bağlantısı yeniden sağlandı', 'success');
        });
        
        window.addEventListener('offline', () => {
          this.updateStatus();
          showMobileNotification('İnternet bağlantısı kesildi. Offline mod aktif.', 'warning');
        });
        
        console.log('✅ Connectivity Manager hazır');
      },
      
      updateStatus: function() {
        const offlineStatus = document.getElementById('offlineStatus');
        const connectivityText = document.getElementById('connectivityText');
        
        if (!offlineStatus || !connectivityText) return;
        
        if (navigator.onLine) {
          offlineStatus.classList.remove('offline');
          offlineStatus.classList.add('online');
          connectivityText.textContent = 'Çevrimiçi';
          offlineStatus.title = 'İnternet bağlantısı aktif';
          
          setTimeout(() => {
            if (navigator.onLine) {
              offlineStatus.style.opacity = '0';
              offlineStatus.style.transform = 'translateY(-10px)';
              setTimeout(() => {
                if (navigator.onLine) {
                  offlineStatus.style.display = 'none';
                }
              }, 300);
            }
          }, 3000);
        } else {
          offlineStatus.classList.remove('online');
          offlineStatus.classList.add('offline');
          connectivityText.textContent = 'Çevrimdışı';
          offlineStatus.title = 'İnternet bağlantısı yok';
          offlineStatus.style.display = 'flex';
          offlineStatus.style.opacity = '1';
          offlineStatus.style.transform = 'translateY(0)';
        }
      }
    },
    
    ClipboardSystem: {
      init: function() {
        const copyBtn = document.getElementById('copyCPR');
        if (copyBtn) {
          copyBtn.addEventListener('click', () => {
            this.copyCPRToClipboard();
          });
        }
        
        const toolbarCopyBtn = document.querySelector('.mobile-toolbar button[data-action="copy"]');
        if (toolbarCopyBtn) {
          toolbarCopyBtn.addEventListener('click', () => {
            this.copyActiveTextarea();
          });
        }
        console.log('✅ Kopyalama sistemi hazır');
      },
      
      copyCPRToClipboard: function() {
        const autoCPR = document.getElementById('autoCPR')?.value;
        
        if (!autoCPR || autoCPR.trim().length < 10) {
          showMobileNotification('Kopyalanacak CPR metni yok', 'warning');
          return;
        }
        
        this.copyTextToClipboard(autoCPR, 'CPR panoya kopyalandı');
      },
      
      copyActiveTextarea: function() {
        const activeTextarea = document.activeElement;
        if (!activeTextarea || activeTextarea.tagName !== 'TEXTAREA') {
          showMobileNotification('Önce bir metin alanına tıklayın', 'info');
          return;
        }
        
        const text = activeTextarea.value;
        if (!text || text.trim().length === 0) {
          showMobileNotification('Kopyalanacak metin yok', 'warning');
          return;
        }
        
        this.copyTextToClipboard(text, 'Metin panoya kopyalandı');
      },
      
      copyTextToClipboard: function(text, successMessage) {
        if (!navigator.clipboard) {
          this.fallbackCopyTextToClipboard(text, successMessage);
          return;
        }
        
        navigator.clipboard.writeText(text).then(() => {
          showMobileNotification(successMessage, 'success');
        }).catch(err => {
          console.error('Kopyalama hatası:', err);
          this.fallbackCopyTextToClipboard(text, successMessage);
        });
      },
      
      fallbackCopyTextToClipboard: function(text, successMessage) {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.position = "fixed";
        textArea.style.opacity = "0";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
          const successful = document.execCommand('copy');
          if (successful) {
            showMobileNotification(successMessage, 'success');
          } else {
            showMobileNotification('Kopyalama başarısız', 'error');
          }
        } catch (err) {
          console.error('Fallback kopyalama hatası:', err);
          showMobileNotification('Kopyalama başarısız', 'error');
        }
        
        document.body.removeChild(textArea);
      }
    },
    
    DraftSystem: {
      storageKey: 'fastcpr_drafts_v2',
      autoSaveInterval: null,
      lastSaveTime: null,
      
      init: function() {
        this.setupAutoSave();
        this.setupDraftButtons();
        this.updateDraftIndicator();
        
        window.addEventListener('load', () => {
          const hasDrafts = this.hasDrafts();
          if (hasDrafts) {
            showMobileNotification('Kayıtlı draft bulundu. Yüklemek için "Draft Listesi" butonunu kullanın.', 'info');
          }
        });
        
        window.addEventListener('beforeunload', (e) => {
          this.saveDraft();
        });
        
        console.log('✅ Draft Sistemi hazır');
      },
      
      setupAutoSave: function() {
        this.autoSaveInterval = setInterval(() => {
          this.saveDraft(false);
        }, 30000);
        
        document.querySelectorAll('textarea').forEach(textarea => {
          textarea.addEventListener('input', () => {
            this.updateDraftIndicator();
          });
        });
      },
      
      setupDraftButtons: function() {
        const saveBtn = document.getElementById('btnSaveDraft');
        const loadBtn = document.getElementById('btnLoadDraft');
        const showDraftsBtn = document.getElementById('btnShowDrafts');
        const clearAllBtn = document.getElementById('btnClearAllDrafts');
        
        if (saveBtn) {
          saveBtn.addEventListener('click', () => {
            this.saveDraft(true);
          });
        }
        
        if (showDraftsBtn) {
          showDraftsBtn.addEventListener('click', () => {
            this.showDraftSelector();
          });
        }
        
        if (clearAllBtn) {
          clearAllBtn.addEventListener('click', () => {
            if (confirm('Tüm draft\'ları silmek istediğinize emin misiniz? Bu işlem geri alınamaz.')) {
              localStorage.removeItem(this.storageKey);
              this.updateDraftIndicator();
              showMobileNotification('Tüm draft\'lar silindi', 'success');
            }
          });
        }
      },
      
      getCurrentData: function() {
        const selectedLearningStyle = SocialLearningStyleManager.getSelectedLearningStyle();
        let styleCPR = '';
        
        if (selectedLearningStyle) {
          styleCPR = document.getElementById(`${selectedLearningStyle}_cpr`)?.value || '';
        }
        
        return {
          claim_problem: document.getElementById('base_claim_problem')?.value || '',
          claim_effect: document.getElementById('base_claim_effect')?.value || '',
          feature: document.getElementById('base_feat')?.value || '',
          advantage: document.getElementById('base_adv')?.value || '',
          benefit: document.getElementById('base_ben')?.value || '',
          recommendation: document.getElementById('base_rec')?.value || '',
          autoCPR: document.getElementById('autoCPR')?.value || '',
          
          selectedLearningStyleCPR: styleCPR,
          
          promoContext: document.getElementById('promoContext')?.value || '',
          learningStyle: document.getElementById('learningStyle')?.value || '',
          promoGoal: document.getElementById('promoGoal')?.value || '',
          selectedBehaviors: SocialLearningStyleManager.getSelectedBehaviors() || [],
          selectedLearningStyle: selectedLearningStyle || '',
          
          productName: document.getElementById('productNameInput')?.value || '',
          competitorName: document.getElementById('competitorNameInput')?.value || '',
          superiority: document.getElementById('superiorityInput')?.value || '',
          
          styleCPRs: {
            activist: document.getElementById('activist_cpr')?.value || '',
            reflector: document.getElementById('reflector_cpr')?.value || '',
            theorist: document.getElementById('theorist_cpr')?.value || '',
            pragmatist: document.getElementById('pragmatist_cpr')?.value || ''
          },
          
          timestamp: new Date().toISOString(),
          lastModified: Date.now(),
          name: `Draft_${new Date().toLocaleTimeString('tr-TR', {hour: '2-digit', minute:'2-digit'})}`,
          version: '2.1'
        };
      },
      
      saveDraft: function(manual = false) {
        try {
          const data = this.getCurrentData();
          
          const hasContent = Object.values(data).some(val => 
            typeof val === 'string' && val.trim().length > 0 && 
            !['timestamp', 'lastModified', 'name', 'version'].includes(val)
          );
          
          if (!hasContent && !manual) {
            return false;
          }
          
          const drafts = this.getAllDrafts();
          
          drafts.unshift({
            ...data,
            id: Date.now(),
            name: manual ? `Manual_${new Date().toLocaleTimeString('tr-TR')}` : data.name
          });
          
          if (drafts.length > 10) {
            drafts.length = 10;
          }
          
          localStorage.setItem(this.storageKey, JSON.stringify(drafts));
          this.lastSaveTime = Date.now();
          
          this.updateDraftIndicator();
          
          if (manual) {
            showMobileNotification('Draft kaydedildi', 'success');
          }
          
          return true;
        } catch (error) {
          console.error('Draft kaydetme hatası:', error);
          if (manual) {
            showMobileNotification('Draft kaydedilemedi', 'error');
          }
          return false;
        }
      },
      
      getAllDrafts: function() {
        try {
          const saved = localStorage.getItem(this.storageKey);
          return saved ? JSON.parse(saved) : [];
        } catch (error) {
          console.error('Draft\'lar okunamadı:', error);
          return [];
        }
      },
      
      hasDrafts: function() {
        return this.getAllDrafts().length > 0;
      },
      
      updateDraftIndicator: function() {
        const indicator = document.getElementById('draftIndicator');
        const loadBtn = document.getElementById('btnLoadDraft');
        
        if (!indicator) return;
        
        const drafts = this.getAllDrafts();
        if (drafts.length > 0) {
          indicator.classList.add('saved');
          indicator.innerHTML = `💾 ${drafts.length} Draft`;
          indicator.title = `${drafts.length} kayıtlı draft var. Son kayıt: ${drafts[0]?.timestamp ? new Date(drafts[0].timestamp).toLocaleTimeString('tr-TR') : 'bilinmiyor'}`;
          
          indicator.onclick = () => {
            this.showDraftSelector();
          };
          
          if (loadBtn) loadBtn.style.display = 'inline-block';
        } else {
          indicator.classList.remove('saved');
          indicator.innerHTML = '💾 Draft Yok';
          indicator.title = 'Henüz draft kaydedilmedi';
          indicator.onclick = null;
          
          if (loadBtn) loadBtn.style.display = 'none';
        }
      },
      
      showDraftSelector: function() {
        const drafts = this.getAllDrafts();
        if (drafts.length === 0) {
          showMobileNotification('Kayıtlı draft bulunamadı', 'info');
          return;
        }
        
        const modal = document.createElement('div');
        modal.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0,0,0,0.5);
          z-index: 4000;
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 20px;
        `;
        
        let html = `
          <div style="
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            max-width: 90%;
            max-height: 80vh;
            overflow: auto;
            box-shadow: var(--shadow);
            width: 500px;
          ">
            <h3 style="margin-top: 0; margin-bottom: 15px; color: var(--accent);">
              📂 Kayıtlı Draft'lar
            </h3>
            <div style="margin-bottom: 20px; font-size: 13px; color: var(--muted);">
              Toplam ${drafts.length} draft. En son kaydedilenler üstte.
            </div>
        `;
        
        drafts.forEach((draft, index) => {
          const time = new Date(draft.timestamp).toLocaleString('tr-TR', {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });
          
          const preview = draft.selectedLearningStyleCPR?.substring(0, 80) || 
                         draft.autoCPR?.substring(0, 80) || 
                         draft.claim_problem?.substring(0, 80) || 
                         'Boş draft';
          
          const styleName = draft.selectedLearningStyle ? 
            SocialLearningStyleManager.learningStyles.find(s => s.id === draft.selectedLearningStyle)?.name || draft.selectedLearningStyle : 
            'Stil seçilmedi';
          
          html += `
            <div style="
              border: 1px solid var(--border);
              border-radius: 10px;
              padding: 12px;
              margin-bottom: 10px;
              cursor: pointer;
              transition: all 0.2s;
              background: ${index === 0 ? 'rgba(11, 95, 255, 0.03)' : 'white'};
            " 
            onclick="MobileFeatures.DraftSystem.loadDraft(${draft.id}); 
                     this.parentElement.parentElement.parentElement.remove();
                     showMobileNotification('Draft yüklendi', 'success');"
            onmouseover="this.style.backgroundColor='var(--soft)'"
            onmouseout="this.style.backgroundColor='${index === 0 ? 'rgba(11, 95, 255, 0.03)' : 'white'}'">
              <div style="font-weight: bold; font-size: 14px; margin-bottom: 4px;">
                ${draft.name || `Draft ${index + 1}`}
                ${index === 0 ? '<span style="font-size: 11px; background: var(--ok); color: white; padding: 2px 6px; border-radius: 10px; margin-left: 8px;">EN SON</span>' : ''}
              </div>
              <div style="font-size: 11px; color: var(--muted); margin-bottom: 6px;">
                ${time}
                ${draft.selectedLearningStyle ? `<span style="margin-left: 10px; background: #e0f2fe; padding: 2px 6px; border-radius: 10px; font-size: 10px;">${styleName}</span>` : ''}
              </div>
              <div style="font-size: 12px; color: #666; line-height: 1.4;">
                ${preview}${preview.length >= 80 ? '...' : ''}
              </div>
              <div style="margin-top: 8px; display: flex; gap: 8px; font-size: 11px;">
                <span style="background: var(--soft); padding: 2px 6px; border-radius: 10px;">
                  ${draft.claim_problem ? '✔ Claim' : '✗ Claim'}
                </span>
                <span style="background: var(--soft); padding: 2px 6px; border-radius: 10px;">
                  ${draft.feature ? '✔ Feature' : '✗ Feature'}
                </span>
                <span style="background: var(--soft); padding: 2px 6px; border-radius: 10px;">
                  ${draft.selectedLearningStyleCPR ? '✔ Stil CPR' : '✗ Stil CPR'}
                </span>
              </div>
            </div>
          `;
        });
        
        html += `
          <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: space-between;">
            <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                    class="btn ghost" 
                    style="padding: 8px 16px;">
              Kapat
            </button>
            <button onclick="localStorage.removeItem('fastcpr_drafts_v2'); 
                             MobileFeatures.DraftSystem.updateDraftIndicator(); 
                             this.parentElement.parentElement.parentElement.remove(); 
                             showMobileNotification('Tüm draft\\'lar silindi', 'success');" 
                    class="btn" 
                    style="padding: 8px 16px; background: var(--bad);">
              Tümünü Sil
            </button>
          </div>
        `;
        
        html += '</div>';
        modal.innerHTML = html;
        document.body.appendChild(modal);
        
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.remove();
          }
        });
      },
      
      loadDraft: function(draftId) {
        const drafts = this.getAllDrafts();
        const draft = drafts.find(d => d.id === draftId);
        
        if (!draft) {
          showMobileNotification('Draft bulunamadı', 'error');
          return;
        }
        
        document.getElementById('base_claim_problem').value = draft.claim_problem || '';
        document.getElementById('base_claim_effect').value = draft.claim_effect || '';
        document.getElementById('base_feat').value = draft.feature || '';
        document.getElementById('base_adv').value = draft.advantage || '';
        document.getElementById('base_ben').value = draft.benefit || '';
        document.getElementById('base_rec').value = draft.recommendation || '';
        document.getElementById('autoCPR').value = draft.autoCPR || '';
        
        document.getElementById('promoContext').value = draft.promoContext || '';
        document.getElementById('promoGoal').value = draft.promoGoal || '';
        document.getElementById('productNameInput').value = draft.productName || '';
        document.getElementById('competitorNameInput').value = draft.competitorName || '';
        document.getElementById('superiorityInput').value = draft.superiority || '';
        
        if (draft.selectedBehaviors && SocialLearningStyleManager) {
          SocialLearningStyleManager.selectedBehaviors = draft.selectedBehaviors;
          SocialLearningStyleManager.renderBehaviors();
        }
        
        if (draft.selectedLearningStyle && SocialLearningStyleManager) {
          SocialLearningStyleManager.selectLearningStyle(draft.selectedLearningStyle);
        }
        
        if (draft.styleCPRs) {
          document.getElementById('activist_cpr').value = draft.styleCPRs.activist || '';
          document.getElementById('reflector_cpr').value = draft.styleCPRs.reflector || '';
          document.getElementById('theorist_cpr').value = draft.styleCPRs.theorist || '';
          document.getElementById('pragmatist_cpr').value = draft.styleCPRs.pragmatist || '';
        }
        
        setTimeout(() => {
          if (typeof AutoCPRGenerator !== 'undefined') {
            AutoCPRGenerator.updateAutoCPR();
          }
          if (typeof CPRFlowControl !== 'undefined') {
            CPRFlowControl.updateCPRScore();
          }
          
          document.querySelectorAll('textarea').forEach(textarea => {
            textarea.dispatchEvent(new Event('input', { bubbles: true }));
          });
        }, 100);
      }
    },
    
    KeyboardShortcuts: {
      templates: {
        claim: [
          "Hasta tedavisinde zaman kısıtı bulunuyor",
          "Klinik pratiğinde sık karşılaşılan bir durum",
          "Mevcut tedavi seçenekleri yetersiz kalıyor",
          "Hasta uyumu konusunda zorluk yaşanıyor"
        ],
        feature: [
          "Geniş spektrumlu etkinlik profili",
          "Uzun yarılanma ömrü ile günde tek doz",
          "İyi tolere edilebilir yan etki profili",
          "Pratik kullanım sunan ambalaj tasarımı"
        ],
        advantage: [
          "Benzerlerine göre daha hızlı etki başlangıcı",
          "Daha iyi güvenlilik profili sunar",
          "Hasta konforunu artıran özellikler",
          "Klinik etkinliği kanıtlanmış"
        ],
        benefit: [
          "Tedavi sürecini kısaltır",
          "Hasta uyumunu artırır",
          "Yaşam kalitesini yükseltir",
          "Klinik başarı oranını iyileştirir"
        ],
        recommendation: [
          "Klinik pratiğinizde değerlendirir misiniz?",
          "Hastalarınız için önerir misiniz?",
          "Tedavi algoritmanıza eklemeyi düşünür müsünüz?",
          "Deneyimlerinizi paylaşır mısınız?"
        ]
      },
      
      init: function() {
        const toolbar = document.getElementById('mobileToolbar');
        if (toolbar) {
          toolbar.style.display = window.innerWidth <= 768 ? 'flex' : 'none';
          
          window.addEventListener('resize', () => {
            toolbar.style.display = window.innerWidth <= 768 ? 'flex' : 'none';
          });
          
          toolbar.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (button && button.dataset.action) {
              this.handleAction(button.dataset.action);
              button.classList.add('active');
              setTimeout(() => button.classList.remove('active'), 300);
            }
          });
        }
        
        document.querySelectorAll('textarea').forEach(textarea => {
          textarea.addEventListener('focus', () => {
            if (window.innerWidth <= 768 && toolbar) {
              toolbar.style.display = 'flex';
              setTimeout(() => {
                toolbar.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
              }, 100);
            }
          });
        });
        
        console.log('✅ Mobil Toolbar + Şablon Sistemi hazır');
      },
      
      handleAction: function(action) {
        const activeTextarea = document.activeElement;
        if (!activeTextarea || activeTextarea.tagName !== 'TEXTAREA') {
          showMobileNotification('Önce bir metin alanına tıklayın', 'info');
          return;
        }
        
        switch(action) {
          case 'claim':
          case 'feature':
          case 'advantage':
          case 'benefit':
          case 'recommendation':
            this.insertTemplate(activeTextarea, action);
            break;
            
          case 'copy':
            this.copyToClipboard(activeTextarea.value);
            break;
            
          case 'paste':
            this.pasteFromClipboard(activeTextarea);
            break;
            
          case 'clear':
            activeTextarea.value = '';
            activeTextarea.dispatchEvent(new Event('input', { bubbles: true }));
            break;
        }
      },
      
      insertTemplate: function(textarea, type) {
        const templates = this.templates[type];
        if (!templates) return;
        
        const randomTemplate = templates[Math.floor(Math.random() * templates.length)];
        const currentValue = textarea.value.trim();
        const separator = currentValue && !currentValue.endsWith('.') ? '. ' : ' ';
        textarea.value = currentValue + (currentValue ? separator : '') + randomTemplate;
        
        textarea.dispatchEvent(new Event('input', { bubbles: true }));
        textarea.focus();
        textarea.setSelectionRange(textarea.value.length, textarea.value.length);
        
        showMobileNotification(`${type} şablonu eklendi`, 'success');
      },
      
      copyToClipboard: function(text) {
        if (!text.trim()) {
          showMobileNotification('Kopyalanacak metin yok', 'warning');
          return;
        }
        
        navigator.clipboard.writeText(text).then(() => {
          showMobileNotification('Metin panoya kopyalandı', 'success');
        }).catch(err => {
          console.error('Kopyalama hatası:', err);
          showMobileNotification('Kopyalama başarısız', 'error');
        });
      },
      
      pasteFromClipboard: async function(textarea) {
        try {
          const text = await navigator.clipboard.readText();
          if (text) {
            const currentValue = textarea.value;
            const cursorPos = textarea.selectionStart;
            const newValue = currentValue.substring(0, cursorPos) + text + currentValue.substring(cursorPos);
            textarea.value = newValue;
            textarea.dispatchEvent(new Event('input', { bubbles: true }));
            
            const newCursorPos = cursorPos + text.length;
            textarea.setSelectionRange(newCursorPos, newCursorPos);
            
            showMobileNotification('Panodan yapıştırıldı', 'success');
          }
        } catch (err) {
          console.error('Yapıştırma hatası:', err);
          showMobileNotification('Yapıştırma başarısız', 'error');
        }
      }
    },
    
    init: function() {
      console.log('📱 TÜM MOBİL ÖZELLİKLER: Sistemler yükleniyor...');
      
      this.SpeechToText.init();
      this.ConnectivityManager.init();
      this.ClipboardSystem.init();
      this.DraftSystem.init();
      this.KeyboardShortcuts.init();
      
      const toolbar = document.getElementById('mobileToolbar');
      if (toolbar) {
        toolbar.style.display = window.innerWidth <= 768 ? 'flex' : 'none';
        
        window.addEventListener('resize', () => {
          toolbar.style.display = window.innerWidth <= 768 ? 'flex' : 'none';
        });
      }
      
      console.log('✅ TÜM MOBİL ÖZELLİKLER: Sistemler yüklendi!');
    }
  };
  
  // ============================================
  // 🧮 TEMEL CPR AKIŞ KONTROL SİSTEMİ
  // ============================================
  
  const CPRFlowControl = {
    currentCPRScore: 0,
    isStylesEnabled: false,
    
    init: function() {
        this.setupHintSystem();
        this.setupFlowControl();
        this.setupClearButtons();
        this.setupValidation();
        this.disableAllStyleFields();
        this.setupCopyBaseButtons();
        this.setupProblemEffectGenerator();
    },
    
    setupProblemEffectGenerator: function() {
      // ATC kodlarına göre problem-etki örnekleri butonu
      const generateBtn = document.createElement('button');
      generateBtn.className = 'btn ghost small';
      generateBtn.innerHTML = '🎲 Örnek Problem-Etki';
      generateBtn.style.marginTop = '10px';
      generateBtn.style.marginBottom = '10px';
      
      generateBtn.addEventListener('click', () => {
        // Rastgele bir ATC kodu seç
        const atcCodes = ['A', 'B', 'C', 'D', 'G', 'H', 'J', 'L', 'M', 'N', 'P', 'R', 'S'];
        const randomATCCode = atcCodes[Math.floor(Math.random() * atcCodes.length)];
        
        // ATC koduna göre rastgele problem-etki çifti al
        const pair = TGE.getRandomPairByATC(randomATCCode);
        
        // Problem ve etki alanlarına yaz
        document.getElementById('base_claim_problem').value = pair.problem;
        document.getElementById('base_claim_effect').value = pair.effect;
        
        // Input event'lerini tetikle
        document.getElementById('base_claim_problem').dispatchEvent(new Event('input', { bubbles: true }));
        document.getElementById('base_claim_effect').dispatchEvent(new Event('input', { bubbles: true }));
        
        // ATC kodunu göster
        const atcNames = {
          'A': 'Sindirim Sistemi',
          'B': 'Kan ve Kan Yapıcı Organlar',
          'C': 'Kalp ve Damar Sistemi',
          'D': 'Dermatoloji',
          'G': 'Genito-Üriner Sistem',
          'H': 'Sistemik Hormonlar',
          'J': 'Sistemik Anti-İnfektifler',
          'L': 'Antineoplastik',
          'M': 'Kas ve İskelet Sistemi',
          'N': 'Sinir Sistemi',
          'P': 'Antiparazitik',
          'R': 'Solunum Sistemi',
          'S': 'Duyu Organları'
        };
        
        showMobileNotification(`🎲 ${atcNames[randomATCCode]} için örnek yüklendi`, 'success');
      });
      
      // CLAIM bölümüne butonu ekle
      const claimSection = document.querySelector('.cpr-section-card[data-section="claim"]');
      if (claimSection) {
        claimSection.querySelector('.fieldTools').prepend(generateBtn);
      }
    },
    
    disableAllStyleFields: function() {
        const styleTextareas = document.querySelectorAll('.styled-cpr-area');
        const styleVoiceBtns = document.querySelectorAll('[data-target*="_cpr"]');
        
        styleTextareas.forEach(textarea => {
            textarea.disabled = true;
            textarea.placeholder = 'Temel CPR ≥ 13 olunca bu alan aktifleşecek';
            textarea.style.backgroundColor = '#f5f5f5';
            textarea.style.color = '#999';
            textarea.style.cursor = 'not-allowed';
        });
        
        styleVoiceBtns.forEach(btn => {
            btn.disabled = true;
            btn.style.opacity = '0.5';
            btn.title = 'Temel CPR ≥ 13 olmadan kullanılamaz';
        });
        
        document.querySelectorAll('[data-copy-base-to-style]').forEach(btn => {
            btn.disabled = true;
            btn.style.opacity = '0.5';
            btn.title = 'Temel CPR ≥ 13 olmadan kullanılamaz';
        });
        
        this.updateStyleCounter(0);
    },
    
    enableAllStyleFields: function() {
        const styleTextareas = document.querySelectorAll('.styled-cpr-area');
        const styleVoiceBtns = document.querySelectorAll('[data-target*="_cpr"]');
        
        styleTextareas.forEach(textarea => {
            textarea.disabled = false;
            textarea.placeholder = textarea.getAttribute('data-original-placeholder') || 'Buraya yazın...';
            textarea.style.backgroundColor = '';
            textarea.style.color = '';
            textarea.style.cursor = 'text';
        });
        
        styleVoiceBtns.forEach(btn => {
            btn.disabled = false;
            btn.style.opacity = '1';
            btn.title = 'Sesli giriş';
        });
        
        document.querySelectorAll('[data-copy-base-to-style]').forEach(btn => {
            btn.disabled = false;
            btn.style.opacity = '1';
            btn.title = 'Temel CPR\'ı bu stile kopyala';
        });
        
        this.updateStyleCounter(4);
        
        showMobileNotification('🎉 Stil CPR alanları aktifleşti! Temel CPR\'ı kopyalayarak kullanmaya başlayabilirsiniz.', 'success');
    },
    
    setupCopyBaseButtons: function() {
        document.querySelectorAll('[data-copy-base-to-style]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                
                if (this.currentCPRScore < 13) {
                    showMobileNotification('Temel CPR\'ı kopyalamak için puan ≥ 13 olmalı', 'warning');
                    return;
                }
                
                const style = btn.getAttribute('data-copy-base-to-style');
                this.copyBaseToStyle(style);
            });
        });
    },
    
    copyBaseToStyle: function(style) {
        const autoCPRTextarea = document.getElementById('autoCPR');
        const autoCPR = autoCPRTextarea ? autoCPRTextarea.value.trim() : '';
        
        if (!autoCPR || autoCPR.length < 10) {
            showMobileNotification('Önce CPR\'ı onaylayın (✅ CPR Onay butonu)', 'warning');
            return;
        }
        
        const styleTextarea = document.getElementById(`${style}_cpr`);
        if (styleTextarea) {
            styleTextarea.value = '';
            styleTextarea.value = autoCPR;
            styleTextarea.dispatchEvent(new Event('input', { bubbles: true }));
            
            const styleNames = {
                'activist': 'Aktivist',
                'reflector': 'Reflektör',
                'theorist': 'Teorist',
                'pragmatist': 'Pragmatist'
            };
            
            const styleName = styleNames[style] || style;
            showMobileNotification(`✅ Temel CPR "${styleName}" stilinine kopyalandı`, 'success');
            
            setTimeout(() => {
                styleTextarea.focus();
                styleTextarea.setSelectionRange(autoCPR.length, autoCPR.length);
            }, 100);
        }
    },
    
    updateStyleCounter: function(enabledCount) {
        const styleCounter = document.getElementById('mini_styles');
        if (styleCounter) {
            styleCounter.textContent = `${enabledCount}/4 stil aktif`;
        }
    },
    
    calculateCPRScore: function() {
        const problem = document.getElementById('base_claim_problem')?.value.trim() || '';
        const effect = document.getElementById('base_claim_effect')?.value.trim() || '';
        const feature = document.getElementById('base_feat')?.value.trim() || '';
        const advantage = document.getElementById('base_adv')?.value.trim() || '';
        const benefit = document.getElementById('base_ben')?.value.trim() || '';
        const recommendation = document.getElementById('base_rec')?.value.trim() || '';
        
        let score = 0;
        
        if (problem.length > 5) score += 1;
        if (effect.length > 5) score += 1;
        if (feature.length > 5) score += 2;
        if (advantage.length > 5) score += 2;
        if (benefit.length > 5) score += 2;
        if (recommendation.length > 5) score += 2;
        
        const allFieldsFilled = [problem, effect, feature, advantage, benefit, recommendation]
            .every(field => field.length > 5);
        
        if (allFieldsFilled) {
            score += 12;
        }
        
        score = Math.min(score, 22);
        
        return score;
    },
    
    updateCPRScore: function() {
        const newScore = this.calculateCPRScore();
        this.currentCPRScore = newScore;
        
        const scoreElement = document.getElementById('mini_base');
        if (scoreElement) {
          scoreElement.textContent = `CPR: ${newScore}/22`;
          
          if (newScore >= 13) {
            scoreElement.style.backgroundColor = '#ecfdf3';
            scoreElement.style.borderColor = '#bbf7d0';
            scoreElement.style.color = '#166534';
            scoreElement.title = `Tebrikler! Stil CPR'ları aktifleşti. (${newScore}/22)`;
            
            if (!this.isStylesEnabled) {
              this.isStylesEnabled = true;
              this.enableAllStyleFields();
            }
            
            const copyBtn = document.getElementById('copyCPR');
            if (copyBtn) {
              const autoCPR = document.getElementById('autoCPR')?.value || '';
              if (autoCPR.length > 20) {
                copyBtn.disabled = false;
                copyBtn.style.opacity = '1';
                copyBtn.title = 'CPR\'ı panoya kopyala';
              }
            }
          } else if (newScore >= 8) {
            scoreElement.style.backgroundColor = '#fffbeb';
            scoreElement.style.borderColor = '#fed7aa';
            scoreElement.style.color = '#92400e';
            scoreElement.title = `Devam edin! Stil CPR'ları için ${13 - newScore} puan daha gerekiyor. (${newScore}/22)`;
            
            if (this.isStylesEnabled) {
              this.isStylesEnabled = false;
              this.disableAllStyleFields();
            }
            
            const copyBtn = document.getElementById('copyCPR');
            if (copyBtn) {
              copyBtn.disabled = true;
              copyBtn.style.opacity = '0.5';
              copyBtn.title = 'CPR puanı ≥ 13 olmalı';
            }
          } else {
            scoreElement.style.backgroundColor = '#fef2f2';
            scoreElement.style.borderColor = '#fecaca';
            scoreElement.style.color = '#b91c1c';
            scoreElement.title = `Temel CPR'ı geliştirin. Stil CPR'ları için ${13 - newScore} puan daha gerekiyor. (${newScore}/22)`;
            
            if (this.isStylesEnabled) {
              this.isStylesEnabled = false;
              this.disableAllStyleFields();
            }
            
            const copyBtn = document.getElementById('copyCPR');
            if (copyBtn) {
              copyBtn.disabled = true;
              copyBtn.style.opacity = '0.5';
              copyBtn.title = 'CPR puanı ≥ 13 olmalı';
            }
          }
        }
        
        try {
          if (typeof SocialLearningStyleManager !== 'undefined' && SocialLearningStyleManager.updateStyleCPRVisibility) {
            SocialLearningStyleManager.updateStyleCPRVisibility();
          }
        } catch(e) {}

        return newScore;
    },
    
    setupHintSystem: function() {
        document.querySelectorAll('textarea').forEach(textarea => {
            const hintId = 'hint_' + textarea.id;
            const hintBox = document.getElementById(hintId);
            
            if (hintBox) {
                textarea.addEventListener('focus', () => {
                    hintBox.classList.add('show');
                });
                
                textarea.addEventListener('blur', () => {
                    hintBox.classList.remove('show');
                });
            }
        });
    },
    
    setupFlowControl: function() {
        const textareas = [
            'base_claim_problem', 'base_claim_effect', 
            'base_feat', 'base_adv', 'base_ben', 'base_rec'
        ];
        
        textareas.forEach(id => {
            const textarea = document.getElementById(id);
            if (textarea) {
                textarea.addEventListener('input', () => {
                    this.updateCPRScore();
                    
                    if (typeof AutoCPRGenerator !== 'undefined') {
                        AutoCPRGenerator.updateAutoCPR();
                    }
                });
            }
        });
    },
    
    setupClearButtons: function() {
        const clearButtons = {
            'clear_base_claim_problem': 'base_claim_problem',
            'clear_base_feat': 'base_feat',
            'clear_base_adv': 'base_adv',
            'clear_base_ben': 'base_ben',
            'clear_base_rec': 'base_rec'
        };
        
        Object.entries(clearButtons).forEach(([btnId, textareaId]) => {
            const btn = document.getElementById(btnId);
            const textarea = document.getElementById(textareaId);
            
            if (btn && textarea) {
                btn.addEventListener('click', () => {
                  textarea.value = '';
                  textarea.dispatchEvent(new Event('input', { bubbles: true }));
                  
                  this.updateCPRScore();
                  
                  if (typeof AutoCPRGenerator !== 'undefined') {
                    AutoCPRGenerator.updateAutoCPR();
                  }
                });
            }
        });
    },
    
    setupValidation: function() {
        console.log('✅ CPR akış kontrol sistemi hazır');
        
        setTimeout(() => {
            this.updateCPRScore();
        }, 100);
    }
  };
  
  // ============================================
  // 💊 ÜRÜN ODAK & HAZIRLIK
  // ============================================
  const ProductPrep = (function(){
    const KEY = 'fastcpr_productprep_v2';

    const QUICK_SUPERIORITY = [
      'Etkinlik üstünlüğü',
      'Güvenlilik profili',
      'Günde tek doz kolaylığı',
      'Hızlı etki başlangıcı',
      'Hasta uyumu / devamlılık',
      'Stabilite / ambalaj avantajı',
      'Geniş spektrum / kapsayıcılık'
    ];

    let state = {
      products: [],
      competitors: [],
      activeProduct: '',
      activeCompetitor: '',
      superiority: '',
    };

    function load(){
      try{
        const raw = localStorage.getItem(KEY);
        if(raw){
          const parsed = JSON.parse(raw);
          if(parsed && typeof parsed === 'object') state = Object.assign(state, parsed);
        }
      }catch(e){}
    }

    function save(){
      try{ localStorage.setItem(KEY, JSON.stringify(state)); }catch(e){}
    }

    function titleCaseTR(input){
      const s = (input || '').trim().replace(/\s+/g,' ');
      if(!s) return '';
      return s.split(' ').map(w=>{
        const first = w.slice(0,1).toLocaleUpperCase('tr-TR');
        const rest  = w.slice(1).toLocaleLowerCase('tr-TR');
        return first + rest;
      }).join(' ');
    }

    function setActiveProduct(name){
      state.activeProduct = name;
      save();
      render();
    }

    function addProduct(name){
      const n = titleCaseTR(name);
      if(!n) return;
      if(!state.products.includes(n)) state.products.unshift(n);
      state.activeProduct = n;
      save();
      render();
    }

    function removeProduct(name){
      state.products = state.products.filter(p=>p!==name);
      if(state.activeProduct === name) state.activeProduct = state.products[0] || '';
      save();
      render();
    }

    function setActiveCompetitor(name){
      state.activeCompetitor = name;
      save();
      renderCompetitors();
    }

    function addCompetitor(name){
      const n = titleCaseTR(name);
      if(!n) return;
      if(!state.competitors.includes(n)) state.competitors.unshift(n);
      state.activeCompetitor = n;
      save();
      renderCompetitors();
    }

    function removeCompetitor(name){
      state.competitors = state.competitors.filter(c=>c!==name);
      if(state.activeCompetitor === name) state.activeCompetitor = state.competitors[0] || '';
      save();
      renderCompetitors();
    }

    function setSuperiority(text){
      state.superiority = (text || '').trim();
      save();
    }

    function el(id){ return document.getElementById(id); }

    function pill(label, opts){
      const d = document.createElement('div');
      d.className = 'pill ' + (opts.className || '');
      d.textContent = label;
      if(opts.onClick){
        d.classList.add('clickable');
        d.addEventListener('click', opts.onClick);
      }
      if(opts.onDblClick){
        d.addEventListener('dblclick', opts.onDblClick);
      }
      return d;
    }

    function pillWithRemove(label, onRemove, isActive = false) {
      const d = document.createElement('div');
      d.className = 'pill removable clickable ' + (isActive ? 'active' : '');
      
      const textSpan = document.createElement('span');
      textSpan.textContent = label;
      textSpan.style.flex = '1';
      textSpan.style.marginRight = '4px';
      
      const removeBtn = document.createElement('span');
      removeBtn.className = 'x';
      removeBtn.textContent = '×';
      removeBtn.title = 'Kaldır';
      removeBtn.style.cursor = 'pointer';
      removeBtn.style.fontWeight = 'bold';
      removeBtn.style.opacity = '0.7';
      removeBtn.style.marginLeft = '4px';
      removeBtn.style.padding = '0 2px';
      removeBtn.style.borderRadius = '50%';
      removeBtn.style.width = '16px';
      removeBtn.style.height = '16px';
      removeBtn.style.display = 'flex';
      removeBtn.style.alignItems = 'center';
      removeBtn.style.justifyContent = 'center';
      removeBtn.style.backgroundColor = 'rgba(0,0,0,0.05)';
      
      removeBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        onRemove();
      });
      
      removeBtn.addEventListener('mouseenter', () => {
        removeBtn.style.backgroundColor = 'rgba(239, 68, 68, 0.2)';
        removeBtn.style.opacity = '1';
      });
      
      removeBtn.addEventListener('mouseleave', () => {
        removeBtn.style.backgroundColor = 'rgba(0,0,0,0.05)';
        removeBtn.style.opacity = '0.7';
      });
      
      d.appendChild(textSpan);
      d.appendChild(removeBtn);
      
      return d;
    }

    function renderProducts(){
      const wrap = el('productPills');
      const label = el('activeProductLabel');
      if(!wrap || !label) return;

      wrap.innerHTML = '';
      label.textContent = 'Seçilen ürün: ' + (state.activeProduct || '—');

      state.products.forEach(p=>{
        const d = pillWithRemove(p, 
          () => removeProduct(p), 
          p === state.activeProduct
        );
        
        d.addEventListener('click', (e) => {
          if (!e.target.classList.contains('x')) {
            setActiveProduct(p);
          }
        });
        
        wrap.appendChild(d);
      });
    }

    function renderCompetitors(){
      const wrap = el('competitorPills');
      const label = el('activeCompetitorLabel');
      if(!wrap || !label) return;

      wrap.innerHTML = '';
      label.textContent = 'Seçilen rakip: ' + (state.activeCompetitor || '—');

      state.competitors.forEach(c=>{
        const d = pillWithRemove(c, 
          () => removeCompetitor(c), 
          c === state.activeCompetitor
        );
        
        d.addEventListener('click', (e) => {
          if (!e.target.classList.contains('x')) {
            setActiveCompetitor(c);
          }
        });
        
        wrap.appendChild(d);
      });
    }

    function renderSuperiority(){
      const wrap = el('superiorityPills');
      const input = el('superiorityInput');
      if(!wrap || !input) return;

      wrap.innerHTML = '';
      QUICK_SUPERIORITY.forEach(s=>{
        const d = pill(s, {
          className: 'clickable',
          onClick: ()=>{
            input.value = s;
            setSuperiority(s);
          }
        });
        wrap.appendChild(d);
      });

      input.value = state.superiority || '';
      input.addEventListener('input', ()=>setSuperiority(input.value));
    }

    function bind(){
      const addProductBtn = el('addProductBtn');
      const productInput = el('productNameInput');
      const addCompetitorBtn = el('addCompetitorBtn');
      const competitorInput = el('competitorNameInput');

      if(addProductBtn && productInput){
        addProductBtn.addEventListener('click', ()=>{
          addProduct(productInput.value);
          productInput.value = '';
          productInput.blur();
        });
        productInput.addEventListener('keydown', (e)=>{
          if(e.key === 'Enter'){ e.preventDefault(); addProductBtn.click(); }
        });
      }

      if(addCompetitorBtn && competitorInput){
        addCompetitorBtn.addEventListener('click', ()=>{
          addCompetitor(competitorInput.value);
          competitorInput.value = '';
          competitorInput.blur();
        });
        competitorInput.addEventListener('keydown', (e)=>{
          if(e.key === 'Enter'){ e.preventDefault(); addCompetitorBtn.click(); }
        });
      }
    }

    function render(){
      renderProducts();
      renderCompetitors();
      renderSuperiority();
    }

    function init(){
      load();
      bind();
      if(!state.activeProduct && state.products.length) state.activeProduct = state.products[0];
      if(!state.activeCompetitor && state.competitors.length) state.activeCompetitor = state.competitors[0];
      render();
      
      console.log('✅ Bağımsız Ürün/Rakip sistemi hazır');
    }

    return { 
      init,
      getState: () => state,
      addProduct,
      removeProduct,
      addCompetitor,
      removeCompetitor
    };
  })();

  // ============================================
  // 🛠️ UTILITY FONKSİYONLAR
  // ============================================
  
  function showMobileNotification(message, type = 'info') {
    const area = document.getElementById('mobileNotificationArea');
    if (!area) return;
    
    const notification = document.createElement('div');
    notification.className = `mobile-notification ${type}`;
    
    let icon = 'ℹ️';
    if (type === 'success') icon = '✅';
    if (type === 'warning') icon = '⚠️';
    if (type === 'error') icon = '❌';
    if (type === 'info') icon = 'ℹ️';
    
    notification.innerHTML = `
      <span class="icon">${icon}</span>
      <span class="message">${message}</span>
      <button class="close-btn" aria-label="Kapat">×</button>
    `;
    
    area.appendChild(notification);
    
    notification.querySelector('.close-btn').addEventListener('click', () => {
      removeNotification(notification);
    });
    
    setTimeout(() => {
      removeNotification(notification);
    }, 4000);
    
    return notification;
  }
  
  function removeNotification(notification) {
    if (!notification || !notification.parentNode) return;
    
    notification.style.opacity = '0';
    notification.style.transform = 'translateX(-50%) translateY(-10px)';
    notification.style.transition = 'opacity 0.3s, transform 0.3s';
    
    setTimeout(() => {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 300);
  }

  // ============================================
  // 🚀 TÜM SİSTEMLERİ BAŞLAT
  // ============================================
  document.addEventListener('DOMContentLoaded', function() {
    console.log('🚀 FAST CPR KOÇU - AÇIK SÜRÜM v3.2026');
    
    try {
      setTimeout(() => {
        AutoCPRGenerator.init();
        FormGate.init();
        SocialStyle.init();
        SocialLearningStyleManager.init();
        MobileFeatures.init();
        CPRFlowControl.init();
        ProductPrep.init();
        
        const fullReportBtn = document.getElementById('fullReportPDF');
        if (fullReportBtn) {
          fullReportBtn.addEventListener('click', () => {
            ComprehensivePDFReport.generateFullReport();
          });
          
          fullReportBtn.addEventListener('mouseenter', () => {
            if (!fullReportBtn.innerHTML.includes('Oluşturuluyor')) {
              fullReportBtn.style.background = '#2563eb';
              fullReportBtn.style.transform = 'scale(1.02)';
              fullReportBtn.style.transition = 'all 0.2s ease';
            }
          });
          
          fullReportBtn.addEventListener('mouseleave', () => {
            if (!fullReportBtn.innerHTML.includes('Oluşturuluyor')) {
              fullReportBtn.style.background = '#3b82f6';
              fullReportBtn.style.transform = 'scale(1)';
            }
          });
        }
        
        document.querySelectorAll('.voice-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.preventDefault();
            
            if (btn.disabled) {
              showMobileNotification('Bu alan Temel CPR ≥ 13 olmadan kullanılamaz', 'warning');
              return;
            }
            
            const targetId = btn.getAttribute('data-target');
            if (targetId && MobileFeatures.SpeechToText) {
              MobileFeatures.SpeechToText.toggleListening(targetId);
            }
          });
        });
        
        document.querySelectorAll('.styled-cpr-area').forEach(textarea => {
          textarea.setAttribute('data-original-placeholder', textarea.placeholder);
        });
        
        const style = document.createElement('style');
        style.textContent = `
          .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
          }
          .header-left {
            flex: 1;
            min-width: 300px;
          }
          .pdf-button-container {
            flex-shrink: 0;
          }
          .auto-cpr-section {
            margin-top: 30px;
            border-color: #3b82f6;
            position: relative;
          }
          .section-label {
            position: absolute;
            top: -10px;
            left: 16px;
            background: white;
            padding: 4px 10px;
            font-size: 11px;
            font-weight: 600;
            color: #1d4ed8;
            border: 1px solid #3b82f6;
            border-radius: 20px;
            letter-spacing: 0.02em;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.1);
          }
          .behavior-details summary .arrow {
            transition: transform 0.3s ease;
            font-size: 12px;
            margin-left: 10px;
          }
          .behavior-details[open] summary .arrow {
            transform: rotate(90deg);
          }
          @media (max-width: 768px) {
            .header-top {
              flex-direction: column;
              gap: 15px;
            }
            .header-left {
              min-width: auto;
              width: 100%;
            }
            .pdf-button-container {
              align-self: flex-start;
            }
          }
        `;
        document.head.appendChild(style);
        
        console.log('✅ TÜM SİSTEMLER BAŞLATILDI! (Açık Sürüm)');
        
        setTimeout(() => {
          if (!navigator.onLine) {
            showMobileNotification('Çevrimdışı moddasınız. Çalışmalarınız yerelde kaydedilecek.', 'warning');
          }
          
          const drafts = MobileFeatures.DraftSystem.getAllDrafts();
          if (drafts.length > 0) {
            console.log(`📊 ${drafts.length} kayıtlı draft bulundu`);
            showMobileNotification(`${drafts.length} kayıtlı draft bulundu. "Draft Listesi" butonundan yükleyebilirsiniz.`, 'info');
          }
          
          AutoCPRGenerator.updateAutoCPR();
          
          const initialScore = CPRFlowControl.updateCPRScore();
          console.log(`📊 Başlangıç CPR skoru: ${initialScore}/22`);
          
          if (initialScore < 13) {
            showMobileNotification(`Temel CPR skorunuz: ${initialScore}/22. Stil alanları için ${13 - initialScore} puan daha gerekiyor.`, 'info');
          } else {
            showMobileNotification(`🎉 Tebrikler! Temel CPR skorunuz: ${initialScore}/22. Stil alanları aktif!`, 'success');
          }
        }, 500);
        
      }, 1000);
      
    } catch (error) {
      console.error('Başlatma hatası:', error);
      
      const errorDiv = document.createElement('div');
      errorDiv.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        text-align: center;
        z-index: 10000;
        max-width: 400px;
        border: 2px solid #ef4444;
      `;
      errorDiv.innerHTML = `
        <h3 style="color: #ef4444; margin-top: 0;">⛔ Sistem Hatası</h3>
        <p>Araç başlatılırken bir hata oluştu.</p>
        <p>Lütfen sayfayı yenileyin veya tekrar deneyin.</p>
        <button onclick="location.reload()" style="
          background: #3b82f6;
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 8px;
          margin-top: 15px;
          cursor: pointer;
        ">Sayfayı Yenile</button>
      `;
      document.body.appendChild(errorDiv);
    }
  });

// === Akıllı Bağlaç Motoru Entegrasyonu ===
(function(){
  const _orig = AutoCPRGenerator.updateAutoCPR.bind(AutoCPRGenerator);
  AutoCPRGenerator.updateAutoCPR = function(){
    _orig();
    const advEl = document.getElementById('base_adv');
    const outEl = document.getElementById('autoCPR');
    const styleBtn = document.querySelector('.pill-btn.active');
    const style = styleBtn ? styleBtn.getAttribute('data-social-style') : 'Analitik';
    if(!advEl || !outEl) return;
    const adv = advEl.value || "";
    const cat = TGE.detectAdvantageCategory(adv);
    const punct = /[.,]$/.test(adv) ? adv.slice(-1) : ",";
    const conj = TGE.selectConjunction(style, cat, punct);
    outEl.value = outEl.value.replace(/\b(Bu nedenle|Böylece|Bu sayede)\b/i, conj);
  };
})();

  </script>

  <script>
  // === NLP Karar Mekanizması – FULL SCAN OVERRIDE ===
  (function(){
    if(!window.TGE) return;
    TGE.detectAdvantageCategory = function(text){
      if(!text) return "A3";
      const t = text.toLowerCase();

      if(/(sitokin|inhibe|baskıla|reseptör|yolak|enzim|molekül|sentez)/.test(t)){
        console.log("[NLP] Advantage Kategori: A2 (Mekanizma)");
        return "A2";
      }

      if(/(%|\bmg\b|\boran\b|\bkat\b|\bdoz\b|istatistik)/.test(t)){
        console.log("[NLP] Advantage Kategori: A1 (Veri)");
        return "A1";
      }

      if(/(pratik|uyum|hasta dostu|form|ambalaj)/.test(t)){
        console.log("[NLP] Advantage Kategori: A4 (Uyum)");
        return "A4";
      }

      console.log("[NLP] Advantage Kategori: A3 (Genel)");
      return "A3";
    };
  })();
  </script>

  <script>
  /* === Learning Style Draft Generator (Isolated Module) === */
  window.LearningStyleDraftGenerator = (function(){

    function splitSentences(text){
      return text.split(/(?<=[.!?])\s+/);
    }

    function activist(text){
      let t = String(text || "").trim();
      if(!t) return "";

      t = t.replace(/^Klinik pratiğinizde\s+(.+?)\s+şikayetiyle\s+başvuran\s+hastalarınızda,\s*/i, (m, complaint) => {
        let c = String(complaint || "").trim();
        c = c.replace(/\s+a\s+bağlı\s+/gi, " ");
        c = c.replace(/\bzorlanma\b/gi, "zorlanan")
             .replace(/\bkısıtlılık\b/gi, "kısıtlılığı yaşayan")
             .replace(/\bazalma\b/gi, "azalan")
             .replace(/\bbozulma\b/gi, "bozulan");

        const alreadyParticiple = /\b(yan|yen|anan|enen|lanan|lenen|zorlanan|azalan|artan|düşen)\b$/i.test(c);
        const tail = alreadyParticiple ? "" : " yaşayan";
        const C = c ? (c.charAt(0).toLocaleUpperCase("tr-TR") + c.slice(1)) : "Bu şikayetleri";
        return `${C}${tail} hastalarınızda, `;
      });
      t = t.replace(/^Klinik pratiğinizde\s+/i, "");

      const bannedMap = [
        [/teorik olarak/gi, "Hızla"],
        [/protokoller uyarınca/gi, "Pratikte"],
        [/istatistiksel veriler/gi, "Doğrudan sahadaki gözlemler"],
        [/kılavuzlar uyarınca/gi, "Pratikte"],
        [/teorik açıdan/gi, "Doğrudan"],
      ];
      bannedMap.forEach(([rx, rep]) => { t = t.replace(rx, rep); });

      const connectorMap = [
        [/Bu kontrolün bir çıktısı olarak/gi, "Böylece"],
        [/Klinik yansıması olarak/gi, "Sonuç olarak hızla"],
        [/Bu nedenle/gi, "Doğrudan"],
        [/Bu sayede/gi, "Hızla"],
      ];
      connectorMap.forEach(([rx, rep]) => { t = t.replace(rx, rep); });

      t = t.replace(/\bdestekler\b/gi, "destekleyin")
           .replace(/\bönerir misiniz\?\b/gi, "vakit kaybetmeden başlatın! Farkı hemen gözlemleyin.");

      const splitLongSentences = (text) => {
        const parts = text.match(/[^.!?]+[.!?]?/g) || [text];
        const out = [];

        for (let raw of parts) {
          let s = raw.trim();
          if(!s) continue;

          const words = s.replace(/[!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~]/g,"").split(/\s+/).filter(Boolean);
          if (words.length <= 12) { out.push(s); continue; }

          let cut = 12;
          const lookback = Math.max(6, cut - 6);
          for (let i = cut; i >= lookback; i--) {
            const w = words[i-1] || "";
            if (/[,:;]/.test(w) || /^(ve|ama|fakat|ancak|çünkü|sonra)$/i.test(w)) { cut = i; break; }
          }

          const first = words.slice(0, cut).join(" ").replace(/[,:;]+$/,"").trim();
          const second = words.slice(cut).join(" ").trim();

          const endMark = /[.!?]$/.test(s) ? s.slice(-1) : ".";
          out.push(first + ".");
          out.push(second.replace(/^[,;:\s]+/,"") + endMark);
        }

        return out.join(" ").replace(/\s+/g," ").trim();
      };

      t = splitLongSentences(t);

      if (!/^(Hızla|Doğrudan|Pratikte|Hızla sonuç)/i.test(t)) {
        t = "Hızla sonuç almak adına; " + t;
      }
      return t.trim();
    }

    const StyleMotor = {
      generate(base, style){
        let t = String(base || "").trim();
        if(!t) return "";

        const qPattern = /\b(önerir misiniz\?|değerlendirir misiniz\?|tercih eder misiniz\?|başlatır mısınız\?)/gi;

        const maps = {
          activist: {
            q: "hemen denemeye hazır mısınız?",
            prefix: "Hızla sonuç almak adına; ",
            suffix: " Harekete geçin, farkı anında hissedin!",
            map: {
              "sağlar":"hemen sağlar",
              "sunar":"anında sunar",
              "destekler":"hızla destekler",
              "dindirir":"çabucak dindirir",
              "iyileştirir":"hızla iyileştirir",
              "eder":"hemen eder",
              "yapar":"anında yapar",
              "etkilidir":"hemen etkilidir",
              "çözer":"çabucak çözer",
              "giderir":"hızla giderir",
              "kullanılır":"hemen kullanılır",
              "uygulanır":"anında uygulanır",
              "azaltır":"hızla azaltır"
            }
          },
          reflector: {
            q: "birlikte değerlendirelim mi?",
            prefix: "Klinik gözlemlerinizi dikkate alarak; ",
            suffix: " Dilerseniz verileri birlikte izleyebiliriz.",
            map: {
              "sağlar":"sağladığı gözlemlenmiştir",
              "sunar":"sunduğu izlenmektedir",
              "destekler":"desteklediği görülmektedir",
              "dindirir":"dindirdiği izlenmektedir",
              "iyileştirir":"iyileştirdiği gözlemlenmiştir",
              "eder":"ettiği izlenmektedir",
              "yapar":"yaptığı görülmektedir",
              "etkilidir":"etkili olduğu görülmektedir",
              "çözer":"çözdüğü izlenmektedir",
              "giderir":"giderdiği gözlemlenmiştir",
              "kullanılır":"kullanıldığı izlenmektedir",
              "uygulanır":"uygulandığı görülmektedir",
              "azaltır":"azalttığı izlenmektedir"
            }
          },
          theorist: {
            q: "kılavuz yaklaşımıyla değerlendirir misiniz?",
            prefix: "Mekanizma ve sebep-sonuç ilişkisi çerçevesinde; ",
            suffix: " Bu yaklaşım rasyonel zeminde güçlü bir gerekçe sunar.",
            map: {
              "sağlar":"mekanizma düzeyinde sağlar",
              "sunar":"rasyonel bir çerçeve sunar",
              "destekler":"patofizyolojik olarak destekler",
              "dindirir":"inflamatuar yanıtı dindirir",
              "iyileştirir":"biyolojik olarak iyileştirir",
              "eder":"mekanistik olarak eder",
              "yapar":"mekanizma üzerinden yapar",
              "etkilidir":"mekanistik olarak etkilidir",
              "çözer":"nedensel olarak çözer",
              "giderir":"mekanizma üzerinden giderir",
              "kullanılır":"kılavuz pratiğinde kullanılır",
              "uygulanır":"standart protokolle uygulanır",
              "azaltır":"biyolojik yükü azaltır"
            }
          },
          pragmatist: {
            q: "rutin pratiğinize dahil eder misiniz?",
            prefix: "Günlük pratiğinizde uygulanabilirlik açısından; ",
            suffix: " Pratik akışınıza kolayca oturur.",
            map: {
              "sağlar":"pratik bir çözüm olarak sağlar",
              "sunar":"günlük akışta çözüm sunar",
              "destekler":"rutin kullanımda destekler",
              "dindirir":"iş akışında hızla dindirir",
              "iyileştirir":"pratikte iyileştirir",
              "eder":"uygulamada eder",
              "yapar":"işi kolaylaştıracak şekilde yapar",
              "etkilidir":"pratikte etkilidir",
              "çözer":"günlük rutinde çözer",
              "giderir":"pratikte giderir",
              "kullanılır":"rutin kullanımda kullanılır",
              "uygulanır":"kolayca uygulanır",
              "azaltır":"kısa sürede azaltır"
            }
          }
        };

        const cfg = maps[style];
        if(!cfg) return t;

        t = t.replace(qPattern, cfg.q);
        t = applyMap(t, cfg.map);
        t = ensureText(cfg.prefix + t + cfg.suffix);

        return t;
      }
    };

    function applyMap(text, map){
      let t = text;
      Object.keys(map).forEach(key => {
        const regex = new RegExp(`\\b${key}\\b`, 'gi');
        t = t.replace(regex, map[key]);
      });
      return t;
    }

    function ensureText(text){
      return text.trim().replace(/\s+/g, ' ');
    }

    window.StyleMotor = StyleMotor;
    window.LearningStyleDraftGenerator = window.LearningStyleDraftGenerator || {};
    window.LearningStyleDraftGenerator.generate = function(base, style){
      return StyleMotor.generate(base, style);
    };

    document.addEventListener('click', function(e){
      const btn = e.target.closest && e.target.closest('[data-copy-base-to-style]');
      if(!btn) return;

      e.preventDefault();
      e.stopImmediatePropagation();

      const style = btn.getAttribute('data-copy-base-to-style');
      const base = document.getElementById('autoCPR')?.value?.trim() || "";

      if(!base || base.length < 10){
        window.showMobileNotification && showMobileNotification('Önce CPR\'ı onaylayın (✅ CPR Onay).', 'warning');
        return;
      }

      const target = document.getElementById(style + "_cpr");
      if(!target){
        window.showMobileNotification && showMobileNotification('Stil alanı bulunamadı.', 'error');
        return;
      }

      const transformed = StyleMotor.generate(base, style);
      target.disabled = false;
      target.value = transformed;
      target.dispatchEvent(new Event('input', {bubbles:true}));

      try { target.scrollIntoView({behavior:'smooth', block:'center'}); } catch(_){}

      const pretty = {activist:'Aktivist', reflector:'Reflektör', theorist:'Teorist', pragmatist:'Pragmatist'}[style] || style;
      window.showMobileNotification && showMobileNotification(`✨ Temel CPR, ${pretty} stilinde dönüştürüldü.`, 'success');
    }, true);

  })();
  </script>

  <script>
  /* ============================================
   * 🧠 LearningStyleEngine (Rule-based v1)
   * Kaynak: stil cpr geliştirme dokümanı
   * ============================================ */
  const LSE = {
    applyStyle(baseText, style) {
      if (!baseText) return "";
      switch (style) {
        case "activist":   return this.activist(baseText);
        case "reflector":  return this.reflector(baseText);
        case "theorist":   return this.theorist(baseText);
        case "pragmatist": return this.pragmatist(baseText);
        default: return baseText;
      }
    },

    activist(text) {
      let t = text;
      t = t.replace(/sağlar|destekler|beklenir/gi, "üstünlüğü ile hemen harekete geçirir");
      t = t.replace(/sonucunda/gi, "beklemeden, doğrudan deneyimleyerek");
      return `🚀 **Aksiyon ve Deneyim:** ${t} Hastalarınızın bir an önce tedaviye başlaması için bu dinamik yaklaşımı hemen değerlendirin.`;
    },

    reflector(text) {
      let t = text;
      t = t.replace(/sayesinde|ile/gi, "verileri diğer seçeneklerle kıyaslandığında");
      t = t.replace(/görülür/gi, "klinik olarak titizlikle gözlemlenir");
      return `🧐 **Gözlem ve Kıyas:** ${t} Mevcut verilerin sakin bir değerlendirmesi ve sonuçların izlenmesi kararın doğruluğunu netleştirecektir.`;
    },

    theorist(text) {
      let t = text;
      t = t.replace(/etki eder/gi, "patofizyolojik kaskad üzerinde rasyonel bir denge kurar");
      t = t.replace(/sonucu/gi, "serum plazma düzeyi stabilitesi uyarınca");
      return `📚 **Teorik ve Sistematik:** ${t} Süreç, rasyonel tedavi ilkeleri ve yapılandırılmış bir mekanizma çerçevesinde garanti altına alınmıştır.`;
    },

    pragmatist(text) {
      let t = text;
      t = t.replace(/avantajdır|kolaydır/gi, "günlük pratikte işe yarayan somut bir çözümdür");
      t = t.replace(/sağlar/gi, "hasta uyumunu doğrudan artırarak sonuç verir");
      return `🛠️ **Pratik ve Uygulanabilir:** ${t} Karmaşık teoriler yerine, hızla hayata geçirilebilir bu çözümle net fayda elde edin.`;
    }
  };

  const LearningStyleEngine = {
    apply(style, baseText){
      return LSE.applyStyle(baseText, (style||"").toLowerCase());
    }
  };

  document.addEventListener('click', function(e){
    const btn = e.target.closest('[data-copy-base-to-style]');
    if(!btn) return;

    e.preventDefault();
    e.stopImmediatePropagation();

    const style = btn.getAttribute('data-copy-base-to-style');
    const base = document.getElementById('autoCPR')?.value || "";

    const transformed = LearningStyleEngine.apply(style, base);

    const target = document.querySelector(`textarea[data-style="${style}"]`);
    if(target){
      target.value = transformed;
    }
  });
  </script>

</body>
</html>
