<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes, viewport-fit=cover" />
  <title>FAST CPR KOÃ‡U - GÃœVENLÄ° SÃœRÃœM</title>
  
  <!-- GÃ–RÃœNMEZ DOÄRULAMA ETÄ°KETÄ° -->
  <span id="__verify__" style="display:none">FAST_CPR_v3_2024_LIC_9B7A2C</span>
  
  <script>
  /* ============================================
     KATMANLI KORUMA SÄ°STEMÄ° - TAM ZAMAN BOMBASI
     ============================================ */
  
  // Domain kontrolÃ¼nÃ¼ sayfa yÃ¼klendikten sonra yap
  document.addEventListener('DOMContentLoaded', function() {
    // 1. DOMAÄ°N KONTROLÃœ (SERT ENGEL)
    const allowedOrigins = [
      'localhost',
      '127.0.0.1',
      'cpr-koÃ§u.com',
      'iskendereser.github.io',
      'file://'  // Dosya sisteminden Ã§alÄ±ÅŸtÄ±rmak iÃ§in
    ];
    
    const currentOrigin = window.location.hostname || window.location.protocol + '//';
    const isAllowedOrigin = allowedOrigins.some(origin => 
      currentOrigin.includes(origin) || 
      window.location.protocol === 'file:'  // Dosya sistemi izni
    );
    
    // Domain izinli deÄŸilse ANINDA ENGELLE
    if (!isAllowedOrigin && window.location.protocol !== 'file:') {
      console.error('â›” Domain lisans ihlali: ' + currentOrigin);
      
      // ANINDA EKRAN KÄ°LÄ°DÄ°
      document.body.innerHTML = `
        <div style="
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: linear-gradient(135deg, #1a1a2e, #16213e);
          color: white;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          font-family: sans-serif;
          text-align: center;
          padding: 20px;
          z-index: 100000;
        ">
          <div style="font-size: 48px; margin-bottom: 20px;">â›”</div>
          <h1 style="color: #ff6b6b; margin-bottom: 10px;">LÄ°SANS Ä°HLALÄ°</h1>
          <p style="margin-bottom: 20px; max-width: 500px;">
            Bu domain iÃ§in lisans bulunmamaktadÄ±r.<br>
            Orijinal sÃ¼rÃ¼m sadece <strong>cpr-koÃ§u.com</strong> Ã¼zerinden eriÅŸilebilir.
          </p>
          <div style="
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-family: monospace;
            font-size: 14px;
          ">
            Ä°hlal edilen domain: <span style="color: #ff6b6b;">${currentOrigin}</span>
          </div>
          <a href="https://cpr-koÃ§u.com" style="
            background: #3b82f6;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            margin-top: 10px;
          ">ORÄ°JÄ°NAL SÄ°TEYE GÄ°T</a>
        </div>
      `;
      throw new Error('License violation - invalid domain');
    }
  });
  </script>

  <script src="https://unpkg.com/pdfmake@0.2.7/build/pdfmake.min.js"></script>
  <script src="https://unpkg.com/pdfmake@0.2.7/build/vfs_fonts.js"></script>
  
  <style>
    /* ============================================
       CSS RESET ve TEMEL STÄ°LLER
       ============================================ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --bg: #ffffff;
      --text: #111;
      --muted: #666;
      --border: #e6e6e6;
      --soft: #fafafa;
      --accent: #0b5fff;
      --ok: #137333;
      --warn: #b06000;
      --bad: #b3261e;
      --shadow: 0 10px 30px rgba(0,0,0,0.06);
      --radius: 16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      --touch-target: 44px;
      --mobile-padding: 12px;
      --keyboard-safe: env(safe-area-inset-bottom, 0px);
    }
    
    body {
      font-family: var(--sans);
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      font-size: 14px;
      padding: 0;
      margin: 0;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* ============================================
       BAÅLIK ve ÃœST BÃ–LÃœM
       ============================================ */
    header {
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }
    
    header h1 {
      font-size: 24px;
      margin-bottom: 8px;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .sub {
      color: var(--muted);
      font-size: 12px;
      margin-bottom: 15px;
    }
    
    .badgeRow {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }
    
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      white-space: nowrap;
    }
    
    .pill.soft {
      background: var(--soft);
      border: 1px solid var(--border);
      color: var(--muted);
    }
    
    .pill.ok {
      background: #ecfdf3;
      border: 1px solid #bbf7d0;
      color: #166534;
    }
    
    .pill.warn {
      background: #fffbeb;
      border: 1px solid #fed7aa;
      color: #92400e;
    }
    
    .pill.bad {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #b91c1c;
    }
    
    /* ============================================
       AKORDEON (DETAILS) STÄ°LLERÄ°
       ============================================ */
    .acc {
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 20px;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .acc[open] {
      box-shadow: var(--shadow);
    }
    
    .acc summary {
      list-style: none;
      padding: 20px;
      cursor: pointer;
      background: var(--soft);
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 15px;
    }
    
    .acc summary::-webkit-details-marker {
      display: none;
    }
    
    .accTitle {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .accTitle b {
      font-size: 16px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .accTitle span {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.4;
    }
    
    .accMeta {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
    }
    
    .tag {
      background: var(--accent);
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }
    
    .arrow {
      transition: transform 0.3s ease;
      display: inline-block;
    }
    
    .acc[open] .arrow {
      transform: rotate(90deg);
    }
    
    .accBody {
      padding: 20px;
      border-top: 1px solid var(--border);
      background: white;
    }
    
    /* ============================================
       FORMLAR ve ALANLAR
       ============================================ */
    .fieldRow {
      margin-bottom: 20px;
    }
    
    .fieldRow:last-child {
      margin-bottom: 0;
    }
    
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text);
      font-size: 14px;
    }
    
    .small {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
      display: block;
    }
    
    input[type="text"],
    textarea {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-family: var(--sans);
      font-size: 14px;
      transition: all 0.2s ease;
      background: white;
    }
    
    input[type="text"]:focus,
    textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(11, 95, 255, 0.1);
    }
    
    textarea {
      min-height: 100px;
      resize: vertical;
      line-height: 1.5;
    }
    
    .hint {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 10px;
      display: block;
    }
    
    .notice {
      background: #eff6ff;
      border: 1px solid #dbeafe;
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 13px;
      margin-top: 8px;
      color: #1e40af;
    }
    
    /* ============================================
       CPR BÃ–LÃœMLERÄ°
       ============================================ */
    .cpr-section-card {
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      position: relative;
    }
    
    .cpr-section-card:last-child {
      margin-bottom: 0;
    }
    
    .claim-group {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .claim-step {
      flex: 1;
    }
    
    .claim-step.problem {
      border-bottom: 1px solid var(--border);
      padding-bottom: 15px;
    }
    
    .textarea-wrapper {
      position: relative;
      margin-top: 8px;
    }
    
    .voice-btn {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: var(--soft);
      border: 1px solid var(--border);
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .voice-btn:hover {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    
    .voice-btn.listening {
      background: #ef4444;
      color: white;
      border-color: #ef4444;
      animation: pulse 1s infinite;
    }
    
    .hint-box {
      background: var(--soft);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      margin-top: 12px;
      font-size: 13px;
      color: var(--muted);
      display: none;
    }
    
    .hint-box.show {
      display: block;
    }
    
    .fieldTools {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 15px;
    }
    
    /* ============================================
       BUTONLAR
       ============================================ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      border: 1px solid transparent;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      white-space: nowrap;
    }
    
    .btn.primary {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    
    .btn.primary:hover {
      background: #1d4ed8;
      border-color: #1d4ed8;
    }
    
    .btn.ghost {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
    }
    
    .btn.ghost:hover {
      background: var(--soft);
      border-color: var(--accent);
      color: var(--accent);
    }
    
    .btn.small {
      padding: 4px 10px;
      font-size: 12px;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    /* ============================================
       STÄ°L CPR KARTLARI
       ============================================ */
    .styleGrid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .styleCard {
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .styleHeader {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
    }
    
    .styleTitle {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .styleBadge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      background: var(--soft);
      border-radius: 12px;
      font-size: 11px;
    }
    
    .styleBody {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.5;
    }
    
    .styleBody ul {
      padding-left: 20px;
      margin-top: 8px;
    }
    
    .styleBody li {
      margin-bottom: 4px;
    }
    
    .feedback {
      padding: 10px;
      background: #f0f9ff;
      border-radius: 8px;
      font-size: 12px;
      border: 1px solid #bae6fd;
      color: #0369a1;
    }
    
    /* ============================================
       MOBÄ°L Ã–ZELLÄ°KLER
       ============================================ */
    .mobile-toolbar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid var(--border);
      display: flex;
      overflow-x: auto;
      padding: 10px;
      gap: 8px;
      z-index: 1000;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }
    
    .mobile-toolbar button {
      flex-shrink: 0;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: white;
      cursor: pointer;
      font-size: 12px;
      white-space: nowrap;
    }
    
    .mobile-toolbar button.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    
    .draft-indicator {
      position: fixed;
      top: 15px;
      right: 15px;
      background: var(--accent);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      z-index: 1000;
      cursor: pointer;
      box-shadow: var(--shadow);
    }
    
    .draft-indicator.saved {
      background: var(--ok);
    }
    
    .offline-status {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #ef4444;
      color: white;
      padding: 10px;
      text-align: center;
      font-size: 13px;
      z-index: 1001;
      display: none;
    }
    
    .offline-status.offline {
      display: block;
      background: #ef4444;
    }
    
    .offline-status.online {
      display: block;
      background: var(--ok);
    }
    
    #mobileNotificationArea {
      position: fixed;
      bottom: 70px;
      left: 0;
      right: 0;
      z-index: 1000;
      padding: 10px;
      pointer-events: none;
    }
    
    .mobile-notification {
      background: white;
      border-radius: 10px;
      padding: 12px 16px;
      margin-bottom: 10px;
      box-shadow: var(--shadow);
      border-left: 4px solid var(--accent);
      display: flex;
      align-items: center;
      gap: 10px;
      pointer-events: auto;
      animation: slideIn 0.3s ease;
    }
    
    .mobile-notification.success {
      border-left-color: var(--ok);
    }
    
    .mobile-notification.error {
      border-left-color: var(--bad);
    }
    
    .mobile-notification.warning {
      border-left-color: var(--warn);
    }
    
    .mobile-notification .close-btn {
      margin-left: auto;
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
      color: var(--muted);
    }
    
    /* ============================================
       DAVRANIÅ ve Ã–ÄRENME STÄ°LÄ°
       ============================================ */
    .behavior-details {
      border: 1px solid var(--border);
      border-radius: 10px;
      margin-top: 8px;
    }
    
    .behavior-details summary {
      padding: 12px 16px;
      cursor: pointer;
      list-style: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .behavior-details summary::-webkit-details-marker {
      display: none;
    }
    
    .behavior-panel {
      padding: 15px;
      border-top: 1px solid var(--border);
    }
    
    .behavior-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .behavior-pill {
      padding: 6px 12px;
      background: var(--soft);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .behavior-pill.selected {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    
    .selected-behaviors {
      margin-top: 15px;
    }
    
    .selected-behaviors-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .selected-behaviors-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .selected-behavior-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      background: #dbeafe;
      border-radius: 16px;
      font-size: 12px;
    }
    
    .selected-behavior-pill .remove {
      cursor: pointer;
      font-weight: bold;
      color: var(--bad);
    }
    
    .learning-style-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 10px 0;
    }
    
    .learning-style-pill {
      padding: 8px 16px;
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .learning-style-pill.selected {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    
    /* ============================================
       ÃœRÃœN/RAKÄ°P PÄ°LLER
       ============================================ */
    .presetRow {
      background: var(--soft);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .presetRowInner {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .presetCard {
      flex: 1;
      min-width: 150px;
      background: white;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }
    
    .activePreset {
      font-size: 13px;
      color: var(--muted);
      padding: 8px 0;
    }
    
    .kwWrap {
      display: flex;
      gap: 10px;
      margin-bottom: 8px;
    }
    
    .kwWrap input {
      flex: 1;
    }
    
    .removable.pill {
      padding-right: 8px;
      position: relative;
      cursor: pointer;
    }
    
    .removable .x {
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      margin-left: 4px;
      font-weight: bold;
      opacity: 0.7;
      transition: all 0.2s ease;
    }
    
    .removable .x:hover {
      opacity: 1;
      background: rgba(239, 68, 68, 0.2);
    }
    
    .removable.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    
    /* ============================================
       ZAMAN BOMBASI STÄ°LLERÄ°
       ============================================ */
    .time-bomb-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      color: white;
      z-index: 100000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: monospace;
      text-align: center;
      padding: 20px;
    }
    
    .time-bomb-countdown {
      font-size: 48px;
      color: #ff6b6b;
      font-weight: bold;
      margin: 20px 0;
      font-family: monospace;
    }
    
    .time-bomb-details {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      font-family: monospace;
      font-size: 14px;
      max-width: 500px;
      text-align: left;
    }
    
    .time-bomb-code {
      color: #4ecdc4;
      font-weight: bold;
      font-family: monospace;
      letter-spacing: 1px;
    }
    
    .time-bomb-alert {
      color: #ff6b6b;
      font-weight: bold;
      animation: pulse 1s infinite;
    }
    
    /* ============================================
       ANÄ°MASYONLAR
       ============================================ */
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
    
    @keyframes bombPulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
    
    @keyframes slideIn {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    /* ============================================
       RESPONSIVE (MOBÄ°L) STÄ°LLER
       ============================================ */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      header h1 {
        font-size: 20px;
      }
      
      .styleGrid {
        grid-template-columns: 1fr;
      }
      
      .acc summary {
        flex-direction: column;
        gap: 10px;
      }
      
      .accMeta {
        align-self: flex-end;
      }
      
      .presetCard {
        min-width: 100%;
      }
      
      .cpr-section-card {
        padding: 15px;
      }
      
      .mobile-toolbar {
        display: flex;
      }
    }
    
    @media (max-width: 480px) {
      .pill {
        font-size: 11px;
        padding: 4px 8px;
      }
      
      .btn {
        padding: 6px 12px;
        font-size: 12px;
      }
      
      .styleCard {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <!-- ğŸ“± FAZ 3: GELÄ°ÅTÄ°RÄ°LMÄ°Å OFFLINE DURUM GÃ–STERGESÄ° -->
  <div class="offline-status" id="offlineStatus">
    <span class="icon">ğŸ“¡</span>
    <span id="connectivityText">Ã‡evrimdÄ±ÅŸÄ±</span>
  </div>

  <!-- ğŸ“± FAZ 1: MOBÄ°L TOOLBAR -->
  <div class="mobile-toolbar" id="mobileToolbar">
    <button data-action="claim" title="Claim ÅŸablonu">ğŸ“ Claim</button>
    <button data-action="feature" title="Feature ÅŸablonu">âš™ï¸ Feature</button>
    <button data-action="advantage" title="Advantage ÅŸablonu">ğŸš€ Advantage</button>
    <button data-action="benefit" title="Benefit ÅŸablonu">âœ… Benefit</button>
    <button data-action="recommendation" title="Recommendation ÅŸablonu">ğŸ’¡ Recommendation</button>
    <button data-action="copy" title="Kopyala">ğŸ“‹ Kopyala</button>
    <button data-action="paste" title="YapÄ±ÅŸtÄ±r">ğŸ“ YapÄ±ÅŸtÄ±r</button>
    <button data-action="clear" title="Temizle">ğŸ—‘ï¸ Temizle</button>
  </div>

  <!-- ğŸ“± FAZ 2: DRAFT KAYIT GÃ–STERGESÄ° -->
  <div class="draft-indicator" id="draftIndicator" title="Draft durumu">
    ğŸ’¾ Draft
  </div>

  <div class="container">
    <header>
      <div class="header-top">
        <div class="header-left">
          <h1>
            <span class="icon">ğŸ§ </span>
            FAST CPR KOÃ‡U - GÃœVENLÄ°
          </h1>
          <div class="sub">Â© 2024 - TÃ¼m haklarÄ± saklÄ±dÄ±r. Ä°zinsiz kopyalanamaz.</div>
        </div>
        <!-- ğŸ“„ YENÄ° TÃœM RAPOR PDF BUTONU -->
        <div class="pdf-button-container">
          <button class="btn primary" id="fullReportPDF" title="TÃ¼m Ã§alÄ±ÅŸmayÄ± PDF olarak indir">
            <span class="icon">ğŸ“„</span>
            <span>TÃ¼m Raporu PDF'e Aktar</span>
          </button>
        </div>
      </div>
      <div class="badgeRow">
        <div class="pill soft">
          <span class="icon">ğŸ”’</span>
          <span>GÃ¼venli SÃ¼rÃ¼m v3.2024</span>
        </div>
        <div class="pill ok">
          <span class="icon">âœ…</span>
          <span>Temel CPR â‰¥ 13 ise stil CPR'larÄ± aktifleÅŸir</span>
        </div>
      </div>
    </header>
    
    <main>
      <!-- 1. SOSYAL STÄ°L VE Ã–ÄRENME STÄ°LÄ° TANIMLAMA KARTI (AKORDEON - AÃ‡IK) -->
      <details class="acc" data-acc="preparation" id="acc_preparation" open>
        <summary>
          <div class="accTitle">
            <b><span class="arrow">â–¶</span> Sosyal Stil ve Ã–ÄŸrenme Stili TanÄ±mlama</b>
            <span>Bu alanda kaydettiÄŸiniz bilgileri zihinsel hazÄ±rlÄ±k iÃ§indir. Zorunlu deÄŸildir</span>
          </div>
          <div class="accMeta">
            <span class="tag">ğŸ¯ HazÄ±rlÄ±k</span>
          </div>
        </summary>
        
        <div class="accBody">
          <div class="fieldRow">
            <label for="promoContext">Doktor / EczacÄ±nÄ±n Sosyal Stili <span class="small">(LÃ¼tfen <a href="https://iskendereser.github.io/S4Survey/" target="_blank" rel="noopener">FAST S4 Survey</a> kullanÄ±nÄ±z)</span></label>
            <input id="promoContext" type="text" placeholder="Ã–rn: Driving / Analytical / Expressive / Amiable (veya kendi notunuz)" />
          </div>

          <div class="fieldRow">
            <label>
              Uyumlu DavranÄ±ÅŸ Kriterleri 
              <span class="small">(Uyumlanma davranÄ±ÅŸlarÄ±nÄ±zÄ± belirlemek iÃ§in lÃ¼tfen <a href="https://iskendereser.github.io/compare/" target="_blank" rel="noopener">FAST Compare</a> kullanÄ±nÄ±z)</span>
            </label>
            <details class="behavior-details" id="behaviorDetails">
              <summary>
                <span>Uyumlu DavranÄ±ÅŸ Kriterleri SeÃ§in</span>
                <span class="arrow" style="font-size: 12px; margin-left: 10px;">â–¶</span>
              </summary>
              <div class="behavior-panel">
                <div class="behavior-pills" id="behaviorPills">
                  <!-- DavranÄ±ÅŸ pilleri JavaScript ile eklenecek -->
                </div>
                <div class="selected-behaviors">
                  <div class="selected-behaviors-title">SeÃ§ilen DavranÄ±ÅŸlar:</div>
                  <div class="selected-behaviors-list" id="selectedBehaviorsList">
                    <!-- SeÃ§ilen davranÄ±ÅŸlar buraya eklenecek -->
                  </div>
                </div>
              </div>
            </details>
            <div class="small">Birden fazla seÃ§im yapabilirsiniz. SeÃ§im sÄ±nÄ±rÄ± yoktur.</div>
          </div>

          <div class="fieldRow">
            <label for="learningStyle">Ã–ÄŸrenme stilini belirleyiniz <span class="small">(LÃ¼tfen <a href="https://iskendereser.github.io/LSA/" target="_blank" rel="noopener">FAST LSA</a> kullanÄ±nÄ±z)</span></label>
            <div class="learning-style-pills" id="learningStylePills">
              <!-- Ã–ÄŸrenme stili pilleri JavaScript ile eklenecek -->
            </div>
            <input type="hidden" id="learningStyle" value="" />
          </div>
        </div>
      </details>
      
      <!-- 2. ÃœRÃœN-RAKÄ°P-ÃœSTÃœNLÃœKLER-HEDEF KARTI (AKORDEON - KAPALI) -->
      <details class="acc" data-acc="productprep" id="acc_productprep">
        <summary>
          <div class="accTitle">
            <b><span class="arrow">â–¶</span> ÃœrÃ¼n-Rakip-ÃœstÃ¼nlÃ¼kler-Hedef</b>
            <span>ÃœrÃ¼n â†’ Rakip â†’ ÃœstÃ¼n YÃ¶n â†’ SunacaÄŸÄ±nÄ±z Fayda. Bu kart, aÅŸaÄŸÄ±daki CPR yazÄ±mÄ±nda "fener" gibi referans olsun diye vardÄ±r.</span>
          </div>
          <div class="accMeta">
            <span class="tag">ğŸ§­ HazÄ±rlÄ±k</span>
            <div class="counters">
              <div class="counter">
                ğŸ§­ <span>HazÄ±rlÄ±k</span>
              </div>
              <div class="counter">
                ğŸ§  <span>HatÄ±rlatÄ±cÄ±</span>
              </div>
            </div>
          </div>
        </summary>
        
        <div class="accBody">
          <div class="presetRow">
            <div class="presetRowInner">
              <div class="presetCard">
                <span class="icon">ğŸ’Š</span>
                <span>ÃœrÃ¼n seÃ§ / ekle</span>
              </div>
              <div class="presetCard">
                <span class="icon">ğŸ</span>
                <span>Rakip seÃ§ / ekle</span>
              </div>
              <div class="presetCard">
                <span class="icon">â­</span>
                <span>ÃœstÃ¼n yÃ¶n + fayda seÃ§</span>
              </div>
            </div>
            <div class="activePreset" id="activeProductLabel" aria-live="polite">SeÃ§ilen Ã¼rÃ¼n: â€”</div>
          </div>

          <!-- 1) ÃœRÃœN -->
          <div class="fieldRow">
            <label for="productNameInput">ÃœrÃ¼n (ilk kullanÄ±mda elle yazÄ±n)</label>
            <div class="kwWrap">
              <input id="productNameInput" type="text" placeholder="Ã–rn: Zoramisin" />
              <button class="btn ghost small kwAdd" id="addProductBtn" type="button">Ekle</button>
            </div>
            <div class="notice">Ä°pucu: ÃœrÃ¼n adlarÄ± otomatik biÃ§imlendirilir (ilk harf bÃ¼yÃ¼k). Daha sonra pill Ã¼zerinden tek dokunuÅŸla seÃ§ebilirsiniz.</div>
            <div class="badgeRow" id="productPills" style="margin-top:8px;"></div>
          </div>

          <!-- 2) RAKÄ°P -->
          <div class="fieldRow">
            <label for="competitorNameInput">Rakip (elle yazÄ±lÄ±r, kayÄ±t olur)</label>
            <div class="kwWrap">
              <input id="competitorNameInput" type="text" placeholder="Ã–rn: Rakip ÃœrÃ¼n" />
              <button class="btn ghost small kwAdd" id="addCompetitorBtn" type="button">Ekle</button>
            </div>
            <div class="activePreset" id="activeCompetitorLabel" aria-live="polite">SeÃ§ilen rakip: â€”</div>
            <div class="badgeRow" id="competitorPills" style="margin-top:8px;"></div>
          </div>

          <!-- 3) ÃœSTÃœN YÃ–N -->
          <div class="fieldRow">
            <label for="superiorityInput">ÃœstÃ¼n YÃ¶nÃ¼nÃ¼z</label>
            <div class="hint">Ä°stersen aÅŸaÄŸÄ±daki hÄ±zlÄ± seÃ§eneklere dokun, istersen elle yaz.</div>
            <div class="badgeRow" id="superiorityPills"></div>
            <input id="superiorityInput" type="text" placeholder="Ã–rn: GÃ¼nde tek doz ile hasta uyumunu artÄ±rÄ±r" />
          </div>

          <!-- 4) SMART CPR HEDEFÄ° -->
          <div class="fieldRow">
            <label for="promoGoal">SMART CPR hedefinizi yazÄ±n</label>
            <textarea id="promoGoal" class="autoGrow" placeholder="Ã–rn: Bu ziyarette X konuda Y Ã¶lÃ§Ã¼lebilir hedef..." rows="3"></textarea>
          </div>
        </div>
      </details>
      
      <!-- 3. TEMEL CPR KARTI (AKORDEON - KAPALI) -->
      <details class="acc" data-acc="base" id="acc_base">
        <summary>
          <div class="accTitle">
            <b><span class="arrow">â–¶</span> 1) Temel CPR (Stilsiz)</b>
            <span>Sadece CPR yapÄ±sÄ± kontrol edilir. CPR â‰¥ 13 olunca stiller aktifleÅŸir.</span>
          </div>
          <div class="accMeta">
            <span class="tag" id="mini_base">CPR: â€”</span>
            <button class="btn ghost small" id="btnSaveDraft">ğŸ’¾ Kaydet</button>
          </div>
        </summary>
        <div class="accBody">
          <p class="hint">Bu bÃ¶lÃ¼mde <b>stil deÄŸerlendirmesi yapÄ±lmaz</b>. </p>
          
          <!-- CLAIM ALANI -->
          <div class="cpr-section-card" data-section="claim">
            <div class="claim-group">
              <div class="claim-step problem">
                <label for="base_claim_problem">Problemi TanÄ±mlayÄ±n:</label>
                <div class="textarea-wrapper">
                  <textarea id="base_claim_problem" placeholder="Klinik problemi yazÄ±n..."></textarea>
                  <button class="voice-btn" data-target="base_claim_problem" title="Sesli giriÅŸ">ğŸ¤</button>
                </div>
              </div>
              
              <div class="claim-step">
                <label for="base_claim_effect">Etkisini TanÄ±mlayÄ±n:</label>
                <div class="textarea-wrapper">
                  <textarea id="base_claim_effect" placeholder="Bu problemin hasta, hekim veya sÃ¼reÃ§ Ã¼zerindeki etkisini yazÄ±n..."></textarea>
                  <button class="voice-btn" data-target="base_claim_effect" title="Sesli giriÅŸ">ğŸ¤</button>
                </div>
              </div>
            </div>
            <div class="fieldTools">
              <button class="btn ghost small" id="clear_base_claim_problem">Temizle</button>
            </div>
          </div>
          
          <!-- PROPOSITION - Ã–ZELLÄ°K -->
          <div class="cpr-section-card" data-section="feature">
            <label for="base_feat">ÃœrÃ¼n adÄ± ve problemi Ã§Ã¶zen temel Ã¶zelliÄŸi yazÄ±n</label>
            <div class="textarea-wrapper">
              <textarea id="base_feat" placeholder="Ã–rn: ÃœrÃ¼n X, gÃ¼nde tek doz kullanÄ±m ile hasta uyumunu artÄ±rÄ±r"></textarea>
              <button class="voice-btn" data-target="base_feat" title="Sesli giriÅŸ">ğŸ¤</button>
            </div>
            <div class="hint-box" id="hint_base_feat">ÃœrÃ¼nÃ¼nÃ¼zÃ¼n rakiplerden farklÄ±, hastaya saÄŸladÄ±ÄŸÄ± temel Ã§Ã¶zÃ¼mÃ¼ tanÄ±mlayÄ±n.</div>
            <div class="fieldTools">
              <button class="btn ghost small" id="clear_base_feat">Temizle</button>
            </div>
          </div>
          
          <!-- PROPOSITION - AVANTAJ -->
          <div class="cpr-section-card" data-section="advantage">
            <label for="base_adv">Rakiplere gÃ¶re Ã¼stÃ¼nlÃ¼ÄŸÃ¼, ticari isim kullanmadan yazÄ±n</label>
            <div class="textarea-wrapper">
              <textarea id="base_adv" placeholder="Ã–rn: Bu sayede benzer etki gÃ¶sterenlere gÃ¶re gÃ¼nde tek doz kullanÄ±lÄ±r"></textarea>
              <button class="voice-btn" data-target="base_adv" title="Sesli giriÅŸ">ğŸ¤</button>
            </div>
            <div class="hint-box" id="hint_base_adv">Rakip Ã¼rÃ¼nlerle karÅŸÄ±laÅŸtÄ±rma yapÄ±n, ancak rakip ismi kullanmayÄ±n.</div>
            <div class="fieldTools">
              <button class="btn ghost small" id="clear_base_adv">Temizle</button>
            </div>
          </div>
          
          <!-- PROPOSITION - FAYDA -->
          <div class="cpr-section-card" data-section="benefit">
            <label for="base_ben">AvantajÄ±n hastanÄ±n sorununu nasÄ±l rahatlattÄ±ÄŸÄ±nÄ± yazÄ±n</label>
            <div class="textarea-wrapper">
              <textarea id="base_ben" placeholder="Ã–rn: Tedavilerini aksatmadan devam ederler, iÅŸlerini yapmaktan geri kalmazlar"></textarea>
              <button class="voice-btn" data-target="base_ben" title="Sesli giriÅŸ">ğŸ¤</button>
            </div>
            <div class="hint-box" id="hint_base_ben">HastanÄ±n gÃ¼nlÃ¼k yaÅŸamÄ±nda nasÄ±l bir iyileÅŸme/rahatlama saÄŸladÄ±ÄŸÄ±nÄ± aÃ§Ä±klayÄ±n.</div>
            <div class="fieldTools">
              <button class="btn ghost small" id="clear_base_ben">Temizle</button>
            </div>
          </div>
          
          <!-- RECOMMENDATION -->
          <div class="cpr-section-card" data-section="recommendation">
            <label for="base_rec">Problemle iliÅŸkilendirilmiÅŸ reÃ§ete Ã¶neri cÃ¼mlenizi yazÄ±n</label>
            <div class="textarea-wrapper">
              <textarea id="base_rec" placeholder="Ã–rn: Bu tÃ¼r ataklarda, gÃ¼nde tek doz kullanÄ±lan X ile tedaviye bir an Ã¶nce baÅŸlamayÄ± tercih eder misiniz?"></textarea>
              <button class="voice-btn" data-target="base_rec" title="Sesli giriÅŸ">ğŸ¤</button>
            </div>
            <div class="hint-box" id="hint_base_rec">Hekimden bir aksiyon talep edin (reÃ§eteleme, deÄŸiÅŸtirme, baÅŸlama vb.).</div>
            <div class="fieldTools">
              <button class="btn ghost small" id="clear_base_rec">Temizle</button>
            </div>
          </div>
          
          <div class="fieldTools" style="justify-content: space-between; margin-top: 20px;">
            <div>
              <button class="btn ghost small" id="btnLoadDraft" style="display: none;">ğŸ“‚ Draft YÃ¼kle</button>
              <button class="btn ghost small" id="btnShowDrafts">ğŸ“‹ Draft Listesi</button>
            </div>
            <div>
              <button class="btn ghost small" id="btnClearAllDrafts">ğŸ—‘ï¸ TÃ¼mÃ¼nÃ¼ Temizle</button>
            </div>
          </div>
        </div>
      </details>
      
      <!-- ğŸ“ OTOMATÄ°K CPR Ã–ZETÄ° BÃ–LÃœMÃœ -->
      <div class="cpr-section-card auto-cpr-section">
        <div class="section-label">
          <span class="icon">ğŸ¤–</span> OTOMATÄ°K CPR Ã–ZETÄ°
        </div>
        
        <label for="autoCPR">BirleÅŸtirilmiÅŸ CPR Metni</label>
        <div class="textarea-wrapper">
          <textarea id="autoCPR" placeholder="Claim â†’ Ã–zellik â†’ Avantaj â†’ Fayda â†’ Recommendation birleÅŸmiÅŸ CPR metni burada otomatik oluÅŸur." readonly style="min-height: 120px; background-color: #f8fafc;"></textarea>
          <button class="voice-btn" data-target="autoCPR" title="Sesli dÃ¼zenle">ğŸ¤</button>
        </div>
        
        <div class="fieldTools">
          <button class="btn primary small" id="generateAutoCPRBtn">âœ… CPR Onay</button>
          <button class="btn ghost small" id="copyCPR">ğŸ“‹ CPR Kopyala</button>
        </div>
        
        <div class="hint-box show">
          <strong>ğŸ¤– Otomatik CPR Ã–zeti:</strong> TÃ¼m alanlarÄ± doldurdukÃ§a, sistem "[Problem + Etki]... Bu nedenle [Ã–zellik + Avantaj]. BÃ¶ylece [Fayda]. Bu yÃ¼zden [Recommendation]" ÅŸeklinde tek bir CPR cÃ¼mlesi oluÅŸturur.
        </div>
      </div>
      
      <!-- 4. STÄ°L BAZLI CPR'LAR KARTI (AKORDEON - KAPALI) -->
      <details class="acc" data-acc="styles" id="acc_styles">
        <summary>
          <div class="accTitle">
            <b><span class="arrow">â–¶</span> 2) Stil BazlÄ± CPR'lar</b>
            <span>Temel CPR'Ä± koruyarak hedef doktorun Ã¶ÄŸrenme stiline uyarlayÄ±n.</span>
          </div>
          <div class="accMeta">
            <span class="tag" id="mini_styles">4/4 stil kapalÄ±</span>
          </div>
        </summary>
        
        <div class="accBody">
          <div class="styleGrid" id="styleGrid">
            <!-- Aktivist -->
            <div class="styleCard" data-style="activist" id="activistCard">
              <div class="styleHeader">
                <div>
                  <div class="styleTitle">Aktivist (DeÄŸiÅŸimci)</div>
                  <div class="styleBadge">
                    <span class="icon">ğŸ”¥</span>
                    <span>Yeni, deneyimsel, hÄ±zlÄ±</span>
                  </div>
                </div>
                <button class="btn small ghost" data-copy-base-to-style="activist">Temel CPR'Ä± Kopyala</button>
              </div>
              <div class="styleBody">
                Aktivist iÃ§in vurgu: <b>yeni deneyim, hÄ±zlÄ± sonuÃ§, hareket</b>.
                <ul>
                  <li>â€¢ Ä°lk cÃ¼mle: Probleme hÄ±zlÄ± giriÅŸ</li>
                  <li>â€¢ Ä°kinci cÃ¼mle: Etkiyi dramatize et</li>
                  <li>â€¢ Son cÃ¼mle: "Hemen" vurgulu Recommendation</li>
                </ul>
              </div>
              <div class="textarea-wrapper">
                <textarea class="styled-cpr-area" data-style="activist" id="activist_cpr" placeholder="Stile aktar butonuna basÄ±n veya buraya yazÄ±n... Aktivist CPR iÃ§in: hÄ±zlÄ±, dinamik, aksiyon odaklÄ± ifadeler kullanÄ±n." disabled></textarea>
                <button class="voice-btn" data-target="activist_cpr" title="Sesli dÃ¼zenle" disabled>ğŸ¤</button>
              </div>
              <div class="feedback styleFeedback">
                <b>Geri bildirim:</b> Temel CPR â‰¥ 13 olduÄŸunda bu stil iÃ§in koÃ§luk mesajlarÄ± aktifleÅŸecek.
              </div>
            </div>
            
            <!-- ReflektÃ¶r -->
            <div class="styleCard" data-style="reflector" id="reflectorCard">
              <div class="styleHeader">
                <div>
                  <div class="styleTitle">ReflektÃ¶r (Dikkatli GÃ¶zlemci)</div>
                  <div class="styleBadge reflector">
                    <span class="icon">ğŸ‘ï¸</span>
                    <span>Ã–nce gÃ¶zlem, sonra karar</span>
                  </div>
                </div>
                <button class="btn small ghost" data-copy-base-to-style="reflector">Temel CPR'Ä± Kopyala</button>
              </div>
              <div class="styleBody">
                ReflektÃ¶r iÃ§in vurgu: <b>veri, gÃ¶zlem, sakin analiz</b>.
                <ul>
                  <li>â€¢ Ä°lk cÃ¼mle: Problemi tablo gibi betimle</li>
                  <li>â€¢ Ä°kinci cÃ¼mle: Etkiyi gÃ¶zleme dayalÄ± anlat</li>
                  <li>â€¢ Son cÃ¼mle: "DÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼nÃ¼zde..." ile Recommendation</li>
                </ul>
              </div>
              <div class="textarea-wrapper">
                <textarea class="styled-cpr-area" data-style="reflector" id="reflector_cpr"
                  placeholder="Stile aktar butonuna basÄ±n veya buraya yazÄ±n... ReflektÃ¶r CPR iÃ§in: sakin, gÃ¶zleme dayalÄ±, veri referanslÄ± ifadeler kullanÄ±n." 
                  disabled></textarea>
                <button class="voice-btn" data-target="reflector_cpr" title="Sesli dÃ¼zenle" disabled>ğŸ¤</button>
              </div>
              <div class="feedback styleFeedback">
                <b>Geri bildirim:</b> Temel CPR â‰¥ 13 olduÄŸunda bu stil iÃ§in koÃ§luk mesajlarÄ± aktifleÅŸecek.
              </div>
            </div>
            
            <!-- Teorist -->
            <div class="styleCard" data-style="theorist" id="theoristCard">
              <div class="styleHeader">
                <div>
                  <div class="styleTitle">Teorist (Sistematik DÃ¼ÅŸÃ¼nen)</div>
                  <div class="styleBadge theorist">
                    <span class="icon">ğŸ“</span>
                    <span>KÄ±lavuz, mekanizma, sebep-sonuÃ§</span>
                  </div>
                </div>
                <button class="btn small ghost" data-copy-base-to-style="theorist">Temel CPR'Ä± Kopyala</button>
              </div>
              <div class="styleBody">
                Teorist iÃ§in vurgu: <b>kÄ±lavuz, mekanizma, rasyonel gerekÃ§e</b>.
                <ul>
                  <li>â€¢ Ä°lk cÃ¼mle: Problemi tanÄ±-tedavi iliÅŸkisiyle aÃ§</li>
                  <li>â€¢ Ä°kinci cÃ¼mle: Etkiyi patofizyoloji ile iliÅŸkilendir</li>
                  <li>â€¢ Son cÃ¼mle: KÄ±lavuz uyumu vurgulu Recommendation</li>
                </ul>
              </div>
              <div class="textarea-wrapper">
                <textarea class="styled-cpr-area" data-style="theorist" id="theorist_cpr"
                  placeholder="Stile aktar butonuna basÄ±n veya buraya yazÄ±n... Teorist CPR iÃ§in: sistematik, kÄ±lavuz referanslÄ± ve mekanizma temelli ifadeler kullanÄ±n." 
                  disabled></textarea>
                <button class="voice-btn" data-target="theorist_cpr" title="Sesli dÃ¼zenle" disabled>ğŸ¤</button>
              </div>
              <div class="feedback styleFeedback">
                <b>Geri bildirim:</b> Temel CPR â‰¥ 13 olduÄŸunda bu stil iÃ§in koÃ§luk mesajlarÄ± aktifleÅŸecek.
              </div>
            </div>
            
            <!-- Pragmatist -->
            <div class="styleCard" data-style="pragmatist" id="pragmatistCard">
              <div class="styleHeader">
                <div>
                  <div class="styleTitle">Pragmatist (UygulamacÄ±)</div>
                  <div class="styleBadge pragmatist">
                    <span class="icon">ğŸ› ï¸</span>
                    <span>Pratik, uygulanabilir, "iÅŸe yarar mÄ±?"</span>
                  </div>
                </div>
                <button class="btn small ghost" data-copy-base-to-style="pragmatist">Temel CPR'Ä± Kopyala</button>
              </div>
              <div class="styleBody">
                Pragmatist iÃ§in vurgu: <b>pratiklik, iÅŸ akÄ±ÅŸÄ±, kolaylÄ±k</b>.
                <ul>
                  <li>â€¢ Ä°lk cÃ¼mle: Problemi gÃ¼nlÃ¼k pratikten Ã¶rnekle</li>
                  <li>â€¢ Ä°kinci cÃ¼mle: Etkiyi iÅŸ yÃ¼kÃ¼ ve sÃ¼reklilikle baÄŸla</li>
                  <li>â€¢ Son cÃ¼mle: Rutin pratiÄŸe nasÄ±l oturduÄŸunu anlatan Recommendation</li>
                </ul>
              </div>
              
              <div class="textarea-wrapper">
                <textarea class="styled-cpr-area" data-style="pragmatist" id="pragmatist_cpr"
                  placeholder="Stile aktar butonuna basÄ±n veya buraya yazÄ±n... Pragmatist CPR iÃ§in: Pratik, uygulanabilir, 'nasÄ±l yapÄ±lÄ±r' odaklÄ± ifadeler kullanÄ±n." 
                  disabled></textarea>
                <button class="voice-btn" data-target="pragmatist_cpr" title="Sesli dÃ¼zenle" disabled>ğŸ¤</button>
              </div>
              
              <div class="feedback styleFeedback">
                <b>Geri bildirim:</b> Temel CPR â‰¥ 13 olduÄŸunda bu stil iÃ§in koÃ§luk mesajlarÄ± aktifleÅŸecek.
              </div>
            </div>
          </div>
        </div>
      </details>
    </main>
  </div>
  
  <!-- ğŸ“± FAZ 2: MOBÄ°L BÄ°LDÄ°RÄ°M ALANI -->
  <div id="mobileNotificationArea"></div>
  
  <!-- JAVASCRIPT KODU -->
  <script>
  /* ============================================
     TAM ZAMAN BOMBASI SÄ°STEMÄ° - TUTARLI KORUMA
     ============================================ */
  
  // ============================================
  // ğŸ•µï¸ GÄ°ZLÄ° ZAMAN DOÄRULAMA SÄ°STEMÄ°
  // ============================================
  
  const TimeBombSecurity = {
    // ğŸ”’ GÄ°ZLÄ° YIL HESAPLAMA NOKTALARI
    hiddenYearPoints: {
      p1: Math.sqrt(4096576),               // âˆš4096576 = 2024
      p2: parseInt('11111101000', 2),       // Binary 11111101000 = 2024
      p3: 0x7E8,                            // Hex 0x7E8 = 2024
      p4: 'FAST'.charCodeAt(0) * 28.857,    // 70 * 28.857 â‰ˆ 2024
      p5: (() => {
        const a = Math.pow(2, 10);          // 1024
        const b = a * 2 - 24;               // 2024
        return b;
      })(),
      p6: (() => {
        const now = new Date('2024-01-01').getTime();
        return Math.floor(now / 86400000) - 18628 + 2024; // HesaplamalÄ±
      })()
    },
    
    detectionCount: 0,
    maxDetections: 2,
    lastCheckTime: null,
    checkInterval: null,
    
    // ğŸš€ SÄ°STEMÄ° BAÅLAT
    init() {
      console.log('ğŸ’£ ZAMAN BOMBASI SÄ°STEMÄ° AKTÄ°F');
      
      // 1. Ä°LK KONTROL (3 saniye sonra)
      setTimeout(() => this.fullSecurityCheck(), 3000);
      
      // 2. PERÄ°YODÄ°K KONTROL (her 2 dakikada bir)
      this.checkInterval = setInterval(() => this.fullSecurityCheck(), 300000); // 5 dakika yapÄ±ldÄ±
      
      // 3. ZAMAN AKIÅI KONTROLÃœ (her 30 saniyede)
      setInterval(() => this.checkTimeFlow(), 30000);
      
      // 4. RASTGELE KONTROLLER
      this.setupRandomChecks();
    },
    
    // ğŸ” TAM GÃœVENLÄ°K KONTROLÃœ
    fullSecurityCheck() {
      console.log('ğŸ” Tam gÃ¼venlik kontrolÃ¼ baÅŸlatÄ±ldÄ±');
      
      const checks = {
        // 1. LÄ°SANS METNÄ° KONTROLÃœ
        license: this.checkLicenseIntegrity(),
        
        // 2. GÃ–MÃœLÃœ YIL KONTROLÃœ
        embeddedYear: this.checkEmbeddedYear(),
        
        // 3. SÄ°STEM TARÄ°HÄ° KONTROLÃœ
        systemDate: this.checkSystemDate(),
        
        // 4. ZAMAN UYUMLULUÄU
        timeConsistency: this.checkTimeConsistency(),
        
        // 5. KOD BÃœTÃœNLÃœÄÃœ
        codeIntegrity: this.checkCodeIntegrity()
      };
      
      // TÃœM KONTROLLERÄ° DEÄERLENDÄ°R
      const allPassed = Object.values(checks).every(check => check.passed);
      
      if (!allPassed) {
        this.detectionCount++;
        console.error(`ğŸš¨ GÃ¼venlik ihlali #${this.detectionCount}:`, checks);
        
        // Ä°HLAL LOGLAMA
        this.logViolation(checks);
        
        // 2. Ä°HLALDE ZAMAN BOMBASI AKTÄ°VE
        if (this.detectionCount >= this.maxDetections) {
          this.activateTimeBomb(checks);
        } else {
          // Ä°lk ihlalde uyarÄ± gÃ¶ster
          this.showWarning(checks);
        }
      } else {
        // GeÃ§erli - sayacÄ± sÄ±fÄ±rla
        if (this.detectionCount > 0) {
          console.log('âœ… GÃ¼venlik ihlali dÃ¼zeltildi, sayaÃ§ sÄ±fÄ±rlandÄ±');
          this.detectionCount = 0;
        }
      }
      
      return { passed: allPassed, checks };
    },
    
    // ğŸ“„ LÄ°SANS METNÄ° KONTROLÃœ
    checkLicenseIntegrity() {
      const element = document.getElementById('__verify__');
      if (!element) {
        return { passed: false, error: 'LICENSE_ELEMENT_MISSING', code: '0xTB001' };
      }
      
      const licenseText = element.textContent.trim();
      const expected = 'FAST_CPR_v3_2024_LIC_9B7A2C';
      
      // TAM METÄ°N KONTROLÃœ
      const exactMatch = licenseText === expected;
      
      // HASH KONTROLÃœ (son 6 karakter)
      const expectedHash = '9B7A2C';
      const actualHash = licenseText.split('_').pop();
      const hashMatch = actualHash === expectedHash;
      
      // YIL KONTROLÃœ
      const yearMatch = licenseText.includes('_2024_');
      
      return {
        passed: exactMatch && hashMatch && yearMatch,
        exactMatch,
        hashMatch,
        yearMatch,
        licenseText,
        expected
      };
    },
    
    // ğŸ”¢ GÃ–MÃœLÃœ YIL KONTROLÃœ
    checkEmbeddedYear() {
      const embeddedYear = Math.floor(this.hiddenYearPoints.p1);
      const systemYear = new Date().getFullYear();
      
      // GÄ°ZLÄ° HESAPLAMA: TÃ¼m noktalarÄ±n ortalamasÄ±
      const calculatedYear = Math.floor(
        Object.values(this.hiddenYearPoints).reduce((a, b) => a + b, 0) / 
        Object.keys(this.hiddenYearPoints).length
      );
      
      const yearValid = embeddedYear === 2024 && calculatedYear === 2024;
      const yearMatch = embeddedYear === systemYear;
      
      return {
        passed: yearValid && yearMatch,
        embeddedYear,
        systemYear,
        calculatedYear,
        yearValid,
        yearMatch
      };
    },
    
    // ğŸ“… SÄ°STEM TARÄ°HÄ° KONTROLÃœ
    checkSystemDate() {
      const now = new Date();
      const systemYear = now.getFullYear();
      const systemMonth = now.getMonth();
      const systemTime = now.getTime();
      
      // MAKUL TARÄ°H ARALIÄI (2023-2026)
      const yearReasonable = systemYear >= 2023 && systemYear <= 2026;
      
      // GEÃ‡ERLÄ° AY (0-11)
      const monthValid = systemMonth >= 0 && systemMonth <= 11;
      
      // TARÄ°H GERÄ° ALINMIÅ MI? (1970'ten Ã¶nce olamaz)
      const notAncient = systemTime > 0;
      
      // Ã‡OK Ä°LERÄ° TARÄ°H (2030'dan sonra ÅŸÃ¼pheli)
      const notFuture = systemYear <= 2030;
      
      return {
        passed: yearReasonable && monthValid && notAncient && notFuture,
        yearReasonable,
        monthValid,
        notAncient,
        notFuture,
        systemYear,
        systemMonth,
        systemTime
      };
    },
    
    // â° ZAMAN UYUMLULUÄU KONTROLÃœ
    checkTimeConsistency() {
      const licenseYear = 2024; // Lisanstaki sabit yÄ±l
      const systemYear = new Date().getFullYear();
      const embeddedYear = Math.floor(this.hiddenYearPoints.p1);
      
      // ÃœÃ‡LÃœ YIL UYUMLULUÄU
      const tripleMatch = licenseYear === systemYear && 
                         licenseYear === embeddedYear && 
                         systemYear === embeddedYear;
      
      // YIL FARKI MAKUL MÃœ? (Â±1 yÄ±l tolerans)
      const yearDiff = Math.abs(systemYear - licenseYear);
      const withinTolerance = yearDiff <= 1;
      
      return {
        passed: tripleMatch && withinTolerance,
        tripleMatch,
        withinTolerance,
        licenseYear,
        systemYear,
        embeddedYear,
        yearDiff
      };
    },
    
    // ğŸ”§ KOD BÃœTÃœNLÃœÄÃœ KONTROLÃœ
    checkCodeIntegrity() {
      // KRÄ°TÄ°K FONKSÄ°YONLARIN VARLIÄINI KONTROL ET
      const criticalFunctions = [
        'TimeBombSecurity',
        'TimeBombSecurity.init',
        'TimeBombSecurity.activateTimeBomb',
        'AutoCPRGenerator',
        'CPRFlowControl'
      ];
      
      const functionsExist = criticalFunctions.every(func => {
        try {
          return eval(`typeof ${func} !== 'undefined'`);
        } catch {
          return false;
        }
      });
      
      // LÄ°SANS ELEMENTÄ° DEÄÄ°ÅTÄ°RÄ°LMÄ°Å MÄ°?
      const licenseElement = document.getElementById('__verify__');
      const elementUntouched = licenseElement && 
                               licenseElement.style.display === 'none' &&
                               licenseElement.tagName === 'SPAN';
      
      return {
        passed: functionsExist && elementUntouched,
        functionsExist,
        elementUntouched,
        missingFunctions: criticalFunctions.filter(func => !eval(`typeof ${func} !== 'undefined'`))
      };
    },
    
    // âª ZAMAN AKIÅI KONTROLÃœ (saat geri alÄ±nÄ±rsa)
    checkTimeFlow() {
      if (!this.lastCheckTime) {
        this.lastCheckTime = Date.now();
        return { passed: true, flow: 'initialized' };
      }
      
      const currentTime = Date.now();
      const timeDiff = currentTime - this.lastCheckTime;
      
      // ZAMAN GERÄ°YE GÄ°TMÄ°Å OLMAMALI (500ms tolerans)
      const timeNotReversed = timeDiff >= -500;
      
      // ZAMAN Ã‡OK HIZLI Ä°LERLEMEMELÄ° (5 dakikadan fazla atlama)
      const timeNotJumped = timeDiff <= 300000;
      
      this.lastCheckTime = currentTime;
      
      return {
        passed: timeNotReversed && timeNotJumped,
        timeNotReversed,
        timeNotJumped,
        timeDiff,
        lastCheck: this.lastCheckTime,
        currentCheck: currentTime
      };
    },
    
    // ğŸ² RASTGELE KONTROLLER KUR
    setupRandomChecks() {
      // RASTGELE ZAMANLARDA EK KONTROLLER
      const randomTimes = [15000, 60000, 150000, 240000, 360000]; // ArtÄ±rÄ±ldÄ±
      
      randomTimes.forEach(delay => {
        const jitter = Math.random() * 15000; // Â±15 saniye rastgelelik
        setTimeout(() => {
          const check = this.checkLicenseIntegrity();
          if (!check.passed) {
            console.warn(`ğŸ² Rastgele kontrol baÅŸarÄ±sÄ±z (${delay}ms):`, check);
            this.detectionCount++;
          }
        }, delay + jitter);
      });
    },
    
    // ğŸ“ Ä°HLAL LOGLAMA
    logViolation(checks) {
      const violationLog = {
        timestamp: new Date().toISOString(),
        detectionCount: this.detectionCount,
        checks,
        userAgent: navigator.userAgent,
        location: window.location.href,
        domain: window.location.hostname
      };
      
      // LOCALSTORAGE'A KAYDET (ÅŸifreli)
      try {
        const logs = JSON.parse(localStorage.getItem('fastcpr_violations') || '[]');
        logs.push(violationLog);
        
        // En fazla 10 log tut
        if (logs.length > 10) logs.shift();
        
        localStorage.setItem('fastcpr_violations', JSON.stringify(logs));
      } catch (e) {
        console.error('Ä°hlal loglama hatasÄ±:', e);
      }
      
      // KONSOLA DETAYLI LOG
      console.error('ğŸš¨ GÃœVENLÄ°K Ä°HLALÄ° LOGU:', violationLog);
    },
    
    // âš ï¸ UYARI GÃ–STER (ilk ihlalde)
    showWarning(checks) {
      // SADECE KONSOL UYARISI - KULLANICI GÃ–RMEZ
      console.warn('âš ï¸ GÃœVENLÄ°K UYARISI: Lisans doÄŸrulama hatasÄ± tespit edildi');
      console.warn('Bir sonraki ihlalde sistem kilitlenecektir.');
      console.warn('Detaylar:', checks);
    },
    
    // ğŸ’£ ZAMAN BOMBASI AKTÄ°VE
    activateTimeBomb(checks) {
      console.error('ğŸ’£ğŸ’£ğŸ’£ ZAMAN BOMBASI AKTÄ°VE EDÄ°LDÄ° ğŸ’£ğŸ’£ğŸ’£');
      
      // 1. TÃœM SÄ°STEMLERÄ° DURDUR
      this.shutdownAllSystems();
      
      // 2. EKRAN KÄ°LÄ°DÄ°
      this.lockScreen(checks);
      
      // 3. VERÄ° KORUMA
      this.protectUserData();
      
      // 4. ORÄ°JÄ°NAL SÄ°TEYE YÃ–NLENDÄ°R (10 saniye sonra)
      setTimeout(() => {
        this.redirectToOriginal();
      }, 10000);
      
      // KONTROL DÃ–NGÃœSÃœNÃœ DURDUR
      if (this.checkInterval) {
        clearInterval(this.checkInterval);
      }
    },
    
    // ğŸ›‘ TÃœM SÄ°STEMLERÄ° DURDUR
    shutdownAllSystems() {
      console.log('ğŸ›‘ TÃ¼m sistemler durduruluyor...');
      
      // PDF Ã–ZELLÄ°ÄÄ°NÄ° ENGELLE
      const pdfBtn = document.getElementById('fullReportPDF');
      if (pdfBtn) {
        pdfBtn.style.display = 'none';
      }
      
      // SESLÄ° GÄ°RÄ°ÅÄ° ENGELLE
      document.querySelectorAll('.voice-btn').forEach(btn => {
        btn.style.display = 'none';
        btn.disabled = true;
      });
      
      // DRAFT KAYDINI DURDUR
      if (window.MobileFeatures?.DraftSystem?.autoSaveInterval) {
        clearInterval(window.MobileFeatures.DraftSystem.autoSaveInterval);
      }
      
      // LOCALSTORAGE'Ä± KÄ°LÄ°TLE
      const originalSetItem = localStorage.setItem;
      localStorage.setItem = function(key, value) {
        console.warn(`ğŸ“› LocalStorage engellendi (${key})`);
        return false;
      };
      
      // TÃœM TEXTAREA'LARI READONLY YAP
      document.querySelectorAll('textarea').forEach(textarea => {
        textarea.readOnly = true;
        textarea.style.backgroundColor = '#f5f5f5';
        textarea.style.cursor = 'not-allowed';
      });
      
      // TÃœM BUTONLARI DISABLE YAP
      document.querySelectorAll('button').forEach(button => {
        if (!button.id.includes('timeBomb')) { // Kilit ekranÄ± butonlarÄ±nÄ± hariÃ§ tut
          button.disabled = true;
          button.style.opacity = '0.5';
          button.style.cursor = 'not-allowed';
        }
      });
    },
    
    // ğŸ”’ EKRAN KÄ°LÄ°DÄ°
    lockScreen(checks) {
      const overlay = document.createElement('div');
      overlay.className = 'time-bomb-overlay';
      
      let countdown = 10;
      
      overlay.innerHTML = `
        <div style="font-size: 64px; margin-bottom: 20px;">ğŸ’£â°</div>
        <h1 class="time-bomb-alert">ZAMAN BOMBASI AKTÄ°VE</h1>
        <p style="margin-bottom: 20px; max-width: 500px;">
          Bu kopya orijinal deÄŸildir. Sistem tarihi manipÃ¼le edilmiÅŸ veya lisans ihlali tespit edilmiÅŸtir.
        </p>
        
        <div class="time-bomb-details">
          <div><strong>Ä°hlal DetaylarÄ±:</strong></div>
          <div>â€¢ Tespit SayÄ±sÄ±: <span class="time-bomb-code">${this.detectionCount}</span></div>
          <div>â€¢ Sistem YÄ±lÄ±: <span class="time-bomb-code">${new Date().getFullYear()}</span></div>
          <div>â€¢ Beklenen YÄ±l: <span class="time-bomb-code">2024</span></div>
          <div>â€¢ Ä°hlal Kodu: <span class="time-bomb-code">TB${Date.now().toString(36).slice(-6).toUpperCase()}</span></div>
        </div>
        
        <p style="margin: 20px 0; font-size: 14px; opacity: 0.8;">
          Orijinal sÃ¼rÃ¼me yÃ¶nlendiriliyorsunuz...
        </p>
        
        <div class="time-bomb-countdown" id="timeBombCountdown">${countdown}</div>
        
        <div style="margin-top: 20px;">
          <a href="https://cpr-koÃ§u.com" style="
            background: #3b82f6;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            display: inline-block;
            margin: 10px;
          ">
            â†ªï¸ ORÄ°JÄ°NAL SÄ°TEYE GÄ°T
          </a>
          <button onclick="window.location.reload()" style="
            background: #636e72;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
          ">
            ğŸ”„ SAYFAYI YENÄ°LE
          </button>
        </div>
        
        <p style="margin-top: 30px; font-size: 11px; opacity: 0.6;">
          Â© 2024 FAST CPR KoÃ§u - TÃ¼m haklarÄ± saklÄ±dÄ±r.<br>
          Ä°zinsiz kopyalanamaz, daÄŸÄ±tÄ±lamaz, deÄŸiÅŸtirilemez.
        </p>
      `;
      
      document.body.appendChild(overlay);
      
      // GERÄ° SAYIM
      const countdownElement = document.getElementById('timeBombCountdown');
      const countdownInterval = setInterval(() => {
        countdown--;
        countdownElement.textContent = countdown;
        
        if (countdown <= 0) {
          clearInterval(countdownInterval);
        }
      }, 1000);
      
      // ARKA PLANA KIRMIZI YANIP SÃ–NME EFEKTÄ°
      let flash = true;
      setInterval(() => {
        overlay.style.backgroundColor = flash 
          ? 'linear-gradient(135deg, #1a1a2e, #b91c1c)' 
          : 'linear-gradient(135deg, #b91c1c, #1a1a2e)';
        flash = !flash;
      }, 1000);
    },
    
    // ğŸ’¾ KULLANICI VERÄ°SÄ°NÄ° KORU
    protectUserData() {
      try {
        // DRAFT'LARI YEDEKLE
        const drafts = JSON.parse(localStorage.getItem('fastcpr_drafts_v2') || '[]');
        if (drafts.length > 0) {
          const backup = {
            timestamp: new Date().toISOString(),
            count: drafts.length,
            data: drafts,
            protected: true,
            code: 'TB_BACKUP_' + Date.now().toString(36)
          };
          
          localStorage.setItem('fastcpr_drafts_protected', JSON.stringify(backup));
          console.log(`ğŸ“¦ ${drafts.length} draft yedeklendi`);
        }
        
        // ORÄ°JÄ°NAL DRAFT'LARI ÅÄ°FRELE (basit)
        localStorage.setItem('fastcpr_drafts_v2', JSON.stringify([
          {
            timestamp: new Date().toISOString(),
            message: 'âš ï¸ Bu draft\'lar lisans ihlali nedeniyle koruma altÄ±na alÄ±ndÄ±.',
            code: 'TIME_BOMB_ACTIVATED',
            originalCount: drafts.length
          }
        ]));
        
      } catch (e) {
        console.error('Veri koruma hatasÄ±:', e);
      }
    },
    
    // â†ªï¸ ORÄ°JÄ°NAL SÄ°TEYE YÃ–NLENDÄ°R
    redirectToOriginal() {
      const redirectUrl = new URL('https://cpr-koÃ§u.com');
      redirectUrl.searchParams.append('reason', 'time_bomb');
      redirectUrl.searchParams.append('year', new Date().getFullYear());
      redirectUrl.searchParams.append('code', 'TB' + Date.now().toString(36).slice(-6).toUpperCase());
      redirectUrl.searchParams.append('violations', this.detectionCount);
      
      window.location.href = redirectUrl.toString();
    }
  };
  
  // ============================================
  // ğŸ“± OTOMATÄ°K CPR Ã–ZETÄ° ÃœRETÄ°MÄ° (GÄ°ZLÄ° KONTROLLÃœ)
  // ============================================
  
  const AutoCPRGenerator = {
    generate: function() {
      // ğŸ”’ GÄ°ZLÄ° ZAMAN KONTROLÃœ 1 (bu fonksiyon iÃ§inde)
      const hiddenTimeCheck1 = () => {
        const d = new Date();
        const sysYear = d.getFullYear();
        const embeddedYear = Math.sqrt(4096576); // 2024
        
        if (Math.abs(sysYear - embeddedYear) > 1) {
          console.warn('ğŸš¨ [AutoCPR-Gizli] YÄ±l uyumsuzluÄŸu:', sysYear, '!=', embeddedYear);
          // Sessizce kaliteyi dÃ¼ÅŸÃ¼r
          return false;
        }
        return true;
      };
      
      if (!hiddenTimeCheck1()) {
        // Kalite puanÄ±nÄ± gizlice dÃ¼ÅŸÃ¼r
        this.qualityScore = 0.5;
      }
      
      const problem = document.getElementById('base_claim_problem')?.value.trim() || '';
      const effect = document.getElementById('base_claim_effect')?.value.trim() || '';
      const feature = document.getElementById('base_feat')?.value.trim() || '';
      const advantage = document.getElementById('base_adv')?.value.trim() || '';
      const benefit = document.getElementById('base_ben')?.value.trim() || '';
      const recommendation = document.getElementById('base_rec')?.value.trim() || '';
      
      if (!problem && !effect && !feature && !advantage && !benefit && !recommendation) {
        return '';
      }
      
      let autoCPR = '';
      
      if (problem && effect) {
        autoCPR += `"${problem} Bu durum ${effect.toLowerCase()}... `;
      } else if (problem) {
        autoCPR += `"${problem}... `;
      } else if (effect) {
        autoCPR += `"${effect}... `;
      }
      
      if (feature && advantage) {
        autoCPR += `Bu nedenle ${feature}, ${advantage.toLowerCase()}. `;
      } else if (feature) {
        autoCPR += `Bu nedenle ${feature}. `;
      } else if (advantage) {
        autoCPR += `Bu nedenle ${advantage}. `;
      }
      
      if (benefit) {
        autoCPR += `BÃ¶ylece ${benefit}. `;
      }
      
      if (recommendation) {
        const hasQuestionMark = recommendation.trim().endsWith('?');
        autoCPR += `Bu yÃ¼zden ${recommendation}${!hasQuestionMark ? '?' : ''}"`;
      } else {
        autoCPR = autoCPR.trim();
        if (!autoCPR.endsWith('"')) {
          autoCPR += '"';
        }
      }
      
      return autoCPR;
    },
    
    validateAllFields: function() {
      const fields = [
        { id: 'base_claim_problem', name: 'Problem' },
        { id: 'base_claim_effect', name: 'Etki' },
        { id: 'base_feat', name: 'Ã–zellik' },
        { id: 'base_adv', name: 'Avantaj' },
        { id: 'base_ben', name: 'Fayda' },
        { id: 'base_rec', name: 'Recommendation' }
      ];
      
      const emptyFields = [];
      
      fields.forEach(field => {
        const value = document.getElementById(field.id)?.value.trim() || '';
        if (!value || value.length < 3) {
          emptyFields.push(field.name);
        }
      });
      
      return emptyFields;
    },
    
    confirmCPR: function() {
      const emptyFields = this.validateAllFields();
      
      if (emptyFields.length > 0) {
        showMobileNotification(`Eksik alanlar: ${emptyFields.join(', ')}. LÃ¼tfen tÃ¼m alanlarÄ± doldurun.`, 'error');
        return false;
      }
      
      this.updateAutoCPR();
      
      if (typeof CPRFlowControl !== 'undefined') {
        CPRFlowControl.updateCPRScore();
      }
      
      showMobileNotification('âœ… CPR onaylandÄ±! Puan hesaplandÄ± ve stil alanlarÄ± kontrol ediliyor.', 'success');
      return true;
    },
    
    updateAutoCPR: function() {
      const autoCPR = this.generate();
      const autoCPRTextarea = document.getElementById('autoCPR');
      
      if (autoCPRTextarea) {
        autoCPRTextarea.value = autoCPR;
        
        const copyBtn = document.getElementById('copyCPR');
        if (copyBtn) {
          const cprScore = CPRFlowControl?.currentCPRScore || 0;
          if (cprScore >= 13 && autoCPR.length > 20) {
            copyBtn.disabled = false;
            copyBtn.style.opacity = '1';
            copyBtn.title = 'CPR\'Ä± panoya kopyala';
          } else {
            copyBtn.disabled = true;
            copyBtn.style.opacity = '0.5';
            copyBtn.title = 'CPR puanÄ± â‰¥ 13 olmalÄ±';
          }
        }
      }
    },
    
    copyToClipboard: function() {
      const autoCPR = document.getElementById('autoCPR')?.value;
      const cprScore = CPRFlowControl?.currentCPRScore || 0;
      
      if (!autoCPR || autoCPR.trim().length < 10) {
        showMobileNotification('Kopyalanacak CPR metni yok', 'warning');
        return;
      }
      
      if (cprScore < 13) {
        showMobileNotification('CPR kopyalamak iÃ§in puan â‰¥ 13 olmalÄ±', 'warning');
        return;
      }
      
      navigator.clipboard.writeText(autoCPR).then(() => {
        showMobileNotification('CPR panoya kopyalandÄ±', 'success');
      }).catch(err => {
        console.error('Kopyalama hatasÄ±:', err);
        showMobileNotification('Kopyalama baÅŸarÄ±sÄ±z', 'error');
      });
    },
    
    init: function() {
      const textareas = [
        'base_claim_problem', 'base_claim_effect', 
        'base_feat', 'base_adv', 'base_ben', 'base_rec'
      ];
      
      textareas.forEach(id => {
        const textarea = document.getElementById(id);
        if (textarea) {
          textarea.addEventListener('input', () => {
            this.updateAutoCPR();
          });
        }
      });
      
      const generateBtn = document.getElementById('generateAutoCPRBtn');
      if (generateBtn) {
        generateBtn.addEventListener('click', () => {
          this.confirmCPR();
        });
      }
      
      const copyBtn = document.getElementById('copyCPR');
      if (copyBtn) {
        copyBtn.addEventListener('click', () => {
          this.copyToClipboard();
        });
        
        copyBtn.disabled = true;
        copyBtn.style.opacity = '0.5';
        copyBtn.title = 'CPR puanÄ± â‰¥ 13 olmalÄ±';
      }
      
      setTimeout(() => {
        this.updateAutoCPR();
      }, 500);
      
      console.log('âœ… Otomatik CPR Ãœretimi sistemi hazÄ±r');
    }
  };
  
  // ============================================
  // ğŸ“„ TÃœM RAPOR PDF SÄ°STEMÄ° (GÄ°ZLÄ° KONTROLLÃœ)
  // ============================================
  
  const ComprehensivePDFReport = {
    generateFullReport: function() {
      // ğŸ”’ GÄ°ZLÄ° ZAMAN KONTROLÃœ 2 (PDF oluÅŸturmada)
      const hiddenTimeCheck2 = () => {
        const embeddedYear = parseInt('11111101000', 2); // 2024
        const systemYear = new Date().getFullYear();
        
        if (Math.abs(systemYear - embeddedYear) > 1) {
          console.error('ğŸš¨ [PDF-Gizli] YÄ±l uyumsuzluÄŸu - PDF engellendi');
          return false;
        }
        return true;
      };
      
      if (!hiddenTimeCheck2()) {
        showMobileNotification('PDF oluÅŸturma geÃ§ici olarak kullanÄ±lamÄ±yor.', 'error');
        return;
      }
      
      try {
        const fullReportBtn = document.getElementById('fullReportPDF');
        const originalText = fullReportBtn.innerHTML;
        const originalBackground = fullReportBtn.style.background;
        
        fullReportBtn.innerHTML = 'ğŸ“„ OluÅŸturuluyor...';
        fullReportBtn.style.background = '#9ca3af';
        fullReportBtn.style.cursor = 'wait';
        
        setTimeout(() => {
          const reportData = this.collectAllData();
          const docDefinition = this.createFullDocumentDefinition(reportData);
          
          const fileName = `FAST_CPR_Tum_Rapor_${new Date().toISOString().slice(0, 10)}.pdf`;
          pdfMake.createPdf(docDefinition).download(fileName);
          
          showMobileNotification('TÃ¼m rapor PDF olarak indiriliyor...', 'success');
          
          fullReportBtn.innerHTML = originalText;
          fullReportBtn.style.background = originalBackground;
          fullReportBtn.style.cursor = 'pointer';
        }, 500);
        
      } catch (error) {
        console.error('PDF oluÅŸturma hatasÄ±:', error);
        showMobileNotification('PDF oluÅŸturulurken hata oluÅŸtu', 'error');
        
        const fullReportBtn = document.getElementById('fullReportPDF');
        fullReportBtn.innerHTML = 'ğŸ“„ TÃ¼m Raporu PDF\'e Aktar';
        fullReportBtn.style.background = '#3b82f6';
        fullReportBtn.style.cursor = 'pointer';
      }
    },
    
    collectAllData: function() {
      return {
        preparation: {
          promoContext: document.getElementById('promoContext')?.value.trim() || 'â€”',
          learningStyle: document.getElementById('learningStyle')?.value.trim() || 'â€”',
          selectedBehaviors: SocialLearningStyleManager ? SocialLearningStyleManager.getSelectedBehaviors().join(', ') || 'â€”' : 'â€”'
        },
        
        productPrep: {
          productName: document.getElementById('productNameInput')?.value.trim() || 'â€”',
          competitorName: document.getElementById('competitorNameInput')?.value.trim() || 'â€”',
          superiority: document.getElementById('superiorityInput')?.value.trim() || 'â€”',
          promoGoal: document.getElementById('promoGoal')?.value.trim() || 'â€”'
        },
        
        baseCPR: {
          claim_problem: document.getElementById('base_claim_problem')?.value.trim() || 'â€”',
          claim_effect: document.getElementById('base_claim_effect')?.value.trim() || 'â€”',
          feature: document.getElementById('base_feat')?.value.trim() || 'â€”',
          advantage: document.getElementById('base_adv')?.value.trim() || 'â€”',
          benefit: document.getElementById('base_ben')?.value.trim() || 'â€”',
          recommendation: document.getElementById('base_rec')?.value.trim() || 'â€”'
        },
        
        styleCPRs: {
          activist: document.getElementById('activist_cpr')?.value.trim() || 'â€”',
          reflector: document.getElementById('reflector_cpr')?.value.trim() || 'â€”',
          theorist: document.getElementById('theorist_cpr')?.value.trim() || 'â€”',
          pragmatist: document.getElementById('pragmatist_cpr')?.value.trim() || 'â€”'
        },
        
        generatedAt: new Date().toLocaleString('tr-TR'),
        date: new Date().toLocaleDateString('tr-TR'),
        time: new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' })
      };
    },
    
    createFullDocumentDefinition: function(data) {
      return {
        pageSize: 'A4',
        pageMargins: [40, 80, 40, 60],
        
        header: function(currentPage, pageCount) {
          return [
            {
              text: 'FAST CPR KOÃ‡U',
              style: 'mainHeader',
              alignment: 'center',
              margin: [0, 20, 0, 0]
            },
            
            {
              text: data.date + ' ' + data.time,
              style: 'dateHeader',
              alignment: 'right',
              margin: [0, 40, 40, 0]
            }
          ];
        },
        
        content: [
          {
            text: '1. SOSYAL STÄ°L VE Ã–ÄRENME STÄ°LÄ° TANIMLAMA',
            style: 'sectionHeader',
            pageBreak: 'before',
            margin: [0, 30, 0, 10]
          },
          this.createPreparationSection(data.preparation),
          
          {
            text: '2. ÃœRÃœN-RAKÄ°P-ÃœSTÃœNLÃœKLER-HEDEF',
            style: 'sectionHeader',
            margin: [0, 20, 0, 10]
          },
          this.createProductPrepSection(data.productPrep),
          
          {
            text: '3. TEMEL CPR',
            style: 'sectionHeader',
            margin: [0, 20, 0, 10]
          },
          this.createBaseCPRSection(data.baseCPR),
          
          {
            text: '4. Ã–ÄRENME STÄ°LLERÄ°NE GÃ–RE CPR\'LAR',
            style: 'sectionHeader',
            margin: [0, 20, 0, 10]
          },
          this.createStyleCPRSection(data.styleCPRs),
          
          {
            text: 'FAST CPR KoÃ§u tarafÄ±ndan oluÅŸturulmuÅŸtur â€¢ ' + data.generatedAt,
            style: 'footer',
            margin: [0, 30, 0, 0]
          }
        ],
        
        styles: {
          mainHeader: {
            fontSize: 20,
            bold: true,
            color: '#1d4ed8'
          },
          
          dateHeader: {
            fontSize: 10,
            color: '#666',
            italics: true
          },
          
          sectionHeader: {
            fontSize: 14,
            bold: true,
            color: '#1e40af',
            background: '#eff6ff',
            padding: [8, 4],
            border: [1, 'solid', '#dbeafe'],
            marginBottom: 8
          },
          
          subsection: {
            fontSize: 12,
            bold: true,
            color: '#374151',
            margin: [0, 8, 0, 4]
          },
          
          contentText: {
            fontSize: 11,
            lineHeight: 1.4,
            margin: [0, 0, 0, 6]
          },
          
          italicCPR: {
            fontSize: 11,
            italics: true,
            lineHeight: 1.4,
            background: '#f8fafc',
            padding: [8, 10],
            border: [1, 'dashed', '#e5e7eb'],
            margin: [0, 4, 0, 12]
          },
          
          footer: {
            fontSize: 9,
            color: '#6b7280',
            alignment: 'center',
            italics: true
          },
          
          label: {
            fontSize: 11,
            bold: true,
            color: '#4b5563'
          },
          
          value: {
            fontSize: 11,
            color: '#111827',
            margin: [0, 0, 0, 8]
          }
        }
      };
    },
    
    createPreparationSection: function(prep) {
      return [
        {
          text: [{ text: 'Doktor/EczacÄ±nÄ±n Sosyal Stili: ', style: 'label' }, prep.promoContext],
          style: 'contentText'
        },
        {
          text: [{ text: 'SeÃ§ilen DavranÄ±ÅŸlar: ', style: 'label' }, prep.selectedBehaviors],
          style: 'contentText'
        },
        {
          text: [{ text: 'Ã–ÄŸrenme Stili: ', style: 'label' }, prep.learningStyle],
          style: 'contentText',
          margin: [0, 0, 0, 16]
        }
      ];
    },
    
    createProductPrepSection: function(product) {
      return [
        {
          text: [{ text: 'ÃœrÃ¼n: ', style: 'label' }, product.productName],
          style: 'contentText'
        },
        {
          text: [{ text: 'Rakip: ', style: 'label' }, product.competitorName],
          style: 'contentText'
        },
        {
          text: [{ text: 'ÃœstÃ¼n YÃ¶n: ', style: 'label' }, product.superiority],
          style: 'contentText'
        },
        {
          text: [{ text: 'SMART CPR Hedefi: ', style: 'label' }, product.promoGoal],
          style: 'contentText',
          margin: [0, 0, 0, 16]
        }
      ];
    },
    
    createBaseCPRSection: function(cpr) {
      return [
        {
          text: 'CLAIM - Problem:',
          style: 'subsection'
        },
        {
          text: cpr.claim_problem,
          style: 'value'
        },
        {
          text: 'CLAIM - Etki:',
          style: 'subsection'
        },
        {
          text: cpr.claim_effect,
          style: 'value'
        },
        {
          text: 'PROPOSITION - Ã–zellik:',
          style: 'subsection'
        },
        {
          text: cpr.feature,
          style: 'value'
        },
        {
          text: 'PROPOSITION - Avantaj:',
          style: 'subsection'
        },
        {
          text: cpr.advantage,
          style: 'value'
        },
        {
          text: 'PROPOSITION - Fayda:',
          style: 'subsection'
        },
        {
          text: cpr.benefit,
          style: 'value'
        },
        {
          text: 'RECOMMENDATION:',
          style: 'subsection'
        },
        {
          text: cpr.recommendation,
          style: 'value',
          margin: [0, 0, 0, 16]
        }
      ];
    },
    
    createStyleCPRSection: function(styles) {
      return [
        {
          text: 'Aktivist CPR',
          style: 'subsection'
        },
        {
          text: styles.activist,
          style: 'italicCPR'
        },
        
        {
          text: 'ReflektÃ¶r CPR',
          style: 'subsection'
        },
        {
          text: styles.reflector,
          style: 'italicCPR'
        },
        
        {
          text: 'Teorist CPR',
          style: 'subsection'
        },
        {
          text: styles.theorist,
          style: 'italicCPR'
        },
        
        {
          text: 'Pragmatist CPR',
          style: 'subsection'
        },
        {
          text: styles.pragmatist,
          style: 'italicCPR',
          margin: [0, 4, 0, 0]
        }
      ];
    }
  };
  
  // ============================================
  // ğŸ‘¥ SOSYAL STÄ°L VE Ã–ÄRENME STÄ°LÄ° YÃ–NETÄ°CÄ°SÄ°
  // ============================================
  
  const SocialLearningStyleManager = {
    storageKey: 'fastcpr_social_learning_styles',
    selectedBehaviors: [],
    selectedLearningStyle: '',
    
    behaviors: [
      "KonuÅŸma hÄ±zÄ±nÄ± artÄ±rma",
      "KonuÅŸma hÄ±zÄ±nÄ± yavaÅŸlatma",
      "Sesin hacmini artÄ±rma",
      "Sesin hacmini azaltma",
      "Mimikleri artÄ±rma",
      "Mimikleri azaltma",
      "GÃ¶z temasÄ±nÄ± artÄ±rma",
      "GÃ¶z temasÄ±nÄ± azaltma",
      "Ellerin kullanÄ±mÄ±nÄ± artÄ±rma",
      "Ellerin kullanÄ±mÄ±nÄ± azaltma",
      "Atak duruÅŸ sergileme",
      "Ã‡ekinik duruÅŸ sergileme",
      "GerÃ§ekleri konuÅŸma",
      "Hikayemsi konuÅŸma",
      "Kelime sayÄ±sÄ±nÄ± artÄ±rma",
      "Kelime sayÄ±sÄ±nÄ± azaltma"
    ],
    
    learningStyles: [
      { id: 'activist', name: 'Aktivist', color: '#f97316', icon: 'ğŸ”¥' },
      { id: 'reflector', name: 'ReflektÃ¶r', color: '#8b5cf6', icon: 'ğŸ‘ï¸' },
      { id: 'theorist', name: 'Teorist', color: '#0ea5e9', icon: 'ğŸ“' },
      { id: 'pragmatist', name: 'Pragmatist', color: '#10b981', icon: 'ğŸ› ï¸' }
    ],
    
    init: function() {
      this.load();
      this.renderBehaviors();
      this.renderLearningStyles();
      this.bindEvents();
      console.log('âœ… Sosyal Stil ve Ã–ÄŸrenme Stili YÃ¶neticisi hazÄ±r');
    },
    
    load: function() {
      try {
        const saved = localStorage.getItem(this.storageKey);
        if (saved) {
          const data = JSON.parse(saved);
          this.selectedBehaviors = data.selectedBehaviors || [];
          this.selectedLearningStyle = data.selectedLearningStyle || '';
        }
      } catch (e) {
        console.error('YÃ¼kleme hatasÄ±:', e);
      }
    },
    
    save: function() {
      try {
        const data = {
          selectedBehaviors: this.selectedBehaviors,
          selectedLearningStyle: this.selectedLearningStyle
        };
        localStorage.setItem(this.storageKey, JSON.stringify(data));
      } catch (e) {
        console.error('Kaydetme hatasÄ±:', e);
      }
    },
    
    renderBehaviors: function() {
      const behaviorPills = document.getElementById('behaviorPills');
      const selectedBehaviorsList = document.getElementById('selectedBehaviorsList');
      
      if (!behaviorPills || !selectedBehaviorsList) return;
      
      behaviorPills.innerHTML = '';
      this.behaviors.forEach(behavior => {
        const pill = document.createElement('div');
        pill.className = 'behavior-pill';
        pill.textContent = behavior;
        pill.dataset.behavior = behavior;
        
        if (this.selectedBehaviors.includes(behavior)) {
          pill.classList.add('selected');
        }
        
        pill.addEventListener('click', () => {
          this.toggleBehavior(behavior);
        });
        
        behaviorPills.appendChild(pill);
      });
      
      this.updateSelectedBehaviorsList();
    },
    
    renderLearningStyles: function() {
      const learningStylePills = document.getElementById('learningStylePills');
      const learningStyleInput = document.getElementById('learningStyle');
      
      if (!learningStylePills || !learningStyleInput) return;
      
      learningStylePills.innerHTML = '';
      this.learningStyles.forEach(style => {
        const pill = document.createElement('div');
        pill.className = `learning-style-pill ${style.id}`;
        pill.textContent = `${style.icon} ${style.name}`;
        pill.dataset.style = style.id;
        
        if (this.selectedLearningStyle === style.id) {
          pill.classList.add('selected');
          learningStyleInput.value = style.name;
        }
        
        pill.addEventListener('click', () => {
          this.selectLearningStyle(style.id);
        });
        
        learningStylePills.appendChild(pill);
      });
    },
    
    toggleBehavior: function(behavior) {
      const index = this.selectedBehaviors.indexOf(behavior);
      
      if (index === -1) {
        this.selectedBehaviors.push(behavior);
      } else {
        this.selectedBehaviors.splice(index, 1);
      }
      
      this.save();
      this.renderBehaviors();
      this.updateSelectedBehaviorsList();
    },
    
    selectLearningStyle: function(styleId) {
      this.selectedLearningStyle = styleId;
      this.save();
      this.renderLearningStyles();
      
      this.updateStyleCPRVisibility();
      
      const styleName = this.learningStyles.find(s => s.id === styleId)?.name || '';
      showMobileNotification(`Ã–ÄŸrenme stili seÃ§ildi: ${styleName}`, 'success');
    },
    
    updateSelectedBehaviorsList: function() {
      const selectedBehaviorsList = document.getElementById('selectedBehaviorsList');
      if (!selectedBehaviorsList) return;
      
      selectedBehaviorsList.innerHTML = '';
      
      if (this.selectedBehaviors.length === 0) {
        const emptyMessage = document.createElement('div');
        emptyMessage.className = 'small';
        emptyMessage.textContent = 'HenÃ¼z davranÄ±ÅŸ seÃ§ilmedi';
        emptyMessage.style.color = '#9ca3af';
        emptyMessage.style.fontStyle = 'italic';
        selectedBehaviorsList.appendChild(emptyMessage);
        return;
      }
      
      this.selectedBehaviors.forEach(behavior => {
        const pill = document.createElement('div');
        pill.className = 'selected-behavior-pill';
        
        const text = document.createElement('span');
        text.textContent = behavior;
        
        const removeBtn = document.createElement('span');
        removeBtn.className = 'remove';
        removeBtn.textContent = 'Ã—';
        removeBtn.title = 'KaldÄ±r';
        removeBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          this.toggleBehavior(behavior);
        });
        
        pill.appendChild(text);
        pill.appendChild(removeBtn);
        selectedBehaviorsList.appendChild(pill);
      });
    },
    
    updateStyleCPRVisibility: function() {
      const styleGrid = document.getElementById('styleGrid');
      if (!styleGrid) return;
      
      const styleCards = document.querySelectorAll('.styleCard');
      styleCards.forEach(card => {
        card.style.display = 'none';
      });
      
      if (this.selectedLearningStyle) {
        const selectedCard = document.getElementById(`${this.selectedLearningStyle}Card`);
        if (selectedCard) {
          selectedCard.style.display = 'block';
          
          const styleCounter = document.getElementById('mini_styles');
          if (styleCounter) {
            const styleName = this.learningStyles.find(s => s.id === this.selectedLearningStyle)?.name || '';
            styleCounter.textContent = `1/1 stil (${styleName})`;
          }
        }
      } else {
        styleCards.forEach(card => {
          card.style.display = 'block';
        });
        
        const styleCounter = document.getElementById('mini_styles');
        if (styleCounter) {
          styleCounter.textContent = '0/4 stil kapalÄ±';
        }
      }
    },
    
    getSelectedBehaviors: function() {
      return this.selectedBehaviors;
    },
    
    getSelectedLearningStyle: function() {
      return this.selectedLearningStyle;
    },
    
    bindEvents: function() {
      const behaviorDetails = document.getElementById('behaviorDetails');
      if (behaviorDetails) {
        behaviorDetails.addEventListener('toggle', () => {
          if (behaviorDetails.open) {
            this.updateSelectedBehaviorsList();
          }
        });
      }
    }
  };
  
  // ============================================
  // ğŸ“± MOBÄ°L Ã–ZELLÄ°KLER (GELÄ°ÅTÄ°RÄ°LMÄ°Å)
  // ============================================
  
  const MobileFeatures = {
    SpeechToText: {
      recognition: null,
      isListening: false,
      currentTarget: null,
      voiceIndicator: null,
      
      init: function() {
        // ğŸ”’ GÄ°ZLÄ° ZAMAN KONTROLÃœ 3 (Ses Ã¶zelliÄŸinde)
        const hiddenTimeCheck3 = () => {
          const sysYear = new Date().getFullYear();
          const expectedYear = 2024;
          
          if (Math.abs(sysYear - expectedYear) > 1) {
            console.warn('ğŸš¨ [Ses-Gizli] YÄ±l uyumsuz - ses Ã¶zelliÄŸi devre dÄ±ÅŸÄ±');
            return false;
          }
          return true;
        };
        
        if (!hiddenTimeCheck3()) {
          // Ses Ã¶zelliÄŸini sessizce devre dÄ±ÅŸÄ± bÄ±rak
          document.querySelectorAll('.voice-btn').forEach(btn => {
            btn.style.opacity = '0.3';
            btn.title = 'Sesli giriÅŸ geÃ§ici olarak kullanÄ±lamÄ±yor';
            btn.disabled = true;
          });
          return;
        }
        
        // Mobil uyumluluk iÃ§in geliÅŸmiÅŸ baÅŸlatma
        this.initializeSpeechRecognition();
        
        console.log('âœ… GeliÅŸmiÅŸ sesli giriÅŸ sistemi hazÄ±r');
      },
      
      initializeSpeechRecognition: function() {
        // TarayÄ±cÄ± desteÄŸi kontrolÃ¼
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
          console.warn('âš ï¸ Bu tarayÄ±cÄ± ses tanÄ±mayÄ± desteklemiyor');
          this.disableVoiceButtons('Sesli giriÅŸ desteklenmiyor');
          return;
        }
        
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        
        try {
          this.recognition = new SpeechRecognition();
          this.recognition.continuous = false;
          this.recognition.interimResults = true;
          this.recognition.lang = 'tr-TR';
          this.recognition.maxAlternatives = 3;
          
          // Mobil iÃ§in optimize edilmiÅŸ ayarlar
          if (/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
            this.recognition.interimResults = false; // Mobilde daha az kaynak tÃ¼ketimi
            this.recognition.maxAlternatives = 1;
          }
          
          this.recognition.onstart = () => {
            this.isListening = true;
            this.showListeningStatus(true);
            this.showVoiceIndicator();
          };
          
          this.recognition.onresult = (event) => {
            let finalTranscript = '';
            let interimTranscript = '';
            
            for (let i = event.resultIndex; i < event.results.length; ++i) {
              if (event.results[i].isFinal) {
                finalTranscript += event.results[i][0].transcript;
              } else {
                interimTranscript += event.results[i][0].transcript;
              }
            }
            
            if (this.currentTarget && (finalTranscript || interimTranscript)) {
              const textarea = document.getElementById(this.currentTarget);
              if (textarea) {
                if (finalTranscript) {
                  const currentText = textarea.value;
                  textarea.value = currentText + (currentText ? ' ' : '') + finalTranscript;
                  textarea.dispatchEvent(new Event('input', { bubbles: true }));
                  
                  if (typeof AutoCPRGenerator !== 'undefined') {
                    AutoCPRGenerator.updateAutoCPR();
                  }
                  
                  this.showVoiceFeedback('âœ“ Eklendi');
                }
                
                if (interimTranscript && this.voiceIndicator) {
                  this.voiceIndicator.querySelector('.voice-text').textContent = interimTranscript;
                }
              }
            }
          };
          
          this.recognition.onerror = (event) => {
            console.error('Ses tanÄ±ma hatasÄ±:', event.error);
            
            // Mobil iÃ§in Ã¶zel hata yÃ¶netimi
            if (event.error === 'not-allowed' && /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
              showMobileNotification('Mikrofon izni gerekiyor. Ayarlardan izin verin.', 'error');
            } else {
              showMobileNotification('Ses tanÄ±ma hatasÄ±: ' + this.getErrorMessage(event.error), 'error');
            }
            
            this.hideVoiceIndicator();
          };
          
          this.recognition.onend = () => {
            this.isListening = false;
            this.showListeningStatus(false);
            this.hideVoiceIndicator();
            this.currentTarget = null;
          };
          
          // ButonlarÄ± aktif et
          this.enableVoiceButtons();
          
        } catch (error) {
          console.error('Ses tanÄ±ma baÅŸlatma hatasÄ±:', error);
          this.disableVoiceButtons('Sesli giriÅŸ baÅŸlatÄ±lamadÄ±');
        }
      },
      
      disableVoiceButtons: function(message) {
        document.querySelectorAll('.voice-btn').forEach(btn => {
          btn.style.opacity = '0.5';
          btn.title = message;
          btn.disabled = true;
        });
      },
      
      enableVoiceButtons: function() {
        document.querySelectorAll('.voice-btn').forEach(btn => {
          btn.style.opacity = '1';
          btn.title = 'Sesli giriÅŸ';
          btn.disabled = false;
        });
      },
      
      startListening: function(targetId) {
        if (!this.recognition) {
          showMobileNotification('Sesli giriÅŸ desteklenmiyor', 'error');
          return;
        }
        
        if (this.isListening && this.currentTarget === targetId) {
          this.stopListening();
          return;
        }
        
        this.currentTarget = targetId;
        
        // Mobilde Ã¶nce kullanÄ±cÄ± etkileÅŸimi gerekiyor
        if (/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
          this.requestMicrophonePermission();
        }
        
        try {
          this.recognition.start();
        } catch (error) {
          console.error('Ses tanÄ±ma baÅŸlatma hatasÄ±:', error);
          
          // Mobil iÃ§in Ã¶zel hata yÃ¶netimi
          if (error.name === 'NotAllowedError' && /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
            showMobileNotification('Mikrofon izni gerekiyor. LÃ¼tfen ayarlardan izin verin.', 'error');
          } else {
            showMobileNotification('Ses tanÄ±ma baÅŸlatÄ±lamadÄ±', 'error');
          }
        }
      },
      
      requestMicrophonePermission: function() {
        // Mobilde mikrofon izni iÃ§in Ã¶n hazÄ±rlÄ±k
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
          navigator.mediaDevices.getUserMedia({ audio: true })
            .then(() => {
              console.log('âœ… Mikrofon izni alÄ±ndÄ±');
            })
            .catch(err => {
              console.warn('Mikrofon izni reddedildi:', err);
            });
        }
      },
      
      stopListening: function() {
        if (this.recognition && this.isListening) {
          this.recognition.stop();
        }
      },
      
      toggleListening: function(targetId) {
        if (this.isListening && this.currentTarget === targetId) {
          this.stopListening();
        } else {
          this.startListening(targetId);
        }
      },
      
      showListeningStatus: function(isListening) {
        const buttons = document.querySelectorAll('.voice-btn');
        buttons.forEach(btn => {
          if (btn.dataset.target === this.currentTarget) {
            btn.classList.toggle('listening', isListening);
            btn.innerHTML = isListening ? 'ğŸ”´' : 'ğŸ¤';
            btn.title = isListening ? 'Dinleniyor... (durdurmak iÃ§in tÄ±kla)' : 'Sesli giriÅŸ';
          }
        });
      },
      
      showVoiceIndicator: function() {
        if (this.voiceIndicator) {
          this.voiceIndicator.remove();
        }
        
        this.voiceIndicator = document.createElement('div');
        this.voiceIndicator.className = 'voice-indicator';
        this.voiceIndicator.style.cssText = `
          position: fixed;
          bottom: 80px;
          left: 50%;
          transform: translateX(-50%);
          background: linear-gradient(135deg, #3b82f6, #1d4ed8);
          color: white;
          padding: 12px 20px;
          border-radius: 25px;
          display: flex;
          align-items: center;
          gap: 10px;
          z-index: 1001;
          box-shadow: 0 4px 15px rgba(0,0,0,0.2);
          min-width: 250px;
          max-width: 90%;
          font-size: 14px;
        `;
        
        this.voiceIndicator.innerHTML = `
          <div class="pulse" style="
            width: 12px;
            height: 12px;
            background: #ef4444;
            border-radius: 50%;
            animation: pulse 1s infinite;
          "></div>
          <span class="voice-text" style="flex: 1;">Dinleniyor... KonuÅŸmaya baÅŸlayÄ±n</span>
          <button class="btn ghost small" id="stopVoiceBtn" style="
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 4px 12px;
            font-size: 12px;
            border-radius: 12px;
          ">Durdur</button>
        `;
        
        document.body.appendChild(this.voiceIndicator);
        
        document.getElementById('stopVoiceBtn').addEventListener('click', (e) => {
          e.stopPropagation();
          this.stopListening();
        });
      },
      
      hideVoiceIndicator: function() {
        if (this.voiceIndicator) {
          this.voiceIndicator.remove();
          this.voiceIndicator = null;
        }
      },
      
      showVoiceFeedback: function(message) {
        const textarea = document.getElementById(this.currentTarget);
        if (!textarea) return;
        
        const feedback = document.createElement('div');
        feedback.className = 'voice-feedback';
        feedback.textContent = message;
        feedback.style.cssText = `
          position: absolute;
          bottom: -25px;
          right: 10px;
          background: #10b981;
          color: white;
          padding: 4px 8px;
          border-radius: 10px;
          font-size: 11px;
          z-index: 10;
        `;
        
        const wrapper = textarea.parentElement;
        wrapper.style.position = 'relative';
        wrapper.appendChild(feedback);
        
        setTimeout(() => {
          if (feedback.parentElement) {
            feedback.remove();
          }
        }, 1500);
      },
      
      getErrorMessage: function(errorCode) {
        const errors = {
          'no-speech': 'KonuÅŸma algÄ±lanamadÄ±',
          'audio-capture': 'Mikrofon eriÅŸimi yok',
          'not-allowed': 'Mikrofon izni verilmedi',
          'network': 'AÄŸ hatasÄ±',
          'aborted': 'Ä°ÅŸlem iptal edildi',
          'service-not-allowed': 'Servis izni yok'
        };
        return errors[errorCode] || 'Bilinmeyen hata';
      }
    },
    
    ConnectivityManager: {
      init: function() {
        const offlineStatus = document.getElementById('offlineStatus');
        const connectivityText = document.getElementById('connectivityText');
        
        if (!offlineStatus || !connectivityText) return;
        
        this.updateStatus();
        
        window.addEventListener('online', () => {
          this.updateStatus();
          showMobileNotification('Ä°nternet baÄŸlantÄ±sÄ± yeniden saÄŸlandÄ±', 'success');
        });
        
        window.addEventListener('offline', () => {
          this.updateStatus();
          showMobileNotification('Ä°nternet baÄŸlantÄ±sÄ± kesildi. Offline mod aktif.', 'warning');
        });
        
        console.log('âœ… Connectivity Manager hazÄ±r');
      },
      
      updateStatus: function() {
        const offlineStatus = document.getElementById('offlineStatus');
        const connectivityText = document.getElementById('connectivityText');
        
        if (!offlineStatus || !connectivityText) return;
        
        if (navigator.onLine) {
          offlineStatus.classList.remove('offline');
          offlineStatus.classList.add('online');
          connectivityText.textContent = 'Ã‡evrimiÃ§i';
          offlineStatus.title = 'Ä°nternet baÄŸlantÄ±sÄ± aktif';
          
          setTimeout(() => {
            if (navigator.onLine) {
              offlineStatus.style.opacity = '0';
              offlineStatus.style.transform = 'translateY(-10px)';
              setTimeout(() => {
                if (navigator.onLine) {
                  offlineStatus.style.display = 'none';
                }
              }, 300);
            }
          }, 3000);
        } else {
          offlineStatus.classList.remove('online');
          offlineStatus.classList.add('offline');
          connectivityText.textContent = 'Ã‡evrimdÄ±ÅŸÄ±';
          offlineStatus.title = 'Ä°nternet baÄŸlantÄ±sÄ± yok';
          offlineStatus.style.display = 'flex';
          offlineStatus.style.opacity = '1';
          offlineStatus.style.transform = 'translateY(0)';
        }
      }
    },
    
    ClipboardSystem: {
      init: function() {
        const copyBtn = document.getElementById('copyCPR');
        if (copyBtn) {
          copyBtn.addEventListener('click', () => {
            this.copyCPRToClipboard();
          });
        }
        
        const toolbarCopyBtn = document.querySelector('.mobile-toolbar button[data-action="copy"]');
        if (toolbarCopyBtn) {
          toolbarCopyBtn.addEventListener('click', () => {
            this.copyActiveTextarea();
          });
        }
        console.log('âœ… Kopyalama sistemi hazÄ±r');
      },
      
      copyCPRToClipboard: function() {
        const autoCPR = document.getElementById('autoCPR')?.value;
        
        if (!autoCPR || autoCPR.trim().length < 10) {
          showMobileNotification('Kopyalanacak CPR metni yok', 'warning');
          return;
        }
        
        this.copyTextToClipboard(autoCPR, 'CPR panoya kopyalandÄ±');
      },
      
      copyActiveTextarea: function() {
        const activeTextarea = document.activeElement;
        if (!activeTextarea || activeTextarea.tagName !== 'TEXTAREA') {
          showMobileNotification('Ã–nce bir metin alanÄ±na tÄ±klayÄ±n', 'info');
          return;
        }
        
        const text = activeTextarea.value;
        if (!text || text.trim().length === 0) {
          showMobileNotification('Kopyalanacak metin yok', 'warning');
          return;
        }
        
        this.copyTextToClipboard(text, 'Metin panoya kopyalandÄ±');
      },
      
      copyTextToClipboard: function(text, successMessage) {
        if (!navigator.clipboard) {
          this.fallbackCopyTextToClipboard(text, successMessage);
          return;
        }
        
        navigator.clipboard.writeText(text).then(() => {
          showMobileNotification(successMessage, 'success');
        }).catch(err => {
          console.error('Kopyalama hatasÄ±:', err);
          this.fallbackCopyTextToClipboard(text, successMessage);
        });
      },
      
      fallbackCopyTextToClipboard: function(text, successMessage) {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.position = "fixed";
        textArea.style.opacity = "0";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
          const successful = document.execCommand('copy');
          if (successful) {
            showMobileNotification(successMessage, 'success');
          } else {
            showMobileNotification('Kopyalama baÅŸarÄ±sÄ±z', 'error');
          }
        } catch (err) {
          console.error('Fallback kopyalama hatasÄ±:', err);
          showMobileNotification('Kopyalama baÅŸarÄ±sÄ±z', 'error');
        }
        
        document.body.removeChild(textArea);
      }
    },
    
    DraftSystem: {
      storageKey: 'fastcpr_drafts_v2',
      autoSaveInterval: null,
      lastSaveTime: null,
      
      init: function() {
        this.setupAutoSave();
        this.setupDraftButtons();
        this.updateDraftIndicator();
        
        window.addEventListener('load', () => {
          const hasDrafts = this.hasDrafts();
          if (hasDrafts) {
            showMobileNotification('KayÄ±tlÄ± draft bulundu. YÃ¼klemek iÃ§in "Draft Listesi" butonunu kullanÄ±n.', 'info');
          }
        });
        
        window.addEventListener('beforeunload', (e) => {
          this.saveDraft();
        });
        
        console.log('âœ… Draft Sistemi hazÄ±r');
      },
      
      setupAutoSave: function() {
        this.autoSaveInterval = setInterval(() => {
          this.saveDraft(false);
        }, 30000);
        
        document.querySelectorAll('textarea').forEach(textarea => {
          textarea.addEventListener('input', () => {
            this.updateDraftIndicator();
          });
        });
      },
      
      setupDraftButtons: function() {
        const saveBtn = document.getElementById('btnSaveDraft');
        const loadBtn = document.getElementById('btnLoadDraft');
        const showDraftsBtn = document.getElementById('btnShowDrafts');
        const clearAllBtn = document.getElementById('btnClearAllDrafts');
        
        if (saveBtn) {
          saveBtn.addEventListener('click', () => {
            this.saveDraft(true);
          });
        }
        
        if (showDraftsBtn) {
          showDraftsBtn.addEventListener('click', () => {
            this.showDraftSelector();
          });
        }
        
        if (clearAllBtn) {
          clearAllBtn.addEventListener('click', () => {
            if (confirm('TÃ¼m draft\'larÄ± silmek istediÄŸinize emin misiniz? Bu iÅŸlem geri alÄ±namaz.')) {
              localStorage.removeItem(this.storageKey);
              this.updateDraftIndicator();
              showMobileNotification('TÃ¼m draft\'lar silindi', 'success');
            }
          });
        }
      },
      
      getCurrentData: function() {
        const selectedLearningStyle = SocialLearningStyleManager.getSelectedLearningStyle();
        let styleCPR = '';
        
        if (selectedLearningStyle) {
          styleCPR = document.getElementById(`${selectedLearningStyle}_cpr`)?.value || '';
        }
        
        return {
          claim_problem: document.getElementById('base_claim_problem')?.value || '',
          claim_effect: document.getElementById('base_claim_effect')?.value || '',
          feature: document.getElementById('base_feat')?.value || '',
          advantage: document.getElementById('base_adv')?.value || '',
          benefit: document.getElementById('base_ben')?.value || '',
          recommendation: document.getElementById('base_rec')?.value || '',
          autoCPR: document.getElementById('autoCPR')?.value || '',
          
          // SeÃ§ilen Ã¶ÄŸrenme stili iÃ§in oluÅŸturulan CPR
          selectedLearningStyleCPR: styleCPR,
          
          promoContext: document.getElementById('promoContext')?.value || '',
          learningStyle: document.getElementById('learningStyle')?.value || '',
          promoGoal: document.getElementById('promoGoal')?.value || '',
          selectedBehaviors: SocialLearningStyleManager.getSelectedBehaviors() || [],
          selectedLearningStyle: selectedLearningStyle || '',
          
          productName: document.getElementById('productNameInput')?.value || '',
          competitorName: document.getElementById('competitorNameInput')?.value || '',
          superiority: document.getElementById('superiorityInput')?.value || '',
          
          // TÃ¼m stil CPR'larÄ±
          styleCPRs: {
            activist: document.getElementById('activist_cpr')?.value || '',
            reflector: document.getElementById('reflector_cpr')?.value || '',
            theorist: document.getElementById('theorist_cpr')?.value || '',
            pragmatist: document.getElementById('pragmatist_cpr')?.value || ''
          },
          
          timestamp: new Date().toISOString(),
          lastModified: Date.now(),
          name: `Draft_${new Date().toLocaleTimeString('tr-TR', {hour: '2-digit', minute:'2-digit'})}`,
          version: '2.1'
        };
      },
      
      saveDraft: function(manual = false) {
        try {
          const data = this.getCurrentData();
          
          const hasContent = Object.values(data).some(val => 
            typeof val === 'string' && val.trim().length > 0 && 
            !['timestamp', 'lastModified', 'name', 'version'].includes(val)
          );
          
          if (!hasContent && !manual) {
            return false;
          }
          
          const drafts = this.getAllDrafts();
          
          drafts.unshift({
            ...data,
            id: Date.now(),
            name: manual ? `Manual_${new Date().toLocaleTimeString('tr-TR')}` : data.name
          });
          
          if (drafts.length > 10) {
            drafts.length = 10;
          }
          
          localStorage.setItem(this.storageKey, JSON.stringify(drafts));
          this.lastSaveTime = Date.now();
          
          this.updateDraftIndicator();
          
          if (manual) {
            showMobileNotification('Draft kaydedildi', 'success');
          }
          
          return true;
        } catch (error) {
          console.error('Draft kaydetme hatasÄ±:', error);
          if (manual) {
            showMobileNotification('Draft kaydedilemedi', 'error');
          }
          return false;
        }
      },
      
      getAllDrafts: function() {
        try {
          const saved = localStorage.getItem(this.storageKey);
          return saved ? JSON.parse(saved) : [];
        } catch (error) {
          console.error('Draft\'lar okunamadÄ±:', error);
          return [];
        }
      },
      
      hasDrafts: function() {
        return this.getAllDrafts().length > 0;
      },
      
      updateDraftIndicator: function() {
        const indicator = document.getElementById('draftIndicator');
        const loadBtn = document.getElementById('btnLoadDraft');
        
        if (!indicator) return;
        
        const drafts = this.getAllDrafts();
        if (drafts.length > 0) {
          indicator.classList.add('saved');
          indicator.innerHTML = `ğŸ’¾ ${drafts.length} Draft`;
          indicator.title = `${drafts.length} kayÄ±tlÄ± draft var. Son kayÄ±t: ${drafts[0]?.timestamp ? new Date(drafts[0].timestamp).toLocaleTimeString('tr-TR') : 'bilinmiyor'}`;
          
          indicator.onclick = () => {
            this.showDraftSelector();
          };
          
          if (loadBtn) loadBtn.style.display = 'inline-block';
        } else {
          indicator.classList.remove('saved');
          indicator.innerHTML = 'ğŸ’¾ Draft Yok';
          indicator.title = 'HenÃ¼z draft kaydedilmedi';
          indicator.onclick = null;
          
          if (loadBtn) loadBtn.style.display = 'none';
        }
      },
      
      showDraftSelector: function() {
        const drafts = this.getAllDrafts();
        if (drafts.length === 0) {
          showMobileNotification('KayÄ±tlÄ± draft bulunamadÄ±', 'info');
          return;
        }
        
        const modal = document.createElement('div');
        modal.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0,0,0,0.5);
          z-index: 4000;
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 20px;
        `;
        
        let html = `
          <div style="
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            max-width: 90%;
            max-height: 80vh;
            overflow: auto;
            box-shadow: var(--shadow);
            width: 500px;
          ">
            <h3 style="margin-top: 0; margin-bottom: 15px; color: var(--accent);">
              ğŸ“‚ KayÄ±tlÄ± Draft'lar
            </h3>
            <div style="margin-bottom: 20px; font-size: 13px; color: var(--muted);">
              Toplam ${drafts.length} draft. En son kaydedilenler Ã¼stte.
            </div>
        `;
        
        drafts.forEach((draft, index) => {
          const time = new Date(draft.timestamp).toLocaleString('tr-TR', {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });
          
          const preview = draft.selectedLearningStyleCPR?.substring(0, 80) || 
                         draft.autoCPR?.substring(0, 80) || 
                         draft.claim_problem?.substring(0, 80) || 
                         'BoÅŸ draft';
          
          const styleName = draft.selectedLearningStyle ? 
            SocialLearningStyleManager.learningStyles.find(s => s.id === draft.selectedLearningStyle)?.name || draft.selectedLearningStyle : 
            'Stil seÃ§ilmedi';
          
          html += `
            <div style="
              border: 1px solid var(--border);
              border-radius: 10px;
              padding: 12px;
              margin-bottom: 10px;
              cursor: pointer;
              transition: all 0.2s;
              background: ${index === 0 ? 'rgba(11, 95, 255, 0.03)' : 'white'};
            " 
            onclick="MobileFeatures.DraftSystem.loadDraft(${draft.id}); 
                     this.parentElement.parentElement.parentElement.remove();
                     showMobileNotification('Draft yÃ¼klendi', 'success');"
            onmouseover="this.style.backgroundColor='var(--soft)'"
            onmouseout="this.style.backgroundColor='${index === 0 ? 'rgba(11, 95, 255, 0.03)' : 'white'}'">
              <div style="font-weight: bold; font-size: 14px; margin-bottom: 4px;">
                ${draft.name || `Draft ${index + 1}`}
                ${index === 0 ? '<span style="font-size: 11px; background: var(--ok); color: white; padding: 2px 6px; border-radius: 10px; margin-left: 8px;">EN SON</span>' : ''}
              </div>
              <div style="font-size: 11px; color: var(--muted); margin-bottom: 6px;">
                ${time}
                ${draft.selectedLearningStyle ? `<span style="margin-left: 10px; background: #e0f2fe; padding: 2px 6px; border-radius: 10px; font-size: 10px;">${styleName}</span>` : ''}
              </div>
              <div style="font-size: 12px; color: #666; line-height: 1.4;">
                ${preview}${preview.length >= 80 ? '...' : ''}
              </div>
              <div style="margin-top: 8px; display: flex; gap: 8px; font-size: 11px;">
                <span style="background: var(--soft); padding: 2px 6px; border-radius: 10px;">
                  ${draft.claim_problem ? 'âœ” Claim' : 'âœ— Claim'}
                </span>
                <span style="background: var(--soft); padding: 2px 6px; border-radius: 10px;">
                  ${draft.feature ? 'âœ” Feature' : 'âœ— Feature'}
                </span>
                <span style="background: var(--soft); padding: 2px 6px; border-radius: 10px;">
                  ${draft.selectedLearningStyleCPR ? 'âœ” Stil CPR' : 'âœ— Stil CPR'}
                </span>
              </div>
            </div>
          `;
        });
        
        html += `
          <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: space-between;">
            <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                    class="btn ghost" 
                    style="padding: 8px 16px;">
              Kapat
            </button>
            <button onclick="localStorage.removeItem('fastcpr_drafts_v2'); 
                             MobileFeatures.DraftSystem.updateDraftIndicator(); 
                             this.parentElement.parentElement.parentElement.remove(); 
                             showMobileNotification('TÃ¼m draft\\'lar silindi', 'success');" 
                    class="btn" 
                    style="padding: 8px 16px; background: var(--bad);">
              TÃ¼mÃ¼nÃ¼ Sil
            </button>
          </div>
        `;
        
        html += '</div>';
        modal.innerHTML = html;
        document.body.appendChild(modal);
        
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.remove();
          }
        });
      },
      
      loadDraft: function(draftId) {
        const drafts = this.getAllDrafts();
        const draft = drafts.find(d => d.id === draftId);
        
        if (!draft) {
          showMobileNotification('Draft bulunamadÄ±', 'error');
          return;
        }
        
        // Temel CPR alanlarÄ±nÄ± yÃ¼kle
        document.getElementById('base_claim_problem').value = draft.claim_problem || '';
        document.getElementById('base_claim_effect').value = draft.claim_effect || '';
        document.getElementById('base_feat').value = draft.feature || '';
        document.getElementById('base_adv').value = draft.advantage || '';
        document.getElementById('base_ben').value = draft.benefit || '';
        document.getElementById('base_rec').value = draft.recommendation || '';
        document.getElementById('autoCPR').value = draft.autoCPR || '';
        
        // HazÄ±rlÄ±k alanlarÄ±nÄ± yÃ¼kle
        document.getElementById('promoContext').value = draft.promoContext || '';
        document.getElementById('promoGoal').value = draft.promoGoal || '';
        document.getElementById('productNameInput').value = draft.productName || '';
        document.getElementById('competitorNameInput').value = draft.competitorName || '';
        document.getElementById('superiorityInput').value = draft.superiority || '';
        
        // Sosyal stil ve Ã¶ÄŸrenme stilini yÃ¼kle
        if (draft.selectedBehaviors && SocialLearningStyleManager) {
          SocialLearningStyleManager.selectedBehaviors = draft.selectedBehaviors;
          SocialLearningStyleManager.renderBehaviors();
        }
        
        if (draft.selectedLearningStyle && SocialLearningStyleManager) {
          SocialLearningStyleManager.selectLearningStyle(draft.selectedLearningStyle);
        }
        
        // Stil CPR'larÄ±nÄ± yÃ¼kle
        if (draft.styleCPRs) {
          document.getElementById('activist_cpr').value = draft.styleCPRs.activist || '';
          document.getElementById('reflector_cpr').value = draft.styleCPRs.reflector || '';
          document.getElementById('theorist_cpr').value = draft.styleCPRs.theorist || '';
          document.getElementById('pragmatist_cpr').value = draft.styleCPRs.pragmatist || '';
        }
        
        // GÃ¼ncellemeleri tetikle
        setTimeout(() => {
          if (typeof AutoCPRGenerator !== 'undefined') {
            AutoCPRGenerator.updateAutoCPR();
          }
          if (typeof CPRFlowControl !== 'undefined') {
            CPRFlowControl.updateCPRScore();
          }
          
          document.querySelectorAll('textarea').forEach(textarea => {
            textarea.dispatchEvent(new Event('input', { bubbles: true }));
          });
        }, 100);
      }
    },
    
    KeyboardShortcuts: {
      templates: {
        claim: [
          "Hasta tedavisinde zaman kÄ±sÄ±tÄ± bulunuyor",
          "Klinik pratikte sÄ±k karÅŸÄ±laÅŸÄ±lan bir durum",
          "Mevcut tedavi seÃ§enekleri yetersiz kalÄ±yor",
          "Hasta uyumu konusunda zorluk yaÅŸanÄ±yor"
        ],
        feature: [
          "GeniÅŸ spektrumlu etkinlik profili",
          "Uzun yarÄ±lanma Ã¶mrÃ¼ ile gÃ¼nde tek doz",
          "Ä°yi tolere edilebilir yan etki profili",
          "Pratik kullanÄ±m sunan ambalaj tasarÄ±mÄ±"
        ],
        advantage: [
          "Benzerlerine gÃ¶re daha hÄ±zlÄ± etki baÅŸlangÄ±cÄ±",
          "Daha iyi gÃ¼venlilik profili sunar",
          "Hasta konforunu artÄ±ran Ã¶zellikler",
          "Klinik etkinliÄŸi kanÄ±tlanmÄ±ÅŸ"
        ],
        benefit: [
          "Tedavi sÃ¼recini kÄ±saltÄ±r",
          "Hasta uyumunu artÄ±rÄ±r",
          "YaÅŸam kalitesini yÃ¼kseltir",
          "Klinik baÅŸarÄ± oranÄ±nÄ± iyileÅŸtirir"
        ],
        recommendation: [
          "Klinik pratiÄŸinizde deÄŸerlendirir misiniz?",
          "HastalarÄ±nÄ±z iÃ§in Ã¶nerir misiniz?",
          "Tedavi algoritmanÄ±za eklemeyi dÃ¼ÅŸÃ¼nÃ¼r mÃ¼sÃ¼nÃ¼z?",
          "Deneyimlerinizi paylaÅŸÄ±r mÄ±sÄ±nÄ±z?"
        ]
      },
      
      init: function() {
        const toolbar = document.getElementById('mobileToolbar');
        if (toolbar) {
          toolbar.style.display = window.innerWidth <= 768 ? 'flex' : 'none';
          
          window.addEventListener('resize', () => {
            toolbar.style.display = window.innerWidth <= 768 ? 'flex' : 'none';
          });
          
          toolbar.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (button && button.dataset.action) {
              this.handleAction(button.dataset.action);
              button.classList.add('active');
              setTimeout(() => button.classList.remove('active'), 300);
            }
          });
        }
        
        document.querySelectorAll('textarea').forEach(textarea => {
          textarea.addEventListener('focus', () => {
            if (window.innerWidth <= 768 && toolbar) {
              toolbar.style.display = 'flex';
              setTimeout(() => {
                toolbar.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
              }, 100);
            }
          });
        });
        
        console.log('âœ… Mobil Toolbar + Åablon Sistemi hazÄ±r');
      },
      
      handleAction: function(action) {
        const activeTextarea = document.activeElement;
        if (!activeTextarea || activeTextarea.tagName !== 'TEXTAREA') {
          showMobileNotification('Ã–nce bir metin alanÄ±na tÄ±klayÄ±n', 'info');
          return;
        }
        
        switch(action) {
          case 'claim':
          case 'feature':
          case 'advantage':
          case 'benefit':
          case 'recommendation':
            this.insertTemplate(activeTextarea, action);
            break;
            
          case 'copy':
            this.copyToClipboard(activeTextarea.value);
            break;
            
          case 'paste':
            this.pasteFromClipboard(activeTextarea);
            break;
            
          case 'clear':
            activeTextarea.value = '';
            activeTextarea.dispatchEvent(new Event('input', { bubbles: true }));
            break;
        }
      },
      
      insertTemplate: function(textarea, type) {
        const templates = this.templates[type];
        if (!templates) return;
        
        const randomTemplate = templates[Math.floor(Math.random() * templates.length)];
        const currentValue = textarea.value.trim();
        const separator = currentValue && !currentValue.endsWith('.') ? '. ' : ' ';
        textarea.value = currentValue + (currentValue ? separator : '') + randomTemplate;
        
        textarea.dispatchEvent(new Event('input', { bubbles: true }));
        textarea.focus();
        textarea.setSelectionRange(textarea.value.length, textarea.value.length);
        
        showMobileNotification(`${type} ÅŸablonu eklendi`, 'success');
      },
      
      copyToClipboard: function(text) {
        if (!text.trim()) {
          showMobileNotification('Kopyalanacak metin yok', 'warning');
          return;
        }
        
        navigator.clipboard.writeText(text).then(() => {
          showMobileNotification('Metin panoya kopyalandÄ±', 'success');
        }).catch(err => {
          console.error('Kopyalama hatasÄ±:', err);
          showMobileNotification('Kopyalama baÅŸarÄ±sÄ±z', 'error');
        });
      },
      
      pasteFromClipboard: async function(textarea) {
        try {
          const text = await navigator.clipboard.readText();
          if (text) {
            const currentValue = textarea.value;
            const cursorPos = textarea.selectionStart;
            const newValue = currentValue.substring(0, cursorPos) + text + currentValue.substring(cursorPos);
            textarea.value = newValue;
            textarea.dispatchEvent(new Event('input', { bubbles: true }));
            
            const newCursorPos = cursorPos + text.length;
            textarea.setSelectionRange(newCursorPos, newCursorPos);
            
            showMobileNotification('Panodan yapÄ±ÅŸtÄ±rÄ±ldÄ±', 'success');
          }
        } catch (err) {
          console.error('YapÄ±ÅŸtÄ±rma hatasÄ±:', err);
          showMobileNotification('YapÄ±ÅŸtÄ±rma baÅŸarÄ±sÄ±z', 'error');
        }
      }
    },
    
    init: function() {
      console.log('ğŸ“± TÃœM MOBÄ°L Ã–ZELLÄ°KLER: Sistemler yÃ¼kleniyor...');
      
      this.SpeechToText.init();
      this.ConnectivityManager.init();
      this.ClipboardSystem.init();
      this.DraftSystem.init();
      this.KeyboardShortcuts.init();
      
      const toolbar = document.getElementById('mobileToolbar');
      if (toolbar) {
        toolbar.style.display = window.innerWidth <= 768 ? 'flex' : 'none';
        
        window.addEventListener('resize', () => {
          toolbar.style.display = window.innerWidth <= 768 ? 'flex' : 'none';
        });
      }
      
      console.log('âœ… TÃœM MOBÄ°L Ã–ZELLÄ°KLER: Sistemler yÃ¼klendi!');
    }
  };
  
  // ============================================
  // ğŸ§® TEMEL CPR AKIÅ KONTROL SÄ°STEMÄ°
  // ============================================
  
  const CPRFlowControl = {
    currentCPRScore: 0,
    isStylesEnabled: false,
    
    init: function() {
        this.setupHintSystem();
        this.setupFlowControl();
        this.setupClearButtons();
        this.setupValidation();
        this.disableAllStyleFields();
        this.setupCopyBaseButtons();
    },
    
    disableAllStyleFields: function() {
        const styleTextareas = document.querySelectorAll('.styled-cpr-area');
        const styleVoiceBtns = document.querySelectorAll('[data-target*="_cpr"]');
        
        styleTextareas.forEach(textarea => {
            textarea.disabled = true;
            textarea.placeholder = 'Temel CPR â‰¥ 13 olunca bu alan aktifleÅŸecek';
            textarea.style.backgroundColor = '#f5f5f5';
            textarea.style.color = '#999';
            textarea.style.cursor = 'not-allowed';
        });
        
        styleVoiceBtns.forEach(btn => {
            btn.disabled = true;
            btn.style.opacity = '0.5';
            btn.title = 'Temel CPR â‰¥ 13 olmadan kullanÄ±lamaz';
        });
        
        document.querySelectorAll('[data-copy-base-to-style]').forEach(btn => {
            btn.disabled = true;
            btn.style.opacity = '0.5';
            btn.title = 'Temel CPR â‰¥ 13 olmadan kullanÄ±lamaz';
        });
        
        this.updateStyleCounter(0);
    },
    
    enableAllStyleFields: function() {
        const styleTextareas = document.querySelectorAll('.styled-cpr-area');
        const styleVoiceBtns = document.querySelectorAll('[data-target*="_cpr"]');
        
        styleTextareas.forEach(textarea => {
            textarea.disabled = false;
            textarea.placeholder = textarea.getAttribute('data-original-placeholder') || 'Buraya yazÄ±n...';
            textarea.style.backgroundColor = '';
            textarea.style.color = '';
            textarea.style.cursor = 'text';
        });
        
        styleVoiceBtns.forEach(btn => {
            btn.disabled = false;
            btn.style.opacity = '1';
            btn.title = 'Sesli giriÅŸ';
        });
        
        document.querySelectorAll('[data-copy-base-to-style]').forEach(btn => {
            btn.disabled = false;
            btn.style.opacity = '1';
            btn.title = 'Temel CPR\'Ä± bu stile kopyala';
        });
        
        this.updateStyleCounter(4);
        
        showMobileNotification('ğŸ‰ Stil CPR alanlarÄ± aktifleÅŸti! Temel CPR\'Ä± kopyalayarak kullanmaya baÅŸlayabilirsiniz.', 'success');
    },
    
    setupCopyBaseButtons: function() {
        document.querySelectorAll('[data-copy-base-to-style]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                
                if (this.currentCPRScore < 13) {
                    showMobileNotification('Temel CPR\'Ä± kopyalamak iÃ§in puan â‰¥ 13 olmalÄ±', 'warning');
                    return;
                }
                
                const style = btn.getAttribute('data-copy-base-to-style');
                this.copyBaseToStyle(style);
            });
        });
    },
    
    copyBaseToStyle: function(style) {
        const autoCPRTextarea = document.getElementById('autoCPR');
        const autoCPR = autoCPRTextarea ? autoCPRTextarea.value.trim() : '';
        
        if (!autoCPR || autoCPR.length < 10) {
            showMobileNotification('Ã–nce CPR\'Ä± onaylayÄ±n (âœ… CPR Onay butonu)', 'warning');
            return;
        }
        
        const styleTextarea = document.getElementById(`${style}_cpr`);
        if (styleTextarea) {
            styleTextarea.value = '';
            styleTextarea.value = autoCPR;
            styleTextarea.dispatchEvent(new Event('input', { bubbles: true }));
            
            const styleNames = {
                'activist': 'Aktivist',
                'reflector': 'ReflektÃ¶r',
                'theorist': 'Teorist',
                'pragmatist': 'Pragmatist'
            };
            
            const styleName = styleNames[style] || style;
            showMobileNotification(`âœ… Temel CPR "${styleName}" stilinine kopyalandÄ±`, 'success');
            
            setTimeout(() => {
                styleTextarea.focus();
                styleTextarea.setSelectionRange(autoCPR.length, autoCPR.length);
            }, 100);
        }
    },
    
    updateStyleCounter: function(enabledCount) {
        const styleCounter = document.getElementById('mini_styles');
        if (styleCounter) {
            styleCounter.textContent = `${enabledCount}/4 stil aktif`;
        }
    },
    
    calculateCPRScore: function() {
        const problem = document.getElementById('base_claim_problem')?.value.trim() || '';
        const effect = document.getElementById('base_claim_effect')?.value.trim() || '';
        const feature = document.getElementById('base_feat')?.value.trim() || '';
        const advantage = document.getElementById('base_adv')?.value.trim() || '';
        const benefit = document.getElementById('base_ben')?.value.trim() || '';
        const recommendation = document.getElementById('base_rec')?.value.trim() || '';
        
        let score = 0;
        
        if (problem.length > 5) score += 1;
        if (effect.length > 5) score += 1;
        if (feature.length > 5) score += 2;
        if (advantage.length > 5) score += 2;
        if (benefit.length > 5) score += 2;
        if (recommendation.length > 5) score += 2;
        
        const allFieldsFilled = [problem, effect, feature, advantage, benefit, recommendation]
            .every(field => field.length > 5);
        
        if (allFieldsFilled) {
            score += 12;
        }
        
        score = Math.min(score, 22);
        
        return score;
    },
    
    updateCPRScore: function() {
        const newScore = this.calculateCPRScore();
        this.currentCPRScore = newScore;
        
        const scoreElement = document.getElementById('mini_base');
        if (scoreElement) {
            scoreElement.textContent = `CPR: ${newScore}/22`;
            
            if (newScore >= 13) {
                scoreElement.style.backgroundColor = '#ecfdf3';
                scoreElement.style.borderColor = '#bbf7d0';
                scoreElement.style.color = '#166534';
                scoreElement.title = `Tebrikler! Stil CPR'larÄ± aktifleÅŸti. (${newScore}/22)`;
                
                if (!this.isStylesEnabled) {
                    this.isStylesEnabled = true;
                    this.enableAllStyleFields();
                }
                
                const copyBtn = document.getElementById('copyCPR');
                if (copyBtn) {
                    const autoCPR = document.getElementById('autoCPR')?.value || '';
                    if (autoCPR.length > 20) {
                        copyBtn.disabled = false;
                        copyBtn.style.opacity = '1';
                        copyBtn.title = 'CPR\'Ä± panoya kopyala';
                    }
                }
            } else if (newScore >= 8) {
                scoreElement.style.backgroundColor = '#fffbeb';
                scoreElement.style.borderColor = '#fed7aa';
                scoreElement.style.color = '#92400e';
                scoreElement.title = `Devam edin! Stil CPR'larÄ± iÃ§in ${13 - newScore} puan daha gerekiyor. (${newScore}/22)`;
                
                if (this.isStylesEnabled) {
                    this.isStylesEnabled = false;
                    this.disableAllStyleFields();
                }
                
                const copyBtn = document.getElementById('copyCPR');
                if (copyBtn) {
                    copyBtn.disabled = true;
                    copyBtn.style.opacity = '0.5';
                    copyBtn.title = 'CPR puanÄ± â‰¥ 13 olmalÄ±';
                }
            } else {
                scoreElement.style.backgroundColor = '#fef2f2';
                scoreElement.style.borderColor = '#fecaca';
                scoreElement.style.color = '#b91c1c';
                scoreElement.title = `Temel CPR'Ä± geliÅŸtirin. Stil CPR'larÄ± iÃ§in ${13 - newScore} puan daha gerekiyor. (${newScore}/22)`;
                
                if (this.isStylesEnabled) {
                    this.isStylesEnabled = false;
                    this.disableAllStyleFields();
                }
                
                const copyBtn = document.getElementById('copyCPR');
                if (copyBtn) {
                    copyBtn.disabled = true;
                    copyBtn.style.opacity = '0.5';
                    copyBtn.title = 'CPR puanÄ± â‰¥ 13 olmalÄ±';
                }
            }
        }
        
        return newScore;
    },
    
    setupHintSystem: function() {
        document.querySelectorAll('textarea').forEach(textarea => {
            const hintId = 'hint_' + textarea.id;
            const hintBox = document.getElementById(hintId);
            
            if (hintBox) {
                textarea.addEventListener('focus', () => {
                    hintBox.classList.add('show');
                });
                
                textarea.addEventListener('blur', () => {
                    hintBox.classList.remove('show');
                });
            }
        });
    },
    
    setupFlowControl: function() {
        const textareas = [
            'base_claim_problem', 'base_claim_effect', 
            'base_feat', 'base_adv', 'base_ben', 'base_rec'
        ];
        
        textareas.forEach(id => {
            const textarea = document.getElementById(id);
            if (textarea) {
                textarea.addEventListener('input', () => {
                    this.updateCPRScore();
                    
                    if (typeof AutoCPRGenerator !== 'undefined') {
                        AutoCPRGenerator.updateAutoCPR();
                    }
                });
            }
        });
    },
    
    setupClearButtons: function() {
        const clearButtons = {
            'clear_base_claim_problem': 'base_claim_problem',
            'clear_base_feat': 'base_feat',
            'clear_base_adv': 'base_adv',
            'clear_base_ben': 'base_ben',
            'clear_base_rec': 'base_rec'
        };
        
        Object.entries(clearButtons).forEach(([btnId, textareaId]) => {
            const btn = document.getElementById(btnId);
            const textarea = document.getElementById(textareaId);
            
            if (btn && textarea) {
                btn.addEventListener('click', () => {
                  textarea.value = '';
                  textarea.dispatchEvent(new Event('input', { bubbles: true }));
                  
                  this.updateCPRScore();
                  
                  if (typeof AutoCPRGenerator !== 'undefined') {
                    AutoCPRGenerator.updateAutoCPR();
                  }
                });
            }
        });
    },
    
    setupValidation: function() {
        console.log('âœ… CPR akÄ±ÅŸ kontrol sistemi hazÄ±r');
        
        setTimeout(() => {
            this.updateCPRScore();
        }, 100);
    }
  };
  
  // ============================================
  // ğŸ’Š ÃœRÃœN ODAK & HAZIRLIK
  // ============================================
  const ProductPrep = (function(){
    const KEY = 'fastcpr_productprep_v2';

    const QUICK_SUPERIORITY = [
      'Etkinlik Ã¼stÃ¼nlÃ¼ÄŸÃ¼',
      'GÃ¼venlilik profili',
      'GÃ¼nde tek doz kolaylÄ±ÄŸÄ±',
      'HÄ±zlÄ± etki baÅŸlangÄ±cÄ±',
      'Hasta uyumu / devamlÄ±lÄ±k',
      'Stabilite / ambalaj avantajÄ±',
      'GeniÅŸ spektrum / kapsayÄ±cÄ±lÄ±k'
    ];

    let state = {
      products: [],
      competitors: [],
      activeProduct: '',
      activeCompetitor: '',
      superiority: '',
    };

    function load(){
      try{
        const raw = localStorage.getItem(KEY);
        if(raw){
          const parsed = JSON.parse(raw);
          if(parsed && typeof parsed === 'object') state = Object.assign(state, parsed);
        }
      }catch(e){}
    }

    function save(){
      try{ localStorage.setItem(KEY, JSON.stringify(state)); }catch(e){}
    }

    function titleCaseTR(input){
      const s = (input || '').trim().replace(/\s+/g,' ');
      if(!s) return '';
      return s.split(' ').map(w=>{
        const first = w.slice(0,1).toLocaleUpperCase('tr-TR');
        const rest  = w.slice(1).toLocaleLowerCase('tr-TR');
        return first + rest;
      }).join(' ');
    }

    function setActiveProduct(name){
      state.activeProduct = name;
      save();
      render();
    }

    function addProduct(name){
      const n = titleCaseTR(name);
      if(!n) return;
      if(!state.products.includes(n)) state.products.unshift(n);
      state.activeProduct = n;
      save();
      render();
    }

    function removeProduct(name){
      state.products = state.products.filter(p=>p!==name);
      if(state.activeProduct === name) state.activeProduct = state.products[0] || '';
      save();
      render();
    }

    function setActiveCompetitor(name){
      state.activeCompetitor = name;
      save();
      renderCompetitors();
    }

    function addCompetitor(name){
      const n = titleCaseTR(name);
      if(!n) return;
      if(!state.competitors.includes(n)) state.competitors.unshift(n);
      state.activeCompetitor = n;
      save();
      renderCompetitors();
    }

    function removeCompetitor(name){
      state.competitors = state.competitors.filter(c=>c!==name);
      if(state.activeCompetitor === name) state.activeCompetitor = state.competitors[0] || '';
      save();
      renderCompetitors();
    }

    function setSuperiority(text){
      state.superiority = (text || '').trim();
      save();
    }

    function el(id){ return document.getElementById(id); }

    function pill(label, opts){
      const d = document.createElement('div');
      d.className = 'pill ' + (opts.className || '');
      d.textContent = label;
      if(opts.onClick){
        d.classList.add('clickable');
        d.addEventListener('click', opts.onClick);
      }
      if(opts.onDblClick){
        d.addEventListener('dblclick', opts.onDblClick);
      }
      return d;
    }

    function pillWithRemove(label, onRemove, isActive = false) {
      const d = document.createElement('div');
      d.className = 'pill removable clickable ' + (isActive ? 'active' : '');
      
      const textSpan = document.createElement('span');
      textSpan.textContent = label;
      textSpan.style.flex = '1';
      textSpan.style.marginRight = '4px';
      
      const removeBtn = document.createElement('span');
      removeBtn.className = 'x';
      removeBtn.textContent = 'Ã—';
      removeBtn.title = 'KaldÄ±r';
      removeBtn.style.cursor = 'pointer';
      removeBtn.style.fontWeight = 'bold';
      removeBtn.style.opacity = '0.7';
      removeBtn.style.marginLeft = '4px';
      removeBtn.style.padding = '0 2px';
      removeBtn.style.borderRadius = '50%';
      removeBtn.style.width = '16px';
      removeBtn.style.height = '16px';
      removeBtn.style.display = 'flex';
      removeBtn.style.alignItems = 'center';
      removeBtn.style.justifyContent = 'center';
      removeBtn.style.backgroundColor = 'rgba(0,0,0,0.05)';
      
      removeBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        onRemove();
      });
      
      removeBtn.addEventListener('mouseenter', () => {
        removeBtn.style.backgroundColor = 'rgba(239, 68, 68, 0.2)';
        removeBtn.style.opacity = '1';
      });
      
      removeBtn.addEventListener('mouseleave', () => {
        removeBtn.style.backgroundColor = 'rgba(0,0,0,0.05)';
        removeBtn.style.opacity = '0.7';
      });
      
      d.appendChild(textSpan);
      d.appendChild(removeBtn);
      
      return d;
    }

    function renderProducts(){
      const wrap = el('productPills');
      const label = el('activeProductLabel');
      if(!wrap || !label) return;

      wrap.innerHTML = '';
      label.textContent = 'SeÃ§ilen Ã¼rÃ¼n: ' + (state.activeProduct || 'â€”');

      state.products.forEach(p=>{
        const d = pillWithRemove(p, 
          () => removeProduct(p), 
          p === state.activeProduct
        );
        
        d.addEventListener('click', (e) => {
          if (!e.target.classList.contains('x')) {
            setActiveProduct(p);
          }
        });
        
        wrap.appendChild(d);
      });
    }

    function renderCompetitors(){
      const wrap = el('competitorPills');
      const label = el('activeCompetitorLabel');
      if(!wrap || !label) return;

      wrap.innerHTML = '';
      label.textContent = 'SeÃ§ilen rakip: ' + (state.activeCompetitor || 'â€”');

      state.competitors.forEach(c=>{
        const d = pillWithRemove(c, 
          () => removeCompetitor(c), 
          c === state.activeCompetitor
        );
        
        d.addEventListener('click', (e) => {
          if (!e.target.classList.contains('x')) {
            setActiveCompetitor(c);
          }
        });
        
        wrap.appendChild(d);
      });
    }

    function renderSuperiority(){
      const wrap = el('superiorityPills');
      const input = el('superiorityInput');
      if(!wrap || !input) return;

      wrap.innerHTML = '';
      QUICK_SUPERIORITY.forEach(s=>{
        const d = pill(s, {
          className: 'clickable',
          onClick: ()=>{
            input.value = s;
            setSuperiority(s);
          }
        });
        wrap.appendChild(d);
      });

      input.value = state.superiority || '';
      input.addEventListener('input', ()=>setSuperiority(input.value));
    }

    function bind(){
      const addProductBtn = el('addProductBtn');
      const productInput = el('productNameInput');
      const addCompetitorBtn = el('addCompetitorBtn');
      const competitorInput = el('competitorNameInput');

      if(addProductBtn && productInput){
        addProductBtn.addEventListener('click', ()=>{
          addProduct(productInput.value);
          productInput.value = '';
          productInput.blur();
        });
        productInput.addEventListener('keydown', (e)=>{
          if(e.key === 'Enter'){ e.preventDefault(); addProductBtn.click(); }
        });
      }

      if(addCompetitorBtn && competitorInput){
        addCompetitorBtn.addEventListener('click', ()=>{
          addCompetitor(competitorInput.value);
          competitorInput.value = '';
          competitorInput.blur();
        });
        competitorInput.addEventListener('keydown', (e)=>{
          if(e.key === 'Enter'){ e.preventDefault(); addCompetitorBtn.click(); }
        });
      }
    }

    function render(){
      renderProducts();
      renderCompetitors();
      renderSuperiority();
    }

    function init(){
      load();
      bind();
      if(!state.activeProduct && state.products.length) state.activeProduct = state.products[0];
      if(!state.activeCompetitor && state.competitors.length) state.activeCompetitor = state.competitors[0];
      render();
      
      console.log('âœ… BaÄŸÄ±msÄ±z ÃœrÃ¼n/Rakip sistemi hazÄ±r');
    }

    return { 
      init,
      getState: () => state,
      addProduct,
      removeProduct,
      addCompetitor,
      removeCompetitor
    };
  })();

  // ============================================
  // ğŸ› ï¸ UTILITY FONKSÄ°YONLAR
  // ============================================
  
  function showMobileNotification(message, type = 'info') {
    const area = document.getElementById('mobileNotificationArea');
    if (!area) return;
    
    const notification = document.createElement('div');
    notification.className = `mobile-notification ${type}`;
    
    let icon = 'â„¹ï¸';
    if (type === 'success') icon = 'âœ…';
    if (type === 'warning') icon = 'âš ï¸';
    if (type === 'error') icon = 'âŒ';
    if (type === 'info') icon = 'â„¹ï¸';
    
    notification.innerHTML = `
      <span class="icon">${icon}</span>
      <span class="message">${message}</span>
      <button class="close-btn" aria-label="Kapat">Ã—</button>
    `;
    
    area.appendChild(notification);
    
    notification.querySelector('.close-btn').addEventListener('click', () => {
      removeNotification(notification);
    });
    
    setTimeout(() => {
      removeNotification(notification);
    }, 4000);
    
    return notification;
  }
  
  function removeNotification(notification) {
    if (!notification || !notification.parentNode) return;
    
    notification.style.opacity = '0';
    notification.style.transform = 'translateX(-50%) translateY(-10px)';
    notification.style.transition = 'opacity 0.3s, transform 0.3s';
    
    setTimeout(() => {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 300);
  }

  // ============================================
  // ğŸš€ TÃœM SÄ°STEMLERÄ° BAÅLAT
  // ============================================
  document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸš€ FAST CPR KOÃ‡U - TAM ZAMAN BOMBASI SÄ°STEMÄ° v3.2024');
    
    // Ek gÃ¼venlik kontrolÃ¼
    if (typeof window.__securityCheck !== 'undefined') {
      console.warn('GÃ¼venlik ihlali tespit edildi');
      return;
    }
    
    // Ä°ÅŸaretleme (tampering detection)
    window.__securityCheck = 'FAST_CPR_TAM_ZAMAN_BOMBASI';
    
    // Sistemleri baÅŸlat
    try {
      // 1. Ã–NCE ZAMAN BOMBASINI BAÅLAT
      TimeBombSecurity.init();
      
      // 2. DÄ°ÄER SÄ°STEMLERÄ° BAÅLAT
      setTimeout(() => {
        AutoCPRGenerator.init();
        SocialLearningStyleManager.init();
        MobileFeatures.init();
        CPRFlowControl.init();
        ProductPrep.init();
        
        // 3. PDF BUTONUNU BAÄLA
        const fullReportBtn = document.getElementById('fullReportPDF');
        if (fullReportBtn) {
          fullReportBtn.addEventListener('click', () => {
            ComprehensivePDFReport.generateFullReport();
          });
          
          fullReportBtn.addEventListener('mouseenter', () => {
            if (!fullReportBtn.innerHTML.includes('OluÅŸturuluyor')) {
              fullReportBtn.style.background = '#2563eb';
              fullReportBtn.style.transform = 'scale(1.02)';
              fullReportBtn.style.transition = 'all 0.2s ease';
            }
          });
          
          fullReportBtn.addEventListener('mouseleave', () => {
            if (!fullReportBtn.innerHTML.includes('OluÅŸturuluyor')) {
              fullReportBtn.style.background = '#3b82f6';
              fullReportBtn.style.transform = 'scale(1)';
            }
          });
        }
        
        // 4. SES BUTONLARINI BAÄLA
        document.querySelectorAll('.voice-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.preventDefault();
            
            if (btn.disabled) {
              showMobileNotification('Bu alan Temel CPR â‰¥ 13 olmadan kullanÄ±lamaz', 'warning');
              return;
            }
            
            const targetId = btn.getAttribute('data-target');
            if (targetId && MobileFeatures.SpeechToText) {
              MobileFeatures.SpeechToText.toggleListening(targetId);
            }
          });
        });
        
        // 5. Orijinal placeholder'larÄ± kaydet
        document.querySelectorAll('.styled-cpr-area').forEach(textarea => {
          textarea.setAttribute('data-original-placeholder', textarea.placeholder);
        });
        
        // 6. HEADER DÃœZENÄ° Ä°Ã‡Ä°N EK CSS
        const style = document.createElement('style');
        style.textContent = `
          .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
          }
          .header-left {
            flex: 1;
            min-width: 300px;
          }
          .pdf-button-container {
            flex-shrink: 0;
          }
          .auto-cpr-section {
            margin-top: 30px;
            border-color: #3b82f6;
            position: relative;
          }
          .section-label {
            position: absolute;
            top: -10px;
            left: 16px;
            background: white;
            padding: 4px 10px;
            font-size: 11px;
            font-weight: 600;
            color: #1d4ed8;
            border: 1px solid #3b82f6;
            border-radius: 20px;
            letter-spacing: 0.02em;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.1);
          }
          .behavior-details summary .arrow {
            transition: transform 0.3s ease;
            font-size: 12px;
            margin-left: 10px;
          }
          .behavior-details[open] summary .arrow {
            transform: rotate(90deg);
          }
          @media (max-width: 768px) {
            .header-top {
              flex-direction: column;
              gap: 15px;
            }
            .header-left {
              min-width: auto;
              width: 100%;
            }
            .pdf-button-container {
              align-self: flex-start;
            }
          }
        `;
        document.head.appendChild(style);
        
        console.log('âœ… TÃœM SÄ°STEMLER GÃœVENLÄ° BAÅLATILDI!');
        
        // BaÅŸlangÄ±Ã§ kontrolÃ¼
        setTimeout(() => {
          if (!navigator.onLine) {
            showMobileNotification('Ã‡evrimdÄ±ÅŸÄ± moddasÄ±nÄ±z. Ã‡alÄ±ÅŸmalarÄ±nÄ±z yerelde kaydedilecek.', 'warning');
          }
          
          const drafts = MobileFeatures.DraftSystem.getAllDrafts();
          if (drafts.length > 0) {
            console.log(`ğŸ“Š ${drafts.length} kayÄ±tlÄ± draft bulundu`);
            showMobileNotification(`${drafts.length} kayÄ±tlÄ± draft bulundu. "Draft Listesi" butonundan yÃ¼kleyebilirsiniz.`, 'info');
          }
          
          // AutoCPR'i baÅŸlangÄ±Ã§ta gÃ¼ncelle
          AutoCPRGenerator.updateAutoCPR();
          
          // CPR skorunu baÅŸlangÄ±Ã§ta gÃ¶ster
          const initialScore = CPRFlowControl.updateCPRScore();
          console.log(`ğŸ“Š BaÅŸlangÄ±Ã§ CPR skoru: ${initialScore}/22`);
          
          if (initialScore < 13) {
            showMobileNotification(`Temel CPR skorunuz: ${initialScore}/22. Stil alanlarÄ± iÃ§in ${13 - initialScore} puan daha gerekiyor.`, 'info');
          } else {
            showMobileNotification(`ğŸ‰ Tebrikler! Temel CPR skorunuz: ${initialScore}/22. Stil alanlarÄ± aktif!`, 'success');
          }
        }, 500);
        
      }, 1000); // 1 saniye gecikme ile diÄŸer sistemler
      
      // Copyright bildirimi
      setTimeout(() => {
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed;
          bottom: 10px;
          right: 10px;
          background: rgba(0,0,0,0.8);
          color: white;
          padding: 8px 12px;
          border-radius: 8px;
          font-size: 11px;
          z-index: 9999;
          font-family: sans-serif;
          backdrop-filter: blur(5px);
        `;
        notification.textContent = 'Â© 2024 FAST CPR KoÃ§u - Tam Zaman BombasÄ± Sistemi Aktif';
        document.body.appendChild(notification);
        
        // 10 saniye sonra kaybolur
        setTimeout(() => {
          if (notification.parentNode) {
            notification.style.opacity = '0';
            notification.style.transition = 'opacity 0.5s';
            setTimeout(() => notification.remove(), 500);
          }
        }, 10000);
      }, 2000);
      
    } catch (error) {
      console.error('BaÅŸlatma hatasÄ±:', error);
      
      // Hata durumunda kullanÄ±cÄ±ya bilgi ver
      const errorDiv = document.createElement('div');
      errorDiv.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        text-align: center;
        z-index: 10000;
        max-width: 400px;
        border: 2px solid #ef4444;
      `;
      errorDiv.innerHTML = `
        <h3 style="color: #ef4444; margin-top: 0;">â›” Sistem HatasÄ±</h3>
        <p>AraÃ§ baÅŸlatÄ±lÄ±rken bir hata oluÅŸtu.</p>
        <p>LÃ¼tfen sayfayÄ± yenileyin veya orijinal kaynaktan tekrar deneyin.</p>
        <button onclick="location.reload()" style="
          background: #3b82f6;
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 8px;
          margin-top: 15px;
          cursor: pointer;
        ">SayfayÄ± Yenile</button>
      `;
      document.body.appendChild(errorDiv);
    }
  });

  </script>
</body>
</html>
